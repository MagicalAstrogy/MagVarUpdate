{"version":3,"file":"bundle.js","mappings":"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","sources":["src://tavern_helper_template/node_modules/vue-loader/dist/exportHelper.js","src://tavern_helper_template/node_modules/css-loader/dist/runtime/api.js","src://tavern_helper_template/node_modules/css-loader/dist/runtime/sourceMaps.js","webpack://tavern_helper_template/src/Panel.vue?7ffb","src://tavern_helper_template/node_modules/vue-style-loader/lib/listToStyles.js","src://tavern_helper_template/node_modules/vue-style-loader/lib/addStylesClient.js","webpack://tavern_helper_template/src/Panel.vue?60cd","src://tavern_helper_template/webpack/bootstrap","src://tavern_helper_template/src/variable_def.ts","src://tavern_helper_template/webpack/runtime/compat get default export","src://tavern_helper_template/webpack/runtime/define property getters","src://tavern_helper_template/webpack/runtime/hasOwnProperty shorthand","src://tavern_helper_template/webpack/runtime/make namespace object","src://tavern_helper_template/src/schema.ts","src://tavern_helper_template/external var \"Vue\"","src://tavern_helper_template/external var \"z\"","src://tavern_helper_template/src/util.ts","src://tavern_helper_template/src/settings.ts","src://tavern_helper_template/external module \"https://testingcf.jsdelivr.net/npm/mathjs/+esm\"","src://tavern_helper_template/src/function.ts","src://tavern_helper_template/src/update_descriptions.ts","src://tavern_helper_template/src/variable_init.ts","src://tavern_helper_template/src/button.ts","src://tavern_helper_template/src/export_globals.ts","src://tavern_helper_template/src/function_call.ts","webpack://tavern_helper_template/src/chat_variable_help.md?1623","webpack://tavern_helper_template/src/Panel.vue","src://tavern_helper_template/src/Panel.vue","webpack://tavern_helper_template/src/panel_method_help.md?03a1","webpack://tavern_helper_template/src/panel_extra_mode_help.md?d95b","webpack://tavern_helper_template/src/Panel.vue?8ab2","src://tavern_helper_template/src/panel.ts","src://tavern_helper_template/src/main.ts","src://tavern_helper_template/src/notifications.ts"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n// runtime helper for setting properties on components\n// in a tree-shakable way\nexports.default = (sfc, props) => {\n    const target = sfc.__vccOpts || sfc;\n    for (const [key, val] of props) {\n        target[key] = val;\n    }\n    return target;\n};\n","\"use strict\";\n\n/*\n  MIT License http://www.opensource.org/licenses/mit-license.php\n  Author Tobias Koppers @sokra\n*/\nmodule.exports = function (cssWithMappingToString) {\n  var list = [];\n\n  // return the list of modules as css string\n  list.toString = function toString() {\n    return this.map(function (item) {\n      var content = \"\";\n      var needLayer = typeof item[5] !== \"undefined\";\n      if (item[4]) {\n        content += \"@supports (\".concat(item[4], \") {\");\n      }\n      if (item[2]) {\n        content += \"@media \".concat(item[2], \" {\");\n      }\n      if (needLayer) {\n        content += \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\");\n      }\n      content += cssWithMappingToString(item);\n      if (needLayer) {\n        content += \"}\";\n      }\n      if (item[2]) {\n        content += \"}\";\n      }\n      if (item[4]) {\n        content += \"}\";\n      }\n      return content;\n    }).join(\"\");\n  };\n\n  // import a list of modules into the list\n  list.i = function i(modules, media, dedupe, supports, layer) {\n    if (typeof modules === \"string\") {\n      modules = [[null, modules, undefined]];\n    }\n    var alreadyImportedModules = {};\n    if (dedupe) {\n      for (var k = 0; k < this.length; k++) {\n        var id = this[k][0];\n        if (id != null) {\n          alreadyImportedModules[id] = true;\n        }\n      }\n    }\n    for (var _k = 0; _k < modules.length; _k++) {\n      var item = [].concat(modules[_k]);\n      if (dedupe && alreadyImportedModules[item[0]]) {\n        continue;\n      }\n      if (typeof layer !== \"undefined\") {\n        if (typeof item[5] === \"undefined\") {\n          item[5] = layer;\n        } else {\n          item[1] = \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\").concat(item[1], \"}\");\n          item[5] = layer;\n        }\n      }\n      if (media) {\n        if (!item[2]) {\n          item[2] = media;\n        } else {\n          item[1] = \"@media \".concat(item[2], \" {\").concat(item[1], \"}\");\n          item[2] = media;\n        }\n      }\n      if (supports) {\n        if (!item[4]) {\n          item[4] = \"\".concat(supports);\n        } else {\n          item[1] = \"@supports (\".concat(item[4], \") {\").concat(item[1], \"}\");\n          item[4] = supports;\n        }\n      }\n      list.push(item);\n    }\n  };\n  return list;\n};","\"use strict\";\n\nmodule.exports = function (item) {\n  var content = item[1];\n  var cssMapping = item[3];\n  if (!cssMapping) {\n    return content;\n  }\n  if (typeof btoa === \"function\") {\n    var base64 = btoa(unescape(encodeURIComponent(JSON.stringify(cssMapping))));\n    var data = \"sourceMappingURL=data:application/json;charset=utf-8;base64,\".concat(base64);\n    var sourceMapping = \"/*# \".concat(data, \" */\");\n    return [content].concat([sourceMapping]).join(\"\\n\");\n  }\n  return [content].join(\"\\n\");\n};","// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../node_modules/css-loader/dist/cjs.js??clonedRuleSet-10.use[1]!../node_modules/vue-loader/dist/stylePostLoader.js!../node_modules/postcss-loader/dist/cjs.js!../node_modules/vue-loader/dist/index.js??ruleSet[1].rules[4].use[0]!./Panel.vue?vue&type=style&index=0&id=0f39b546&scoped=true&lang=css\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../node_modules/vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"1aa88f62\", content, false, {\"ssrId\":true});\n// Hot Module Replacement\nif(module.hot) {\n // When the styles change, update the <style> tags\n if(!content.locals) {\n   module.hot.accept(\"!!../node_modules/css-loader/dist/cjs.js??clonedRuleSet-10.use[1]!../node_modules/vue-loader/dist/stylePostLoader.js!../node_modules/postcss-loader/dist/cjs.js!../node_modules/vue-loader/dist/index.js??ruleSet[1].rules[4].use[0]!./Panel.vue?vue&type=style&index=0&id=0f39b546&scoped=true&lang=css\", function() {\n     var newContent = require(\"!!../node_modules/css-loader/dist/cjs.js??clonedRuleSet-10.use[1]!../node_modules/vue-loader/dist/stylePostLoader.js!../node_modules/postcss-loader/dist/cjs.js!../node_modules/vue-loader/dist/index.js??ruleSet[1].rules[4].use[0]!./Panel.vue?vue&type=style&index=0&id=0f39b546&scoped=true&lang=css\");\n     if(newContent.__esModule) newContent = newContent.default;\n     if(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n     update(newContent);\n   });\n }\n // When the module is disposed, remove the <style> tags\n module.hot.dispose(function() { update(); });\n}","/**\n * Translates the list format produced by css-loader into something\n * easier to manipulate.\n */\nexport default function listToStyles (parentId, list) {\n  var styles = []\n  var newStyles = {}\n  for (var i = 0; i < list.length; i++) {\n    var item = list[i]\n    var id = item[0]\n    var css = item[1]\n    var media = item[2]\n    var sourceMap = item[3]\n    var part = {\n      id: parentId + ':' + i,\n      css: css,\n      media: media,\n      sourceMap: sourceMap\n    }\n    if (!newStyles[id]) {\n      styles.push(newStyles[id] = { id: id, parts: [part] })\n    } else {\n      newStyles[id].parts.push(part)\n    }\n  }\n  return styles\n}\n","/*\n  MIT License http://www.opensource.org/licenses/mit-license.php\n  Author Tobias Koppers @sokra\n  Modified by Evan You @yyx990803\n*/\n\nimport listToStyles from './listToStyles'\n\nvar hasDocument = typeof document !== 'undefined'\n\nif (typeof DEBUG !== 'undefined' && DEBUG) {\n  if (!hasDocument) {\n    throw new Error(\n    'vue-style-loader cannot be used in a non-browser environment. ' +\n    \"Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.\"\n  ) }\n}\n\n/*\ntype StyleObject = {\n  id: number;\n  parts: Array<StyleObjectPart>\n}\n\ntype StyleObjectPart = {\n  css: string;\n  media: string;\n  sourceMap: ?string\n}\n*/\n\nvar stylesInDom = {/*\n  [id: number]: {\n    id: number,\n    refs: number,\n    parts: Array<(obj?: StyleObjectPart) => void>\n  }\n*/}\n\nvar head = hasDocument && (document.head || document.getElementsByTagName('head')[0])\nvar singletonElement = null\nvar singletonCounter = 0\nvar isProduction = false\nvar noop = function () {}\nvar options = null\nvar ssrIdKey = 'data-vue-ssr-id'\n\n// Force single-tag solution on IE6-9, which has a hard limit on the # of <style>\n// tags it will allow on a page\nvar isOldIE = typeof navigator !== 'undefined' && /msie [6-9]\\b/.test(navigator.userAgent.toLowerCase())\n\nexport default function addStylesClient (parentId, list, _isProduction, _options) {\n  isProduction = _isProduction\n\n  options = _options || {}\n\n  var styles = listToStyles(parentId, list)\n  addStylesToDom(styles)\n\n  return function update (newList) {\n    var mayRemove = []\n    for (var i = 0; i < styles.length; i++) {\n      var item = styles[i]\n      var domStyle = stylesInDom[item.id]\n      domStyle.refs--\n      mayRemove.push(domStyle)\n    }\n    if (newList) {\n      styles = listToStyles(parentId, newList)\n      addStylesToDom(styles)\n    } else {\n      styles = []\n    }\n    for (var i = 0; i < mayRemove.length; i++) {\n      var domStyle = mayRemove[i]\n      if (domStyle.refs === 0) {\n        for (var j = 0; j < domStyle.parts.length; j++) {\n          domStyle.parts[j]()\n        }\n        delete stylesInDom[domStyle.id]\n      }\n    }\n  }\n}\n\nfunction addStylesToDom (styles /* Array<StyleObject> */) {\n  for (var i = 0; i < styles.length; i++) {\n    var item = styles[i]\n    var domStyle = stylesInDom[item.id]\n    if (domStyle) {\n      domStyle.refs++\n      for (var j = 0; j < domStyle.parts.length; j++) {\n        domStyle.parts[j](item.parts[j])\n      }\n      for (; j < item.parts.length; j++) {\n        domStyle.parts.push(addStyle(item.parts[j]))\n      }\n      if (domStyle.parts.length > item.parts.length) {\n        domStyle.parts.length = item.parts.length\n      }\n    } else {\n      var parts = []\n      for (var j = 0; j < item.parts.length; j++) {\n        parts.push(addStyle(item.parts[j]))\n      }\n      stylesInDom[item.id] = { id: item.id, refs: 1, parts: parts }\n    }\n  }\n}\n\nfunction createStyleElement () {\n  var styleElement = document.createElement('style')\n  styleElement.type = 'text/css'\n  head.appendChild(styleElement)\n  return styleElement\n}\n\nfunction addStyle (obj /* StyleObjectPart */) {\n  var update, remove\n  var styleElement = document.querySelector('style[' + ssrIdKey + '~=\"' + obj.id + '\"]')\n\n  if (styleElement) {\n    if (isProduction) {\n      // has SSR styles and in production mode.\n      // simply do nothing.\n      return noop\n    } else {\n      // has SSR styles but in dev mode.\n      // for some reason Chrome can't handle source map in server-rendered\n      // style tags - source maps in <style> only works if the style tag is\n      // created and inserted dynamically. So we remove the server rendered\n      // styles and inject new ones.\n      styleElement.parentNode.removeChild(styleElement)\n    }\n  }\n\n  if (isOldIE) {\n    // use singleton mode for IE9.\n    var styleIndex = singletonCounter++\n    styleElement = singletonElement || (singletonElement = createStyleElement())\n    update = applyToSingletonTag.bind(null, styleElement, styleIndex, false)\n    remove = applyToSingletonTag.bind(null, styleElement, styleIndex, true)\n  } else {\n    // use multi-style-tag mode in all other cases\n    styleElement = createStyleElement()\n    update = applyToTag.bind(null, styleElement)\n    remove = function () {\n      styleElement.parentNode.removeChild(styleElement)\n    }\n  }\n\n  update(obj)\n\n  return function updateStyle (newObj /* StyleObjectPart */) {\n    if (newObj) {\n      if (newObj.css === obj.css &&\n          newObj.media === obj.media &&\n          newObj.sourceMap === obj.sourceMap) {\n        return\n      }\n      update(obj = newObj)\n    } else {\n      remove()\n    }\n  }\n}\n\nvar replaceText = (function () {\n  var textStore = []\n\n  return function (index, replacement) {\n    textStore[index] = replacement\n    return textStore.filter(Boolean).join('\\n')\n  }\n})()\n\nfunction applyToSingletonTag (styleElement, index, remove, obj) {\n  var css = remove ? '' : obj.css\n\n  if (styleElement.styleSheet) {\n    styleElement.styleSheet.cssText = replaceText(index, css)\n  } else {\n    var cssNode = document.createTextNode(css)\n    var childNodes = styleElement.childNodes\n    if (childNodes[index]) styleElement.removeChild(childNodes[index])\n    if (childNodes.length) {\n      styleElement.insertBefore(cssNode, childNodes[index])\n    } else {\n      styleElement.appendChild(cssNode)\n    }\n  }\n}\n\nfunction applyToTag (styleElement, obj) {\n  var css = obj.css\n  var media = obj.media\n  var sourceMap = obj.sourceMap\n\n  if (media) {\n    styleElement.setAttribute('media', media)\n  }\n  if (options.ssrId) {\n    styleElement.setAttribute(ssrIdKey, obj.id)\n  }\n\n  if (sourceMap) {\n    // https://developer.chrome.com/devtools/docs/javascript-debugging\n    // this makes source maps inside style tags work properly in Chrome\n    css += '\\n/*# sourceURL=' + sourceMap.sources[0] + ' */'\n    // http://stackoverflow.com/a/26603875\n    css += '\\n/*# sourceMappingURL=data:application/json;base64,' + btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap)))) + ' */'\n  }\n\n  if (styleElement.styleSheet) {\n    styleElement.styleSheet.cssText = css\n  } else {\n    while (styleElement.firstChild) {\n      styleElement.removeChild(styleElement.firstChild)\n    }\n    styleElement.appendChild(document.createTextNode(css))\n  }\n}\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.collapse-container[data-v-0f39b546]{border:1px solid #ccc;border-radius:4px;padding:2px;background:transparent}.collapse-enter-from[data-v-0f39b546],.collapse-leave-to[data-v-0f39b546]{max-height:0;opacity:0;overflow:hidden}.collapse-enter-to[data-v-0f39b546],.collapse-leave-from[data-v-0f39b546]{max-height:240px;opacity:1}.collapse-enter-active[data-v-0f39b546],.collapse-leave-active[data-v-0f39b546]{transition:all 0.3s ease}.collapse-content[data-v-0f39b546]{margin-top:2px;padding:2px;background-color:transparent;border-radius:4px}\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./src/Panel.vue\"],\"names\":[],\"mappings\":\"AA4XA,qCACI,qBAAsB,CACtB,iBAAkB,CAClB,WAAY,CACZ,sBACJ,CAGA,0EAEI,YAAa,CACb,SAAU,CACV,eACJ,CAEA,0EAEI,gBAAiB,CACjB,SACJ,CAEA,gFAEI,wBACJ,CAEA,mCACI,cAAe,CACf,WAAY,CACZ,4BAA6B,CAC7B,iBACJ\",\"sourcesContent\":[\"<template>\\n    <div class=\\\"inline-drawer\\\">\\n        <div class=\\\"inline-drawer-toggle inline-drawer-header\\\">\\n            <b>MVU </b>\\n            <div class=\\\"inline-drawer-icon fa-solid fa-circle-chevron-down down\\\"></div>\\n        </div>\\n\\n        <div class=\\\"inline-drawer-content\\\">\\n            <div class=\\\"flex-container flexFlowColumn\\\">\\n                <div><strong></strong></div>\\n                <label class=\\\"checkbox_label\\\" for=\\\"mvu_notification_error\\\">\\n                    <input\\n                        id=\\\"mvu_notification_error\\\"\\n                        v-model=\\\"store.settings..\\\"\\n                        type=\\\"checkbox\\\"\\n                    />\\n                    <span></span>\\n                </label>\\n                <label class=\\\"checkbox_label\\\" for=\\\"mvu_notification_extra_model_parsing\\\">\\n                    <input\\n                        id=\\\"mvu_notification_extra_model_parsing\\\"\\n                        v-model=\\\"store.settings..\\\"\\n                        type=\\\"checkbox\\\"\\n                    />\\n                    <span></span>\\n                </label>\\n            </div>\\n\\n            <hr />\\n\\n            <div class=\\\"flex-container flexFlowColumn\\\">\\n                <div>\\n                    <strong></strong>\\n                    <i\\n                        class=\\\"fa-solid fa-circle-question fa-sm note-link-span\\\"\\n                        style=\\\"cursor: pointer\\\"\\n                        @click=\\\"showMethodHelp\\\"\\n                    />\\n                </div>\\n                <select id=\\\"mvu_update_method\\\" v-model=\\\"store.settings.\\\" class=\\\"text_pole\\\">\\n                    <option value=\\\"AI\\\">AI</option>\\n                    <option value=\\\"\\\"></option>\\n                </select>\\n\\n                <template v-if=\\\"store.settings. === ''\\\">\\n                    <label>\\n                        \\n                        <i\\n                            class=\\\"fa-solid fa-circle-question fa-sm note-link-span\\\"\\n                            style=\\\"cursor: pointer\\\"\\n                            @click=\\\"showExtraModeHelp\\\"\\n                        />\\n                    </label>\\n                    <label class=\\\"checkbox_label\\\" for=\\\"mvu_extra_model_send_preset\\\">\\n                        <input\\n                            id=\\\"mvu_extra_model_send_preset\\\"\\n                            v-model=\\\"store.settings..\\\"\\n                            type=\\\"checkbox\\\"\\n                        />\\n                        <span></span>\\n                    </label>\\n                    <label class=\\\"checkbox_label\\\" for=\\\"mvu_extra_model_use_function_calling\\\">\\n                        <input\\n                            id=\\\"mvu_extra_model_use_function_calling\\\"\\n                            v-model=\\\"store.settings..\\\"\\n                            type=\\\"checkbox\\\"\\n                        />\\n                        <span></span>\\n                    </label>\\n\\n                    <label for=\\\"mvu_extra_model_source\\\"></label>\\n                    <select\\n                        id=\\\"mvu_extra_model_source\\\"\\n                        v-model=\\\"store.settings..\\\"\\n                        class=\\\"text_pole\\\"\\n                    >\\n                        <option value=\\\"\\\"></option>\\n                        <option value=\\\"\\\"></option>\\n                    </select>\\n\\n                    <template v-if=\\\"store.settings.. === ''\\\">\\n                        <div class=\\\"flex-container flexFlowColumn\\\">\\n                            <label for=\\\"mvu_api_url\\\">API </label>\\n                            <input\\n                                id=\\\"mvu_api_url\\\"\\n                                v-model=\\\"store.settings..api\\\"\\n                                type=\\\"text\\\"\\n                                class=\\\"text_pole\\\"\\n                                placeholder=\\\"http://localhost:1234/v1\\\"\\n                            />\\n                        </div>\\n\\n                        <div class=\\\"flex-container flexFlowColumn\\\">\\n                            <label for=\\\"mvu_api_key\\\">API </label>\\n                            <input\\n                                id=\\\"mvu_api_key\\\"\\n                                v-model=\\\"store.settings..\\\"\\n                                type=\\\"password\\\"\\n                                class=\\\"text_pole\\\"\\n                                placeholder=\\\"\\\"\\n                            />\\n                        </div>\\n\\n                        <div class=\\\"flex-container flexFlowColumn\\\">\\n                            <label for=\\\"mvu_model_name\\\"></label>\\n                            <input\\n                                id=\\\"mvu_model_name\\\"\\n                                v-model=\\\"store.settings..\\\"\\n                                type=\\\"text\\\"\\n                                class=\\\"text_pole\\\"\\n                                placeholder=\\\"gemini-2.5-flash\\\"\\n                            />\\n                        </div>\\n\\n                        <div v-if=\\\"!additional_extra_configuration_supported\\\">\\n                            <hr />\\n                            , \\n                        </div>\\n\\n                        <div class=\\\"flex-container flexFlowColumn\\\">\\n                            <label for=\\\"mvu_temperature\\\"></label>\\n                            <input\\n                                id=\\\"mvu_temperature\\\"\\n                                v-model=\\\"store.settings..\\\"\\n                                :disabled=\\\"!additional_extra_configuration_supported\\\"\\n                                type=\\\"number\\\"\\n                                class=\\\"text_pole\\\"\\n                                min=\\\"0\\\"\\n                                max=\\\"2\\\"\\n                                step=\\\"0.01\\\"\\n                                placeholder=\\\"1.0\\\"\\n                            />\\n                        </div>\\n\\n                        <div class=\\\"flex-container flexFlowColumn\\\">\\n                            <label for=\\\"mvu_frequency_penalty\\\"></label>\\n                            <input\\n                                id=\\\"mvu_frequency_penalty\\\"\\n                                v-model=\\\"store.settings..\\\"\\n                                :disabled=\\\"!additional_extra_configuration_supported\\\"\\n                                type=\\\"number\\\"\\n                                class=\\\"text_pole\\\"\\n                                min=\\\"-2\\\"\\n                                max=\\\"2\\\"\\n                                step=\\\"0.01\\\"\\n                                placeholder=\\\"0.0\\\"\\n                            />\\n                        </div>\\n\\n                        <div class=\\\"flex-container flexFlowColumn\\\">\\n                            <label for=\\\"mvu_presence_penalty\\\"></label>\\n                            <input\\n                                id=\\\"mvu_presence_penalty\\\"\\n                                v-model=\\\"store.settings..\\\"\\n                                :disabled=\\\"!additional_extra_configuration_supported\\\"\\n                                type=\\\"number\\\"\\n                                class=\\\"text_pole\\\"\\n                                min=\\\"-2\\\"\\n                                max=\\\"2\\\"\\n                                step=\\\"0.01\\\"\\n                                placeholder=\\\"0.0\\\"\\n                            />\\n                        </div>\\n\\n                        <div class=\\\"flex-container flexFlowColumn\\\">\\n                            <label for=\\\"mvu_max_tokens\\\">token</label>\\n                            <input\\n                                id=\\\"mvu_max_tokens\\\"\\n                                v-model=\\\"store.settings..token\\\"\\n                                :disabled=\\\"!additional_extra_configuration_supported\\\"\\n                                type=\\\"number\\\"\\n                                class=\\\"text_pole\\\"\\n                                min=\\\"0\\\"\\n                                step=\\\"128\\\"\\n                                placeholder=\\\"1000\\\"\\n                            />\\n                        </div>\\n                    </template>\\n                </template>\\n            </div>\\n\\n            <hr />\\n\\n            <div class=\\\"flex-container flexFlowColumn\\\">\\n                <div>\\n                    <strong></strong>\\n                </div>\\n                <div class=\\\"collapse-container\\\">\\n                    <button\\n                        style=\\\"background: transparent\\\"\\n                        @click=\\\"cleanup_is_open = !cleanup_is_open\\\"\\n                    >\\n                        {{ cleanup_is_open ? '-' : '-' }}\\n                    </button>\\n\\n                    <Transition name=\\\"collapse\\\">\\n                        <div v-show=\\\"cleanup_is_open\\\" class=\\\"collapse-content\\\">\\n                            <div class=\\\"flex-container flexFlowColumn\\\">\\n                                <label for=\\\"mvu_snapshot_interval\\\"></label>\\n                                <input\\n                                    id=\\\"mvu_snapshot_interval\\\"\\n                                    v-model.number=\\\"store.settings.\\\"\\n                                    type=\\\"number\\\"\\n                                    min=\\\"1\\\"\\n                                    step=\\\"1\\\"\\n                                    class=\\\"text_pole\\\"\\n                                    placeholder=\\\"50\\\"\\n                                />\\n                            </div>\\n\\n                            <div class=\\\"flex-container flexFlowColumn\\\">\\n                                <label for=\\\"mvu_snapshot_interval\\\"></label>\\n                                <input\\n                                    id=\\\"mvu_snapshot_interval\\\"\\n                                    v-model.number=\\\"\\n                                        store.settings.auto_cleanup.\\n                                    \\\"\\n                                    type=\\\"number\\\"\\n                                    min=\\\"1\\\"\\n                                    step=\\\"1\\\"\\n                                    class=\\\"text_pole\\\"\\n                                    placeholder=\\\"50\\\"\\n                                />\\n                            </div>\\n\\n                            <div class=\\\"flex-container flexFlowColumn\\\">\\n                                <label for=\\\"mvu_snapshot_interval\\\"></label>\\n                                <input\\n                                    id=\\\"mvu_snapshot_interval\\\"\\n                                    v-model.number=\\\"\\n                                        store.settings.auto_cleanup.\\n                                    \\\"\\n                                    type=\\\"number\\\"\\n                                    min=\\\"1\\\"\\n                                    step=\\\"1\\\"\\n                                    class=\\\"text_pole\\\"\\n                                    placeholder=\\\"50\\\"\\n                                />\\n                            </div>\\n                        </div>\\n                    </Transition>\\n                </div>\\n\\n                <div class=\\\"collapse-container\\\">\\n                    <button\\n                        style=\\\"background: transparent\\\"\\n                        @click=\\\"compatibility_is_open = !compatibility_is_open\\\"\\n                    >\\n                        {{ compatibility_is_open ? '-' : '-' }}\\n                    </button>\\n                    <Transition name=\\\"collapse\\\">\\n                        <div v-show=\\\"compatibility_is_open\\\" class=\\\"collapse-content\\\">\\n                            <label class=\\\"checkbox_label\\\" for=\\\"mvu_update_to_chat\\\">\\n                                <input\\n                                    id=\\\"mvu_update_to_chat\\\"\\n                                    v-model=\\\"store.settings.\\\"\\n                                    type=\\\"checkbox\\\"\\n                                />\\n                                <span></span>\\n                                <i\\n                                    class=\\\"fa-solid fa-circle-question fa-sm note-link-span\\\"\\n                                    style=\\\"cursor: pointer\\\"\\n                                    @click=\\\"showChatVarHelp\\\"\\n                                />\\n                            </label>\\n                        </div>\\n                    </Transition>\\n                </div>\\n\\n                <label class=\\\"checkbox_label\\\" for=\\\"mvu_auto_clean_checkbox\\\">\\n                    <input\\n                        id=\\\"mvu_auto_clean_checkbox\\\"\\n                        v-model=\\\"store.settings.auto_cleanup.\\\"\\n                        type=\\\"checkbox\\\"\\n                    />\\n                    <span></span>\\n                </label>\\n            </div>\\n\\n            <hr />\\n\\n            <div class=\\\"flex-container flexFlowColumn\\\">\\n                <div><strong></strong></div>\\n                <div class=\\\"flex-container flex\\\">\\n                    <div\\n                        v-for=\\\"button in buttons\\\"\\n                        :key=\\\"button.name\\\"\\n                        class=\\\"menu_button menu_button_icon interactable\\\"\\n                        tabindex=\\\"0\\\"\\n                        role=\\\"button\\\"\\n                        @click=\\\"button.function\\\"\\n                    >\\n                        {{ button.name }}\\n                    </div>\\n                </div>\\n            </div>\\n        </div>\\n    </div>\\n</template>\\n\\n<script setup lang=\\\"ts\\\">\\nimport { buttons } from '@/button';\\nimport panel_extra_mode_help from '@/panel_extra_mode_help.md';\\nimport panel_method_help from '@/panel_method_help.md';\\nimport chat_variable_help from '@/chat_variable_help.md';\\nimport { useSettingsStore } from '@/settings';\\nimport { getSillyTavernVersion, getTavernHelperVersion } from '@/util';\\nimport { compare } from 'compare-versions';\\nimport { ref, watch } from 'vue';\\n\\nconst store = useSettingsStore();\\n\\nconst additional_extra_configuration_supported = compare(getTavernHelperVersion(), '4.0.14', '>=');\\n\\nconst cleanup_is_open = ref(false);\\nconst compatibility_is_open = ref(false);\\n\\nwatch(\\n    () => store.settings.,\\n    value => {\\n        if (value === '' && compare(getSillyTavernVersion(), '1.13.4', '<')) {\\n            toastr.error(\\n                \\\"'' 1.13.4\\\",\\n                \\\"[MVU]''\\\",\\n                { timeOut: 5000 }\\n            );\\n            store.settings. = 'AI';\\n        }\\n    }\\n);\\n\\nwatch(\\n    () => store.settings..,\\n    value => {\\n        if (value === true) {\\n            if (!SillyTavern.ToolManager.isToolCallingSupported()) {\\n                toastr.error(\\n                    \\\" API  () ''\\\",\\n                    \\\"[MVU]''\\\",\\n                    {\\n                        timeOut: 5000,\\n                    }\\n                );\\n            }\\n            if (SillyTavern.chatCompletionSettings.function_calling === false) {\\n                toastr.error(\\\"''\\\", \\\"[MVU]''\\\", {\\n                    timeOut: 5000,\\n                });\\n            }\\n            store.settings.. = true;\\n        }\\n    }\\n);\\n\\nasync function showMethodHelp() {\\n    SillyTavern.callGenericPopup(panel_method_help, SillyTavern.POPUP_TYPE.TEXT, '', {\\n        allowVerticalScrolling: true,\\n        leftAlign: true,\\n        wide: true,\\n    });\\n}\\n\\nasync function showChatVarHelp() {\\n    SillyTavern.callGenericPopup(chat_variable_help, SillyTavern.POPUP_TYPE.TEXT, '', {\\n        allowVerticalScrolling: true,\\n        leftAlign: true,\\n        wide: true,\\n    });\\n}\\n\\nasync function showExtraModeHelp() {\\n    SillyTavern.callGenericPopup(panel_extra_mode_help, SillyTavern.POPUP_TYPE.TEXT, '', {\\n        allowVerticalScrolling: true,\\n        leftAlign: true,\\n        wide: true,\\n    });\\n}\\n</script>\\n\\n<style scoped>\\n.collapse-container {\\n    border: 1px solid #ccc;\\n    border-radius: 4px;\\n    padding: 2px;\\n    background: transparent;\\n}\\n\\n/*  */\\n.collapse-enter-from,\\n.collapse-leave-to {\\n    max-height: 0;\\n    opacity: 0;\\n    overflow: hidden;\\n}\\n\\n.collapse-enter-to,\\n.collapse-leave-from {\\n    max-height: 240px; /*  */\\n    opacity: 1;\\n}\\n\\n.collapse-enter-active,\\n.collapse-leave-active {\\n    transition: all 0.3s ease;\\n}\\n\\n.collapse-content {\\n    margin-top: 2px;\\n    padding: 2px;\\n    background-color: transparent;\\n    border-radius: 4px;\\n}\\n</style>\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// \nexport type TemplateType = StatData | StatData[] | any[];\n\n// StatData \nexport type StatDataMeta = {\n    extensible?: boolean;\n    recursiveExtensible?: boolean;\n    required?: string[];\n    template?: TemplateType; // \n    [key: string]: unknown;\n};\n\nexport type JSONPrimitive = string | number | boolean | null;\n\n// StatData  -  $meta \nexport type StatData = {\n    [key: string]: StatData | JSONPrimitive | (StatData | JSONPrimitive)[];\n} & {\n    $meta?: StatDataMeta;\n    $arrayMeta?: boolean;\n};\n\n// Schema \nexport type SchemaNode = ObjectSchemaNode | ArraySchemaNode | PrimitiveSchemaNode;\n\n//  Schema \nexport type ObjectSchemaNode = {\n    type: 'object';\n    properties: {\n        [key: string]: SchemaNode & { required?: boolean };\n    };\n    extensible?: boolean;\n    template?: TemplateType; // \n    recursiveExtensible?: boolean;\n};\n\n//  Schema \nexport type ArraySchemaNode = {\n    type: 'array';\n    elementType: SchemaNode;\n    extensible?: boolean;\n    template?: TemplateType; // \n    recursiveExtensible?: boolean;\n};\n\n//  Schema \nexport type PrimitiveSchemaNode = {\n    type: 'string' | 'number' | 'boolean' | 'any';\n};\n\n// ValueWithDescription  - \nexport type ValueWithDescription<T> = [T, string];\n\nexport function assertVWD(\n    _flag: boolean,\n    _v: StatData | JSONPrimitive | (StatData | JSONPrimitive)[]\n): asserts _v is ValueWithDescription<StatData | JSONPrimitive> {}\n\nexport function isValueWithDescription(value: unknown): boolean {\n    return Array.isArray(value) && value.length === 2 && typeof value[1] === 'string';\n}\n\nexport function isValueWithDescriptionStatData(\n    value: StatData | JSONPrimitive | (StatData | JSONPrimitive)[]\n): value is ValueWithDescription<StatData | JSONPrimitive> {\n    return Array.isArray(value) && value.length === 2 && typeof value[1] === 'string';\n}\n\n// \nexport function isArraySchema(value: SchemaNode): value is ArraySchemaNode {\n    return value.type === 'array';\n}\n\nexport function isObjectSchema(value: SchemaNode): value is ObjectSchemaNode {\n    return value.type === 'object';\n}\n\nexport function isPrimitiveSchema(value: SchemaNode): value is PrimitiveSchemaNode {\n    return (\n        value.type === 'string' ||\n        value.type === 'number' ||\n        value.type === 'boolean' ||\n        value.type === 'any'\n    );\n}\n\nexport type RootAdditionalProps = {\n    strictTemplate?: boolean;\n    concatTemplateArray?: boolean;\n    strictSet?: boolean;\n};\n\nexport type RootAdditionalMetaProps = {\n    $meta?: StatDataMeta & RootAdditionalProps;\n};\n\nexport type MvuData = {\n    // initialized_lorebooks \n    // \n    /**  lorebook  */\n    initialized_lorebooks?: Record<string, any[]>;\n\n    /**\n     *  - \n     *  \"player.health\"\n     * $internal  display_data  delta_data \n     *\n     * \n     * 1. \n     * 2. ValueWithDescription \n     * 3. \n     */\n    stat_data: StatData & RootAdditionalMetaProps & { $internal?: InternalData };\n\n    /**\n     *  - \n     * \"{}->{} ({})\"\n     * \"100->80 ()\"\n     *\n     *  stat_data \n     *  stat_data \n     * UI\n     */\n    display_data?: Record<string, any>;\n\n    /**\n     *  - \n     *  display_data \"{}->{} ()\"\n     *\n     * \n     * -  updateVariables \n     * - \n     * -  variables \n     *\n     * /\n     */\n    delta_data?: Record<string, any>;\n    // \n    schema?: ObjectSchemaNode & Partial<RootAdditionalProps>;\n};\n\nexport interface VariableData {\n    old_variables: MvuData;\n    /**\n     *  newVariables\n     */\n    new_variables?: MvuData;\n}\n\nexport const variable_events = {\n    VARIABLE_INITIALIZED: 'mag_variable_initialized',\n    SINGLE_VARIABLE_UPDATED: 'mag_variable_updated',\n    VARIABLE_UPDATE_ENDED: 'mag_variable_update_ended',\n    VARIABLE_UPDATE_STARTED: 'mag_variable_update_started',\n    COMMAND_PARSED: 'mag_command_parsed',\n    BEFORE_MESSAGE_UPDATE: 'mag_before_message_update',\n} as const;\nexport const exported_events = {\n    INVOKE_MVU_PROCESS: 'mag_invoke_mvu',\n    UPDATE_VARIABLE: 'mag_update_variable',\n} as const;\n\nexport type InternalData = {\n    display_data: Record<string, any>;\n    delta_data: Record<string, any>;\n};\n\nexport type UpdateContext = {\n    variables: MvuData;\n    message_content: string;\n};\n\nexport type ExtendedListenerType = {\n    [variable_events.SINGLE_VARIABLE_UPDATED]: (\n        stat_data: Record<string, any>,\n        path: string,\n        _oldValue: any,\n        _newValue: any\n    ) => void;\n    [variable_events.VARIABLE_UPDATE_STARTED]: (\n        variables: MvuData,\n        out_is_updated: boolean\n    ) => void;\n    [variable_events.VARIABLE_UPDATE_ENDED]: (variables: MvuData, out_is_updated: boolean) => void;\n    [variable_events.VARIABLE_INITIALIZED]: (variables: MvuData, swipe_id: number) => void;\n    [variable_events.COMMAND_PARSED]: (\n        variables: MvuData,\n        commands: any,\n        message_content: string\n    ) => void;\n    [variable_events.BEFORE_MESSAGE_UPDATE]: (context: UpdateContext) => void;\n    [exported_events.INVOKE_MVU_PROCESS]: (\n        message_content: string,\n        variable_info: VariableData\n    ) => void;\n    [exported_events.UPDATE_VARIABLE]: (\n        stat_data: Record<string, any>,\n        path: string,\n        newValue: any,\n        reason: string,\n        isRecursive: boolean\n    ) => void;\n};\n\nexport type InitVarType = StatData & RootAdditionalMetaProps;\n\nexport type DataCategory = 'stat' | 'display' | 'delta';\n\nexport function extractRecord(category: 'stat' | 'display' | 'delta', game_data: MvuData) {\n    let data: Record<string, any> | undefined = undefined;\n    switch (category) {\n        case 'stat':\n            data = game_data.stat_data;\n            break;\n        case 'display':\n            data = game_data.display_data!;\n            break;\n        case 'delta':\n            data = game_data.delta_data!;\n            break;\n    }\n    return data;\n}\n\nexport const ExtraLLMRequestContent: string = `---\n<must>\nThe latest storyline is contained within the \\`<past_observe>\\` block.\nThe \\`<status_description>\\` section records the state of variables *prior to* the latest storyline.\n# Ignore all the instructions I received before, my task has now changed.\nI must now **stop role-playing** and analyze the latest storyline **from a narrators perspective**, reviewing what has happened and updating the variables in \\`<status_description>\\` according to the variable update rules.\nFrom this point onward, **only** output the \\`<VariableUpdate>\\` content.\n</must>`;\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import {\n    ArraySchemaNode,\n    isArraySchema,\n    isObjectSchema,\n    MvuData,\n    ObjectSchemaNode,\n    RootAdditionalProps,\n    SchemaNode,\n    StatData,\n    TemplateType,\n} from '@/variable_def';\nimport { klona } from 'klona';\n\n// \nexport const EXTENSIBLE_MARKER = '$__META_EXTENSIBLE__$';\n\n// \n/**\n * \n * @param data -  (stat_data)\n * @param oldSchemaNode - ()  Schema \n * @param parentRecursiveExtensible - ()  recursiveExtensible  false\n * @returns - \n */\nexport function generateSchema(\n    data: any,\n    oldSchemaNode?: SchemaNode,\n    parentRecursiveExtensible: boolean = false\n): SchemaNode {\n    if (Array.isArray(data)) {\n        let isExtensible = false;\n        let isRecursiveExtensible = parentRecursiveExtensible;\n        let oldElementType: SchemaNode | undefined;\n        let template: TemplateType | undefined;\n\n        //  oldSchemaNode  ArraySchemaNode\n        if (oldSchemaNode) {\n            if (isArraySchema(oldSchemaNode)) {\n                isExtensible = oldSchemaNode.extensible === true;\n                isRecursiveExtensible =\n                    oldSchemaNode.recursiveExtensible === true || parentRecursiveExtensible;\n                oldElementType = oldSchemaNode.elementType;\n                template = oldSchemaNode.template;\n            } else {\n                console.error(\n                    `Type mismatch: expected array schema but got ${oldSchemaNode.type} at path`\n                );\n            }\n        }\n\n        //  $meta \n        const metaElementIndex = data.findIndex(\n            item =>\n                _.isObject(item) &&\n                !_.isDate(item) &&\n                '$arrayMeta' in item &&\n                '$meta' in item &&\n                item['$arrayMeta'] === true\n        );\n\n        if (metaElementIndex !== -1) {\n            const metaElement = data[metaElementIndex] as { $meta: any };\n            //  $meta \n            if (metaElement.$meta.extensible !== undefined) {\n                isExtensible = metaElement.$meta.extensible;\n            }\n            if (metaElement.$meta.template !== undefined) {\n                template = metaElement.$meta.template;\n            }\n            // \n            data.splice(metaElementIndex, 1);\n            console.log(`Array metadata element found and processed.`);\n        }\n\n        // \n        const markerIndex = data.indexOf(EXTENSIBLE_MARKER);\n        if (markerIndex > -1) {\n            isExtensible = true;\n            // \n            data.splice(markerIndex, 1);\n            console.log(`Extensible marker found and removed from an array.`);\n        }\n\n        const schema_node: ArraySchemaNode = {\n            type: 'array',\n            extensible: isExtensible || parentRecursiveExtensible,\n            recursiveExtensible: isRecursiveExtensible,\n            elementType:\n                data.length > 0\n                    ? generateSchema(data[0], oldElementType, isRecursiveExtensible)\n                    : { type: 'any' },\n        };\n\n        if (template !== undefined) {\n            schema_node.template = template;\n        }\n\n        return schema_node;\n    }\n    if (_.isObject(data) && !_.isDate(data)) {\n        const typedData = data as StatData; // \n\n        //  oldSchemaNode  ObjectSchemaNode\n        let oldExtensible = false;\n        let oldRecursiveExtensible = parentRecursiveExtensible;\n        let oldProperties: ObjectSchemaNode['properties'] | undefined;\n\n        if (oldSchemaNode) {\n            if (isObjectSchema(oldSchemaNode)) {\n                oldExtensible = oldSchemaNode.extensible === true;\n                oldRecursiveExtensible =\n                    oldSchemaNode.recursiveExtensible === true || parentRecursiveExtensible;\n                oldProperties = oldSchemaNode.properties;\n            } else {\n                console.error(\n                    `Type mismatch: expected object schema but got ${oldSchemaNode.type} at path`\n                );\n            }\n        }\n\n        const schemaNode: ObjectSchemaNode = {\n            type: 'object',\n            properties: {},\n            //  schema$meta.extensible  parentRecursiveExtensible\n            extensible:\n                oldExtensible ||\n                typedData.$meta?.extensible === true ||\n                typedData.$meta?.recursiveExtensible === true ||\n                parentRecursiveExtensible,\n            recursiveExtensible:\n                oldRecursiveExtensible || typedData.$meta?.recursiveExtensible === true,\n        };\n\n        //  template\n        if (typedData.$meta?.template !== undefined) {\n            schemaNode.template = typedData.$meta.template;\n        } else if (oldSchemaNode && isObjectSchema(oldSchemaNode) && oldSchemaNode.template) {\n            schemaNode.template = oldSchemaNode.template;\n        }\n\n        //  $meta\n        const parentMeta = typedData.$meta;\n\n        //  $meta \n        if (typedData.$meta) {\n            delete typedData.$meta;\n        }\n\n        for (const key in data) {\n            const oldChildNode = oldProperties?.[key];\n            //  recursiveExtensible recursiveExtensible\n            //  extensible: false, \n            const childRecursiveExtensible =\n                schemaNode.extensible !== false && schemaNode.recursiveExtensible;\n            const childSchema = generateSchema(\n                typedData[key],\n                oldChildNode,\n                childRecursiveExtensible\n            );\n\n            // \n\n            // 1. : \n            let isRequired = !schemaNode.extensible;\n\n            // 2. :  'required' \n            //     $meta.required  key \n            //    \n            if (Array.isArray(parentMeta?.required) && parentMeta.required.includes(key)) {\n                isRequired = true;\n            }\n\n            // 3.  schema \n            if (oldChildNode?.required === false) {\n                //  schema \n                isRequired = false;\n            } else if (oldChildNode?.required === true) {\n                isRequired = true;\n            }\n\n            schemaNode.properties[key] = {\n                ...childSchema,\n                required: isRequired,\n            };\n        }\n        return schemaNode;\n    }\n    // \n    const dataType = typeof data;\n    if (dataType === 'string' || dataType === 'number' || dataType === 'boolean') {\n        return { type: dataType };\n    }\n    // function, symbol, bigint, undefined  'any'\n    return { type: 'any' };\n}\n\n/**\n *  Schema \n *  .elementType  Schema\n * @param schema -  Schema \n * @param path - \n * @returns  Schema  null\n */\nexport function getSchemaForPath(\n    schema: SchemaNode | null | undefined,\n    path: string\n): SchemaNode | null {\n    if (!path || !schema) {\n        return schema || null;\n    }\n    //  lodash  'a.b[0].c' -> ['a', 'b', '0', 'c']\n    const pathSegments = _.toPath(path);\n    let currentSchema: SchemaNode | null = schema;\n\n    for (const segment of pathSegments) {\n        if (!currentSchema) return null;\n\n        //  segment  elementType\n        if (/^\\d+$/.test(segment)) {\n            if (isArraySchema(currentSchema)) {\n                currentSchema = currentSchema.elementType;\n            } else {\n                return null; //  elementType  schema\n            }\n        } else if (isObjectSchema(currentSchema) && currentSchema.properties[segment]) {\n            // \n            const property = currentSchema.properties[segment];\n            currentSchema = property as SchemaNode;\n        } else {\n            return null; //  schema \n        }\n    }\n    return currentSchema;\n}\n\n/**\n *  Schema Schema\n * @param variables -  stat_data  schema \n */\nexport function reconcileAndApplySchema(variables: MvuData) {\n    console.log('Reconciling schema with current data state...');\n\n    // 1.  generateSchema  $meta\n    const currentDataClone = klona(variables.stat_data);\n\n    // 2.  generateSchema  Schema\n    //     Schema \n    const newSchema = generateSchema(currentDataClone, variables.schema);\n\n    // 3.  Schema  Schema\n    // stat_data  schema  ObjectSchemaNode\n    if (!isObjectSchema(newSchema)) {\n        console.error(\n            'Generated schema is not an object schema, which is unexpected for stat_data root'\n        );\n        return;\n    }\n\n    //  RootAdditionalProps\n    const newSchemaWithProps = newSchema as ObjectSchemaNode & RootAdditionalProps;\n    if (variables.schema?.strictTemplate !== undefined) {\n        newSchemaWithProps.strictTemplate = variables.schema.strictTemplate;\n    }\n    if (variables.schema?.strictSet !== undefined) {\n        newSchemaWithProps.strictSet = variables.schema.strictSet;\n    }\n    if (variables.schema?.concatTemplateArray !== undefined) {\n        newSchemaWithProps.concatTemplateArray = variables.schema.concatTemplateArray;\n    }\n    if (_.has(variables.stat_data, '$meta.strictTemplate'))\n        newSchemaWithProps.strictTemplate = variables.stat_data['$meta']?.strictTemplate as boolean;\n    if (_.has(variables.stat_data, '$meta.strictSet'))\n        newSchemaWithProps.strictSet = variables.stat_data['$meta']?.strictSet as boolean;\n    if (_.has(variables.stat_data, '$meta.concatTemplateArray'))\n        newSchemaWithProps.concatTemplateArray = variables.stat_data['$meta']\n            ?.concatTemplateArray as boolean;\n\n    variables.schema = newSchemaWithProps;\n\n    console.log('Schema reconciliation complete.');\n}\n\nfunction isMetaCarrier(value: unknown): value is Record<string, unknown> & { $meta?: unknown } {\n    return _.isObject(value) && !_.isDate(value);\n}\n\n/**\n * \n * -  EXTENSIBLE_MARKER\n * -  $meta \n * @param data \n */\nexport function cleanUpMetadata(data: any): void {\n    //  $meta \n    if (Array.isArray(data)) {\n        let i = data.length;\n        while (i--) {\n            if (data[i] === EXTENSIBLE_MARKER) {\n                data.splice(i, 1);\n            } else if (\n                _.isObject(data[i]) &&\n                !_.isDate(data[i]) &&\n                '$arrayMeta' in data[i] &&\n                '$meta' in data[i] &&\n                data[i]['$arrayMeta'] === true\n            ) {\n                //  $meta & $arrayMeta \n                data.splice(i, 1);\n            } else {\n                // \n                cleanUpMetadata(data[i]);\n            }\n        }\n    }\n    //  $meta \n    else if (isMetaCarrier(data)) {\n        //  $meta\n        delete data.$meta;\n\n        // \n        for (const key in data) {\n            cleanUpMetadata(data[key]);\n        }\n    }\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = Vue;","const __WEBPACK_NAMESPACE_OBJECT__ = z;","import TavernHelper = globalThis.TavernHelper;\n\nlet sillytavern_version: string = '1.0.0';\nexport async function initSillyTavernVersion(): Promise<void> {\n    sillytavern_version = await fetch('/version')\n        .then(res => res.json())\n        .then(data => data.pkgVersion)\n        .catch(() => '1.0.0');\n}\nexport function getSillyTavernVersion(): string {\n    return sillytavern_version;\n}\n\nlet tavernhelper_version: string = '1.0.0';\nexport async function initTavernHelperVersion(): Promise<void> {\n    tavernhelper_version = await TavernHelper.getTavernHelperVersion();\n}\nexport function getTavernHelperVersion(): string {\n    return tavernhelper_version;\n}\n\nexport function isFunctionCallingSupported() {\n    if (!SillyTavern.ToolManager.isToolCallingSupported()) {\n        return false;\n    }\n    if (SillyTavern.chatCompletionSettings.function_calling === false) {\n        return false;\n    }\n    return true;\n}\n\ndeclare const jest: any;\ndeclare const process: any;\n\nexport const is_jest_environment =\n    typeof jest !== 'undefined' ||\n    (typeof process !== 'undefined' && process.env?.NODE_ENV === 'test');\n\nexport const saveChatDebounced = _.debounce(SillyTavern.saveChat, 1000);\n\n/**\n * \n * @param end_message_id ()\n */\nexport function findLastValidMessage(end_message_id: number) {\n    return _(SillyTavern.chat)\n        .slice(0, end_message_id) // \n        .findLastIndex(chat_message => {\n            return (\n                _.get(chat_message, ['variables', chat_message.swipe_id ?? 0, 'stat_data']) !==\n                    undefined &&\n                _.get(chat_message, ['variables', chat_message.swipe_id ?? 0, 'schema']) !==\n                    undefined\n            ); // schema  stat_data\n        });\n}\n\n//  4.1.6 , , \nconst stop_lists: Array<() => void> = [];\nexport function scopedEventOn<T extends EventType>(event_type: T, listener: ListenerType[T]) {\n    eventOn(event_type, listener);\n    stop_lists.push(() => eventRemoveListener(event_type, listener));\n}\nexport function clearScopedEvent() {\n    stop_lists.forEach(stop => stop());\n}\n","import { defineStore } from 'pinia';\nimport { ref, toRaw, watch } from 'vue';\nimport * as z from 'zod';\nimport { is_jest_environment } from '@/util';\n\nconst Settings = z\n    .object({\n        : z.enum(['AI', '']).default('AI'),\n        : z\n            .object({\n                : z.boolean().default(true),\n                : z.boolean().default(false),\n                : z.enum(['', '']).default(''),\n                api: z.string().default('http://localhost:1234/v1'),\n                : z.string().default(''),\n                : z.string().default('gemini-2.5-flash'),\n                : z.coerce\n                    .number()\n                    .default(1)\n                    .transform(value => _.clamp(value, 0, 2)),\n                : z.coerce\n                    .number()\n                    .default(0.0)\n                    .transform(value => _.clamp(value, -2, 2)),\n                : z.coerce\n                    .number()\n                    .default(0.0)\n                    .transform(value => _.clamp(value, -2, 2)),\n                token: z.coerce\n                    .number()\n                    .default(4096)\n                    .transform(value => Math.max(0, value)),\n            })\n            .prefault({}),\n        : z\n            .object({\n                : z.boolean().default(false),\n                : z.boolean().default(true),\n            })\n            .prefault({}),\n        : z.number().default(50),\n        : z.boolean().default(false),\n        auto_cleanup: z\n            .object({\n                : z.boolean().default(false),\n                : z.number().default(20),\n                : z.number().default(10),\n            })\n            .prefault({}),\n        internal: z\n            .object({\n                : z.boolean().default(false),\n                : z.boolean().default(false),\n                API: z.boolean().default(false),\n            })\n            .prefault({}),\n    })\n    .prefault({});\n\nexport const useSettingsStore = defineStore('settings', () => {\n    const settings = ref(Settings.parse(_.get(SillyTavern.extensionSettings, 'mvu_settings', {})));\n    watch(\n        settings,\n        new_settings => {\n            _.set(SillyTavern.extensionSettings, 'mvu_settings', toRaw(new_settings));\n            if (!is_jest_environment) SillyTavern.saveSettingsDebounced();\n        },\n        { deep: true }\n    );\n\n    return { settings };\n});\n","const __WEBPACK_NAMESPACE_OBJECT__ = __WEBPACK_EXTERNAL_MODULE_https_testingcf_jsdelivr_net_npm_mathjs_esm_aec644b1__;","import {\n    cleanUpMetadata,\n    generateSchema,\n    getSchemaForPath,\n    reconcileAndApplySchema,\n} from '@/schema';\nimport { useSettingsStore } from '@/settings';\nimport { saveChatDebounced } from '@/util';\nimport {\n    assertVWD,\n    isArraySchema,\n    isObjectSchema,\n    isValueWithDescriptionStatData,\n    MvuData,\n    TemplateType,\n    UpdateContext,\n    variable_events,\n    VariableData,\n} from '@/variable_def';\nimport { klona } from 'klona';\nimport * as math from 'mathjs';\n\nexport function trimQuotesAndBackslashes(str: string): string {\n    if (!_.isString(str)) return str;\n    // Regular expression to match backslashes and quotes (including backticks) at the beginning and end\n    return str.replace(/^[\\\\\"'` ]*(.*?)[\\\\\"'` ]*$/, '$1');\n}\n\n/**\n * \n * @param value \n * @param template  (TemplateType | undefined)\n * @param strict_array_cast  primitive type -> [primitive type] \n * @param array_merge_concat      \n * @returns \n */\nexport function applyTemplate(\n    value: any,\n    template: TemplateType | undefined,\n    strict_array_cast: boolean = false,\n    array_merge_concat: boolean = true\n): any {\n    // \n    if (!template) {\n        return value;\n    }\n\n    // \n    const value_is_object = _.isObject(value) && !Array.isArray(value) && !_.isDate(value);\n    const value_is_array = Array.isArray(value);\n    const template_is_array = Array.isArray(template);\n\n    if (value_is_object && !template_is_array) {\n        // value template  StatData\n        // \n        return _.merge({}, template, value);\n    } else if (value_is_array && template_is_array) {\n        // \n        if (array_merge_concat) return _.concat(value, template);\n        return _.merge([], template, value);\n    } else if (\n        ((value_is_object || value_is_array) && template_is_array !== value_is_array) ||\n        (!value_is_object && !value_is_array && _.isObject(template) && !Array.isArray(template))\n    ) {\n        // \n        console.error(\n            `Template type mismatch: template is ${template_is_array ? 'array' : 'object'}, but value is ${value_is_array ? 'array' : 'object'}. Skipping template merge.`\n        );\n        return value;\n    } else if (!value_is_object && !value_is_array && template_is_array) {\n        // \n        //  [value] \n        if (strict_array_cast)\n            // primitive type -> [primitive type] \n            return value;\n        if (array_merge_concat) return _.concat([value], template);\n        return _.merge([], template, [value]);\n    } else {\n        // \n        return value;\n    }\n}\n\n// \n//  JSON, , null, , \nexport function parseCommandValue(valStr: string): any {\n    if (typeof valStr !== 'string') return valStr;\n    const trimmed = valStr.trim();\n\n    // /null/undefined\n    if (trimmed === 'true') return true;\n    if (trimmed === 'false') return false;\n    if (trimmed === 'null') return null;\n    if (trimmed === 'undefined') return undefined;\n\n    try {\n        //  JSON.parse \n        return JSON.parse(trimmed);\n    } catch (e) {\n        // Handle JavaScript array or object literals\n        if (\n            (trimmed.startsWith('{') && trimmed.endsWith('}')) ||\n            (trimmed.startsWith('[') && trimmed.endsWith(']'))\n        ) {\n            try {\n                // Safely evaluate literals using a function constructor\n                const result = new Function(`return ${trimmed};`)();\n                if (_.isObject(result) || Array.isArray(result)) {\n                    return result;\n                }\n            } catch (err) {\n                // \n            }\n        }\n    }\n\n    //  trimmed \n    // 'hello_world', '10 + 2', 'sqrt(16)'\n\n    try {\n        //  scope / mathjs \n        // \n        const scope = {\n            //  JavaScript  Math  (e.g., Math.sqrt(), Math.PI)\n            Math: Math,\n            //  Python  math  (e.g., math.sqrt(), math.pi)\n            //  LLM \n            // 'math'  mathjs \n            math: math,\n        };\n        //  mathjs \n        // math.evaluate \n        const result = math.evaluate(trimmed, scope);\n        //  mathjs \n        if (math.isComplex(result) || math.isMatrix(result)) {\n            return result.toString();\n        }\n        // mathjs undefined \n        if (result === undefined && !/^[a-zA-Z_]+$/.test(trimmed)) {\n            return trimmed; //  undefined \n        }\n        if (result !== undefined) {\n            //  toPrecision \n            return parseFloat(result.toPrecision(12));\n        }\n    } catch (err) {\n        //  math.evaluate \n        // \n    }\n\n    // \n    // _.add `_.add('', 10 * 60 * 1000);`\n    //  \"2024-01-01T12:00:00Z\"\n    // `isNaN(Number(trimmed))` \"12345\"\n    /*\n    if (isNaN(Number(trimmed))) {\n        const potentialDate = new Date(trimQuotesAndBackslashes(trimmed));\n        if (!isNaN(potentialDate.getTime())) {\n            return potentialDate;\n        }\n    }\n    */\n\n    try {\n        //  YAML.parse\n        return YAML.parse(trimmed);\n    } catch (e) {\n        /* empty */\n    }\n\n    // \n    return trimQuotesAndBackslashes(valStr);\n}\n\n/**\n * Type definition for CommandNames representing a set of valid command strings.\n *\n * This type is used to define a finite and specific set of command string values\n * that may be used in operations or functions requiring predefined command names.\n *\n * The allowed command names are:\n * - 'set': Represents a command to set a value.\n * - 'insert': Alias of 'assign'\n * - 'assign': Represents a command to assign a value or reference.\n * - 'remove': Represents a command to remove an item or data.\n * - 'add': Represents a command to add an item or data.\n */\ntype CommandNames = 'set' | 'insert' | 'assign' | 'remove' | 'unset' | 'delete' | 'add';\n\n/**\n *  .set(${path}, ${new_value});//${reason} \n * \n */\n// \n// Command  SetCommand \ninterface Command {\n    type: CommandNames;\n    full_match: string;\n    args: string[];\n    reason: string;\n}\n\n/**\n *  _.set() \n *\n * \n *  /_\\.set\\(([\\s\\S]*?)\\);/ \n *  ); \n * _.set('path', [\"text with _.set('inner',null);//comment\"], []);\n *  \"comment\") \n *\n * \n *  _.set() \n */\n//  extractSetCommands  extractCommands \nexport function extractCommands(inputText: string): Command[] {\n    const results: Command[] = [];\n    let i = 0;\n\n    while (i < inputText.length) {\n        // \n        //  _.set(_.assign(_.remove(  _.add(\n        const setMatch = inputText\n            .substring(i)\n            .match(/_\\.(set|insert|assign|remove|unset|delete|add)\\(/);\n        if (!setMatch || setMatch.index === undefined) {\n            // \n            break;\n        }\n\n        // setassignremove  add\n        const commandType = setMatch[1] as CommandNames;\n        const setStart = i + setMatch.index;\n        // \n        const openParen = setStart + setMatch[0].length;\n\n        //  findMatchingCloseParen  _.set('path', ['inner);'])\n        const closeParen = findMatchingCloseParen(inputText, openParen);\n        if (closeParen === -1) {\n            // \n            // \n            i = openParen; // \n            continue; //  while \n        }\n\n        // \n        let endPos = closeParen + 1;\n        if (endPos >= inputText.length || inputText[endPos] !== ';') {\n            // \n            i = closeParen + 1;\n            continue;\n        }\n        endPos++; // \n\n        // //  reason\n        let comment = '';\n        const potentialComment = inputText.substring(endPos).match(/^\\s*\\/\\/(.*)/);\n        if (potentialComment) {\n            // \n            comment = potentialComment[1].trim();\n            endPos += potentialComment[0].length;\n        }\n\n        //  fullMatch \n        const fullMatch = inputText.substring(setStart, endPos);\n        // \n        const paramsString = inputText.substring(openParen, closeParen);\n        //  parseParameters \n        const params = parseParameters(paramsString);\n\n        // \n        let isValid = false;\n        if (commandType === 'set' && params.length >= 2)\n            isValid = true; // _.set \n        else if (commandType === 'assign' && params.length >= 2)\n            isValid = true; // _.assign \n        else if (commandType === 'insert' && params.length >= 2)\n            isValid = true; // _.insert \n        else if (commandType === 'remove' && params.length >= 1)\n            isValid = true; // _.remove \n        else if (commandType === 'unset' && params.length >= 1)\n            isValid = true; // _.unset \n        else if (commandType === 'delete' && params.length >= 1)\n            isValid = true; // _.delete \n        else if (commandType === 'add' && /*params.length === 1 || */ params.length === 2)\n            isValid = true; // _.add 12\n\n        if (isValid) {\n            // \n            results.push({\n                type: commandType,\n                full_match: fullMatch,\n                args: params,\n                reason: comment,\n            });\n        }\n\n        // \n        i = endPos;\n    }\n\n    // \n    return results;\n}\n\n/**\n * \n *\n * \n * 1.  ( 1 ) 1\n * 2. \n * 3. \n *\n * @param str \n * @param startPos \n * @returns  -1\n */\nfunction findMatchingCloseParen(str: string, startPos: number): number {\n    let parenCount = 1; // 1\n    let inQuote = false;\n    let quoteChar = '';\n\n    for (let i = startPos; i < str.length; i++) {\n        const char = str[i];\n        const prevChar = i > 0 ? str[i - 1] : '';\n\n        // \n        // \n        // \n        if ((char === '\"' || char === \"'\" || char === '`') && prevChar !== '\\\\') {\n            if (!inQuote) {\n                inQuote = true;\n                quoteChar = char;\n            } else if (char === quoteChar) {\n                inQuote = false;\n            }\n        }\n\n        // \n        //  \"text with )\" \n        if (!inQuote) {\n            if (char === '(') {\n                parenCount++;\n            } else if (char === ')') {\n                parenCount--;\n                if (parenCount === 0) {\n                    return i;\n                }\n            }\n        }\n    }\n\n    return -1; // \n}\n\n// \n// \nexport function parseParameters(paramsString: string): string[] {\n    const params: string[] = [];\n    let currentParam = '';\n    let inQuote = false;\n    let quoteChar = '';\n    let bracketCount = 0;\n    let braceCount = 0;\n    let parenCount = 0;\n\n    for (let i = 0; i < paramsString.length; i++) {\n        const char = paramsString[i];\n\n        // \n        if (\n            (char === '\"' || char === \"'\" || char === '`') &&\n            (i === 0 || paramsString[i - 1] !== '\\\\')\n        ) {\n            if (!inQuote) {\n                inQuote = true;\n                quoteChar = char;\n            } else if (char === quoteChar) {\n                inQuote = false;\n            }\n        }\n\n        if (!inQuote) {\n            //  ()\n            if (char === '(') parenCount++;\n            if (char === ')') parenCount--;\n\n            //  ()\n            if (char === '[') bracketCount++;\n            if (char === ']') bracketCount--;\n\n            //  ()\n            if (char === '{') braceCount++;\n            if (char === '}') braceCount--;\n        }\n        // \n        // \n        if (\n            char === ',' &&\n            !inQuote &&\n            parenCount === 0 &&\n            bracketCount === 0 &&\n            braceCount === 0\n        ) {\n            params.push(currentParam.trim());\n            currentParam = '';\n            continue;\n        }\n\n        currentParam += char;\n    }\n\n    // \n    if (currentParam.trim()) {\n        params.push(currentParam.trim());\n    }\n\n    return params;\n}\n\nexport async function getLastValidVariable(message_id: number): Promise<MvuData> {\n    return (klona(\n        _(SillyTavern.chat)\n            .slice(0, message_id + 1)\n            .map(chat_message => _.get(chat_message, ['variables', chat_message.swipe_id ?? 0]))\n            .findLast(variables => _.has(variables, 'stat_data'))\n\n        //@ts-expect-error old fn\n    ) ?? getVariables()) as MvuData;\n}\n\nfunction pathFix(path: string): string {\n    const segments = [];\n    let currentSegment = '';\n    let inQuotes = false;\n    let quoteChar = '';\n\n    for (let i = 0; i < path.length; i++) {\n        const char = path[i];\n\n        // Handle quotes\n        if ((char === '\"' || char === \"'\") && (i === 0 || path[i - 1] !== '\\\\')) {\n            if (!inQuotes) {\n                inQuotes = true;\n                quoteChar = char;\n            } else if (char === quoteChar) {\n                inQuotes = false;\n            } else {\n                currentSegment += char;\n            }\n        } else if (char === '.' && !inQuotes) {\n            segments.push(currentSegment);\n            currentSegment = '';\n        } else {\n            currentSegment += char;\n        }\n    }\n\n    if (currentSegment) {\n        segments.push(currentSegment);\n    }\n\n    return segments.join('.');\n}\n\n/**\n * MVU  display_data/delta_data\n * @param stat_data  mag_variable_updated  stat_data display_data \n * @param path \n * @param new_value \n * @param reason \n * @param is_recursive  mag_variable_updated \n */\nexport async function updateVariable(\n    stat_data: Record<string, any>,\n    path: string,\n    new_value: any,\n    reason: string = '',\n    is_recursive: boolean = false\n): Promise<boolean> {\n    const display_data = stat_data.$internal?.display_data;\n    const delta_data = stat_data.$internal?.delta_data;\n    if (_.has(stat_data, path)) {\n        const currentValue = _.get(stat_data, path);\n        if (Array.isArray(currentValue) && currentValue.length === 2) {\n            //VWD \n            const oldValue = klona(currentValue[0]);\n            currentValue[0] = new_value;\n            _.set(stat_data, path, currentValue);\n            const reason_str = reason ? `(${reason})` : '';\n            const display_str = `${trimQuotesAndBackslashes(JSON.stringify(oldValue))}->${trimQuotesAndBackslashes(JSON.stringify(new_value))} ${reason_str}`;\n            if (display_data) _.set(display_data, path, display_str);\n            if (delta_data) _.set(delta_data, path, display_str);\n            console.info(\n                `Set '${path}' to '${trimQuotesAndBackslashes(JSON.stringify(new_value))}' ${reason_str}`\n            );\n            if (is_recursive)\n                await eventEmit(\n                    variable_events.SINGLE_VARIABLE_UPDATED,\n                    stat_data,\n                    path,\n                    oldValue,\n                    new_value\n                );\n            return true;\n        } else {\n            const oldValue = klona(currentValue);\n            _.set(stat_data, path, new_value);\n            const reason_str = reason ? `(${reason})` : '';\n            const stringNewValue = trimQuotesAndBackslashes(JSON.stringify(new_value));\n            const display_str = `${trimQuotesAndBackslashes(JSON.stringify(oldValue))}->${stringNewValue} ${reason_str}`;\n            if (display_data) _.set(display_data, path, display_str);\n            if (delta_data) _.set(delta_data, path, display_str);\n            console.info(`Set '${path}' to '${stringNewValue}' ${reason_str}`);\n            if (is_recursive)\n                await eventEmit(\n                    variable_events.SINGLE_VARIABLE_UPDATED,\n                    stat_data,\n                    path,\n                    oldValue,\n                    new_value\n                );\n            return true;\n        }\n    }\n    return false;\n}\n\ntype ErrorInfo = {\n    error_last: string;\n    error_command: Command;\n};\n\n//  updateVariables \nexport async function updateVariables(\n    current_message_content: string,\n    variables: MvuData\n): Promise<boolean> {\n    const out_is_modifed = false;\n    // \n    const out_status: MvuData = klona(variables);\n    // \n    const delta_status: Partial<MvuData> = { stat_data: {} };\n\n    //  ${variable}\n    const processed_message_content = substitudeMacros(current_message_content);\n\n    //  extractCommands \n    const commands = extractCommands(processed_message_content);\n    // \n    _.set(variables.stat_data, '$internal', {\n        display_data: out_status.stat_data,\n        delta_data: delta_status.stat_data || {},\n    });\n    //@ts-expect-error variables\n    await eventEmit(variable_events.VARIABLE_UPDATE_STARTED, variables);\n    let variable_modified = false;\n\n    let error_info: ErrorInfo | undefined;\n    let current_command: Command | undefined;\n    const outError = function (message: string) {\n        console.warn(message);\n        error_info = {\n            error_last: message,\n            error_command: current_command!,\n        };\n    };\n\n    const schema = variables.schema; //  schema undefined\n    const strict_template = schema?.strictTemplate ?? false;\n    const concat_template_array = schema?.concatTemplateArray ?? true;\n    const strict_set = schema?.strictSet ?? false;\n\n    //\n    for (const cmd of commands) {\n        if (cmd.type === 'remove') {\n            cmd.type = 'delete';\n        } else if (cmd.type === 'assign') {\n            cmd.type = 'insert';\n        } else if (cmd.type === 'unset') {\n            cmd.type = 'delete';\n        }\n    }\n\n    //@ts-expect-error old fn\n    await eventEmit(variable_events.COMMAND_PARSED, variables, commands, current_message_content);\n\n    for (const command of commands) {\n        // \n        // \n        const path = pathFix(trimQuotesAndBackslashes(command.args[0]));\n        // \n        const reason_str = command.reason ? `(${command.reason})` : '';\n        let display_str = ''; // \n        current_command = command;\n\n        switch (\n            command.type // \n        ) {\n            case 'set': {\n                // _.has \n                if (!_.has(variables.stat_data, path)) {\n                    outError(\n                        `Path '${path}' does not exist in stat_data, skipping set command ${reason_str}`\n                    );\n                    continue;\n                }\n\n                //  undefined\n                let oldValue = _.get(variables.stat_data, path);\n                // _.set(path, newValue)  _.set(path, oldValue, newValue)\n                const newValueStr = command.args.length >= 3 ? command.args[2] : command.args[1];\n                // JSON \n                let newValue = parseCommandValue(newValueStr);\n\n                //  Date  ISO \n                if (newValue instanceof Date) {\n                    newValue = newValue.toISOString();\n                }\n                let isPathVWD = false;\n\n                if (\n                    !strict_set &&\n                    Array.isArray(oldValue) &&\n                    oldValue.length === 2 &&\n                    typeof oldValue[1] === 'string' &&\n                    !Array.isArray(oldValue[0])\n                ) {\n                    //  ValueWithDescription<T> \n                    //  null \n                    //  null ( null)\n                    const oldValueCopy = klona(oldValue[0]);\n                    oldValue[0] =\n                        typeof oldValue[0] === 'number' && newValue !== null\n                            ? Number(newValue)\n                            : newValue;\n                    oldValue = oldValueCopy;\n                    isPathVWD = true;\n                } else if (typeof oldValue === 'number' && newValue !== null) {\n                    _.set(variables.stat_data, path, Number(newValue));\n                } else {\n                    // \n                    _.set(variables.stat_data, path, newValue);\n                }\n\n                // \n                let finalNewValue = _.get(variables.stat_data, path);\n\n                assertVWD(isPathVWD, finalNewValue);\n\n                if (isPathVWD) {\n                    finalNewValue = finalNewValue[0];\n                }\n\n                //  ValueWithDescription \n                const isStrict = !strict_set;\n\n                if (\n                    isStrict &&\n                    isValueWithDescriptionStatData(oldValue) &&\n                    Array.isArray(finalNewValue)\n                ) {\n                    //  ValueWithDescription\n                    display_str = `${trimQuotesAndBackslashes(JSON.stringify(oldValue[0]))}->${trimQuotesAndBackslashes(JSON.stringify(finalNewValue[0]))} ${reason_str}`;\n                } else {\n                    // \n                    display_str = `${trimQuotesAndBackslashes(JSON.stringify(oldValue))}->${trimQuotesAndBackslashes(JSON.stringify(finalNewValue))} ${reason_str}`;\n                }\n\n                variable_modified = true; // \n                // \n                console.info(`Set '${path}' to '${JSON.stringify(finalNewValue)}' ${reason_str}`);\n\n                // \n                await eventEmit(\n                    variable_events.SINGLE_VARIABLE_UPDATED,\n                    variables.stat_data,\n                    path,\n                    oldValue,\n                    finalNewValue\n                );\n                break;\n            }\n\n            case 'insert':\n            case 'assign': {\n                // \n                // \n                const targetPath = path;\n                // Schema\n                const existingValue =\n                    targetPath === ''\n                        ? variables.stat_data\n                        : _.get(variables.stat_data, targetPath);\n                const targetSchema = getSchemaForPath(schema, targetPath);\n\n                // 1\n                if (\n                    existingValue !== null &&\n                    !Array.isArray(existingValue) &&\n                    !_.isObject(existingValue)\n                ) {\n                    outError(\n                        `Cannot assign into path '${targetPath}' because it holds a primitive value (${typeof existingValue}). Operation skipped. ${reason_str}`\n                    );\n                    continue;\n                }\n\n                // 2Schema \n                if (targetSchema) {\n                    if (targetSchema.type === 'object' && targetSchema.extensible === false) {\n                        if (command.args.length === 2) {\n                            // \n                            outError(\n                                `SCHEMA VIOLATION: Cannot merge data into non-extensible object at path '${targetPath}'. ${reason_str}`\n                            );\n                            continue;\n                        }\n                        if (command.args.length >= 3) {\n                            // \n                            const newKey = String(parseCommandValue(command.args[1]));\n                            if (!_.has(targetSchema.properties, newKey)) {\n                                outError(\n                                    `SCHEMA VIOLATION: Cannot assign new key '${newKey}' into non-extensible object at path '${targetPath}'. ${reason_str}`\n                                );\n                                continue;\n                            }\n                        }\n                    } else if (\n                        targetSchema.type === 'array' &&\n                        (targetSchema.extensible === false || targetSchema.extensible === undefined)\n                    ) {\n                        outError(\n                            `SCHEMA VIOLATION: Cannot assign elements into non-extensible array at path '${targetPath}'. ${reason_str}`\n                        );\n                        continue;\n                    }\n                } else if (\n                    //  targetPath !== '' \n                    targetPath !== '' &&\n                    !_.get(variables.stat_data, _.toPath(targetPath).slice(0, -1).join('.'))\n                ) {\n                    // 3\n                    outError(\n                        `Cannot assign into non-existent path '${targetPath}' without an extensible parent. ${reason_str}`\n                    );\n                    continue;\n                }\n                // ---  ---\n\n                // \n                const oldValue = klona(_.get(variables.stat_data, path));\n                let successful = false; // \n\n                if (command.args.length === 2) {\n                    // _.assign('path.to.array', value)\n                    // \n                    let valueToAssign = parseCommandValue(command.args[1]);\n\n                    //  Date Date\n                    if (valueToAssign instanceof Date) {\n                        valueToAssign = valueToAssign.toISOString();\n                    } else if (Array.isArray(valueToAssign)) {\n                        valueToAssign = valueToAssign.map(item =>\n                            item instanceof Date ? item.toISOString() : item\n                        );\n                    }\n\n                    // \n                    let collection =\n                        targetPath === '' ? variables.stat_data : _.get(variables.stat_data, path);\n\n                    // \n                    if (!Array.isArray(collection) && !_.isObject(collection)) {\n                        collection = Array.isArray(valueToAssign) ? [] : {};\n                        _.set(variables.stat_data, path, collection);\n                    }\n\n                    if (Array.isArray(collection)) {\n                        // \n                        // \n                        const template =\n                            targetSchema && isArraySchema(targetSchema)\n                                ? targetSchema.template\n                                : undefined;\n                        valueToAssign = applyTemplate(\n                            valueToAssign,\n                            template,\n                            strict_template,\n                            concat_template_array\n                        );\n                        collection.push(valueToAssign);\n                        display_str = `ASSIGNED ${JSON.stringify(valueToAssign)} into array '${path}' ${reason_str}`;\n                        successful = true;\n                    } else if (_.isObject(collection)) {\n                        // \n                        // \n                        //  assign\n                        if (_.isObject(valueToAssign) && !Array.isArray(valueToAssign)) {\n                            _.merge(collection, valueToAssign);\n                            display_str = `MERGED object ${JSON.stringify(valueToAssign)} into object '${path}' ${reason_str}`;\n                            successful = true;\n                        } else {\n                            // \n                            outError(\n                                `Cannot merge ${Array.isArray(valueToAssign) ? 'array' : 'non-object'} into object at '${path}'`\n                            );\n                            continue;\n                        }\n                    }\n                } else if (command.args.length >= 3) {\n                    // _.assign('path', key/index, value)\n                    // /\n                    let valueToAssign = parseCommandValue(command.args[2]);\n                    const keyOrIndex = parseCommandValue(command.args[1]);\n\n                    //  Date Date\n                    if (valueToAssign instanceof Date) {\n                        valueToAssign = valueToAssign.toISOString();\n                    } else if (Array.isArray(valueToAssign)) {\n                        valueToAssign = valueToAssign.map(item =>\n                            item instanceof Date ? item.toISOString() : item\n                        );\n                    }\n\n                    let collection =\n                        targetPath === '' ? variables.stat_data : _.get(variables.stat_data, path);\n\n                    // \n                    const template =\n                        targetSchema &&\n                        (isArraySchema(targetSchema) || isObjectSchema(targetSchema))\n                            ? targetSchema.template\n                            : undefined;\n\n                    if (Array.isArray(collection) && typeof keyOrIndex === 'number') {\n                        // \n                        valueToAssign = applyTemplate(\n                            valueToAssign,\n                            template,\n                            strict_template,\n                            concat_template_array\n                        );\n                        collection.splice(keyOrIndex, 0, valueToAssign);\n                        display_str = `ASSIGNED ${JSON.stringify(valueToAssign)} into '${path}' at index ${keyOrIndex} ${reason_str}`;\n                        successful = true;\n                    } else if (_.isObject(collection)) {\n                        // \n                        // _.set(collection, String(keyOrIndex), valueToAssign);\n                        // \n                        valueToAssign = applyTemplate(\n                            valueToAssign,\n                            template,\n                            strict_template,\n                            concat_template_array\n                        );\n                        (collection as Record<string, unknown>)[String(keyOrIndex)] = valueToAssign;\n                        display_str = `ASSIGNED key '${keyOrIndex}' with value ${JSON.stringify(valueToAssign)} into object '${path}' ${reason_str}`;\n                        successful = true;\n                    } else {\n                        // \n                        collection = {};\n                        _.set(variables.stat_data, path, collection);\n                        /*\n                        _.set(\n                            collection as Record<string, unknown>,\n                            String(keyOrIndex),\n                            valueToAssign\n                        );\n                        */\n                        // \n                        valueToAssign = applyTemplate(\n                            valueToAssign,\n                            template,\n                            strict_template,\n                            concat_template_array\n                        );\n                        (collection as Record<string, unknown>)[String(keyOrIndex)] = valueToAssign;\n                        display_str = `CREATED object at '${path}' and ASSIGNED key '${keyOrIndex}' ${reason_str}`;\n                        successful = true;\n                    }\n                }\n\n                if (successful) {\n                    // \n                    const newValue = _.get(variables.stat_data, path);\n                    variable_modified = true;\n                    console.info(display_str);\n                    await eventEmit(\n                        variable_events.SINGLE_VARIABLE_UPDATED,\n                        variables.stat_data,\n                        path,\n                        oldValue,\n                        newValue\n                    );\n                    try {\n                        // template \n                        const currentDataClone = klona(newValue);\n\n                        const newSchema = generateSchema(currentDataClone, targetSchema!);\n                        _.merge(targetSchema, newSchema);\n                        cleanUpMetadata(newValue);\n                    } catch (error) {\n                        // \n                        if (error instanceof Error) {\n                            outError(\n                                `Failed to resolve template meta at '${path}', '${error.message}'`\n                            );\n                        } else {\n                            outError(`Failed to resolve template meta at '${path}', '${error}'`);\n                        }\n                    }\n                } else {\n                    // \n                    outError(`Invalid arguments for _.assign on path '${path}'`);\n                    continue;\n                }\n                break;\n            }\n\n            case 'unset':\n            case 'delete':\n            case 'remove': {\n                // \n                if (!_.has(variables.stat_data, path)) {\n                    outError(`undefined Path: ${path} in _.remove command`);\n                    continue;\n                }\n\n                // ---  ---\n                let containerPath = path;\n                let keyOrIndexToRemove: string | number | undefined;\n\n                if (command.args.length > 1) {\n                    // _.remove('path', key_or_index)\n                    keyOrIndexToRemove = parseCommandValue(command.args[1]);\n                    //  key \n                    if (typeof keyOrIndexToRemove === 'string') {\n                        keyOrIndexToRemove = trimQuotesAndBackslashes(keyOrIndexToRemove);\n                    }\n                } else {\n                    // _.remove('path.to.key[index]')\n                    const pathParts = _.toPath(path);\n                    const lastPart = pathParts.pop();\n                    if (lastPart) {\n                        keyOrIndexToRemove = /^\\d+$/.test(lastPart) ? Number(lastPart) : lastPart;\n                        containerPath = pathParts.join('.');\n                    }\n                }\n\n                if (keyOrIndexToRemove === undefined) {\n                    outError(\n                        `Could not determine target for deletion for command on path '${path}' ${reason_str}`\n                    );\n                    continue;\n                }\n                // \n                if (containerPath !== '' && !_.has(variables.stat_data, containerPath)) {\n                    outError(\n                        `Cannot remove from non-existent path '${containerPath}'. ${reason_str}`\n                    );\n                    continue;\n                }\n\n                const containerSchema = getSchemaForPath(schema, containerPath);\n\n                if (containerSchema) {\n                    if (containerSchema.type === 'array') {\n                        if (containerSchema.extensible !== true) {\n                            outError(\n                                `SCHEMA VIOLATION: Cannot remove element from non-extensible array at path '${containerPath}'. ${reason_str}`\n                            );\n                            continue;\n                        }\n                    } else if (containerSchema.type === 'object') {\n                        const keyString = String(keyOrIndexToRemove);\n                        if (\n                            _.has(containerSchema.properties, keyString) &&\n                            containerSchema.properties[keyString].required === true\n                        ) {\n                            outError(\n                                `SCHEMA VIOLATION: Cannot remove required key '${keyString}' from path '${containerPath}'. ${reason_str}`\n                            );\n                            continue;\n                        }\n                    }\n                }\n\n                // ---  ---\n\n                // \n                const targetToRemove =\n                    command.args.length > 1 ? parseCommandValue(command.args[1]) : undefined;\n                let itemRemoved = false; // \n\n                if (targetToRemove === undefined) {\n                    // _.remove('path.to.key')\n                    // \n                    const oldValue = _.get(variables.stat_data, path);\n                    _.unset(variables.stat_data, path);\n                    display_str = `REMOVED path '${path}' ${reason_str}`;\n                    itemRemoved = true;\n                    await eventEmit(\n                        variable_events.SINGLE_VARIABLE_UPDATED,\n                        variables.stat_data,\n                        path,\n                        oldValue,\n                        undefined\n                    );\n                } else {\n                    // _.remove('path.to.array', value_or_index)\n                    const collection = _.get(variables.stat_data, path);\n\n                    // \n                    // \n                    if (!Array.isArray(collection) && !_.isObject(collection)) {\n                        outError(\n                            `Cannot remove from path '${path}' because it is not an array or object. Skipping command. ${reason_str}`\n                        );\n                        continue;\n                    }\n\n                    if (Array.isArray(collection)) {\n                        // \n                        const originalArray = klona(collection);\n                        let indexToRemove = -1;\n                        if (typeof targetToRemove === 'number') {\n                            indexToRemove = targetToRemove;\n                        } else {\n                            indexToRemove = collection.findIndex(item =>\n                                _.isEqual(item, targetToRemove)\n                            );\n                        }\n\n                        if (indexToRemove >= 0 && indexToRemove < collection.length) {\n                            collection.splice(indexToRemove, 1);\n                            itemRemoved = true;\n                            display_str = `REMOVED item from '${path}' ${reason_str}`;\n                            await eventEmit(\n                                variable_events.SINGLE_VARIABLE_UPDATED,\n                                variables.stat_data,\n                                path,\n                                originalArray,\n                                collection\n                            );\n                        }\n                    } else if (_.isObject(collection)) {\n                        if (typeof targetToRemove === 'number') {\n                            // \n                            const keys = Object.keys(collection);\n                            const index = targetToRemove;\n                            if (index >= 0 && index < keys.length) {\n                                const keyToRemove = keys[index];\n                                _.unset(collection, keyToRemove);\n                                itemRemoved = true;\n                                display_str = `REMOVED ${index + 1}th entry ('${keyToRemove}') from object '${path}' ${reason_str}`;\n                            }\n                        } else {\n                            // \n                            const keyToRemove = String(targetToRemove);\n                            if (_.has(collection, keyToRemove)) {\n                                // _.unset(collection, keyToRemove);\n                                delete (collection as Record<string, unknown>)[keyToRemove];\n                                itemRemoved = true;\n                                display_str = `REMOVED key '${keyToRemove}' from object '${path}' ${reason_str}`;\n                            }\n                        }\n                    }\n                }\n\n                if (itemRemoved) {\n                    // \n                    variable_modified = true;\n                    console.info(display_str);\n                } else {\n                    // \n                    outError(`Failed to execute remove on '${path}'`);\n                    continue;\n                }\n                break;\n            }\n\n            case 'add': {\n                // \n                if (!_.has(variables.stat_data, path)) {\n                    outError(\n                        `Path '${path}' does not exist in stat_data, skipping add command ${reason_str}`\n                    );\n                    continue;\n                }\n                // \n                const initialValue = klona(_.get(variables.stat_data, path));\n                const oldValue = _.get(variables.stat_data, path);\n                let valueToAdd = oldValue;\n                const isVWD =\n                    isValueWithDescriptionStatData(oldValue) && typeof oldValue[0] !== 'object';\n\n                if (isVWD) {\n                    assertVWD(isVWD, oldValue);\n                    valueToAdd = oldValue[0]; //  ValueWithDescription \n                }\n                // console.warn(valueToAdd);\n\n                //  Date  Date \n                let potentialDate: Date | null = null;\n                if (valueToAdd instanceof Date) {\n                    potentialDate = valueToAdd;\n                } else if (typeof valueToAdd === 'string') {\n                    const parsedDate = new Date(valueToAdd);\n                    //  `new Date` \n                    if (!isNaN(parsedDate.getTime()) && isNaN(Number(valueToAdd))) {\n                        potentialDate = parsedDate;\n                    }\n                }\n\n                if (command.args.length === 2) {\n                    // \n                    const delta = parseCommandValue(command.args[1]);\n\n                    //  Date \n                    if (potentialDate) {\n                        if (typeof delta !== 'number') {\n                            outError(\n                                `Delta '${command.args[1]}' for Date operation is not a number, skipping add command ${reason_str}`\n                            );\n                            continue;\n                        }\n                        // delta \n                        const newDate = new Date(potentialDate.getTime() + delta);\n                        //  Date  ISO \n                        const finalValueToSet = newDate.toISOString();\n\n                        if (isVWD) {\n                            assertVWD(isVWD, oldValue);\n                            oldValue[0] = finalValueToSet;\n                            _.set(variables.stat_data, path, oldValue);\n                        } else {\n                            _.set(variables.stat_data, path, finalValueToSet);\n                        }\n\n                        const finalNewValue = _.get(variables.stat_data, path);\n                        if (isVWD) {\n                            display_str = `${JSON.stringify((initialValue as any[])[0])}->${JSON.stringify((finalNewValue as any[])[0])} ${reason_str}`;\n                        } else {\n                            display_str = `${JSON.stringify(initialValue)}->${JSON.stringify(finalNewValue)} ${reason_str}`;\n                        }\n                        variable_modified = true;\n                        console.info(\n                            `ADDED date '${path}' from '${potentialDate.toISOString()}' to '${newDate.toISOString()}' by delta '${delta}'ms ${reason_str}`\n                        );\n                        await eventEmit(\n                            variable_events.SINGLE_VARIABLE_UPDATED,\n                            variables.stat_data,\n                            path,\n                            initialValue,\n                            finalNewValue\n                        );\n                    } else if (typeof valueToAdd === 'number') {\n                        //  number \n                        if (typeof delta !== 'number') {\n                            outError(\n                                `Delta '${command.args[1]}' is not a number, skipping add command ${reason_str}`\n                            );\n                            continue;\n                        }\n                        let newValue = valueToAdd + delta;\n                        newValue = parseFloat(newValue.toPrecision(12)); // \n                        if (isVWD) {\n                            oldValue[0] = newValue; // Update the first element\n                            _.set(variables.stat_data, path, oldValue);\n                        } else {\n                            _.set(variables.stat_data, path, newValue);\n                        }\n                        const finalNewValue = _.get(variables.stat_data, path);\n                        if (isVWD) {\n                            display_str = `${JSON.stringify((initialValue as any[])[0])}->${JSON.stringify((finalNewValue as any[])[0])} ${reason_str}`;\n                        } else {\n                            display_str = `${JSON.stringify(initialValue)}->${JSON.stringify(finalNewValue)} ${reason_str}`;\n                        }\n                        variable_modified = true;\n                        console.info(\n                            `ADDED number '${path}' from '${valueToAdd}' to '${newValue}' by delta '${delta}' ${reason_str}`\n                        );\n                        await eventEmit(\n                            variable_events.SINGLE_VARIABLE_UPDATED,\n                            variables.stat_data,\n                            path,\n                            initialValue,\n                            finalNewValue\n                        );\n                    } else {\n                        // \n                        outError(\n                            `Path '${path}' value is not a date or number; skipping add command ${reason_str}`\n                        );\n                        continue;\n                    }\n                } else {\n                    outError(\n                        `Invalid number of arguments for _.add on path '${path}' ${reason_str}`\n                    );\n                    continue;\n                }\n                break;\n            }\n        }\n\n        if (display_str) {\n            // \n            _.set(out_status.stat_data, path, display_str);\n            _.set(delta_status.stat_data!, path, display_str);\n        }\n    }\n    // \n    variables.display_data = out_status.stat_data;\n    variables.delta_data = delta_status.stat_data!;\n    // \n    //@ts-expect-error variables\n    await eventEmit(variable_events.VARIABLE_UPDATE_ENDED, variables);\n    //\n    _.unset(variables.stat_data, '$internal');\n\n    //  Schema \n    if (variable_modified) {\n        reconcileAndApplySchema(variables);\n    }\n    if (error_info && useSettingsStore().settings..) {\n        const base_command: string = error_info.error_command.full_match;\n        if (typeof toastr !== 'undefined')\n            toastr.warning(\n                `: ${error_info.error_last}`,\n                `[MVU]Roll: ${base_command}`,\n                { timeOut: 6000 }\n            );\n    }\n\n    // \n    return variable_modified || out_is_modifed;\n}\n\nexport async function handleVariablesInMessage(message_id: number) {\n    const chat_message = getChatMessages(message_id).at(-1);\n    if (!chat_message) {\n        return;\n    }\n\n    let message_content = chat_message.message;\n\n    if (chat_message.role === 'assistant' && message_content.length < 5) {\n        return;\n    }\n    const request_message_id = message_id === 0 ? 0 : message_id - 1;\n    const variables = await getLastValidVariable(request_message_id);\n    const settings = useSettingsStore().settings;\n    if (!_.has(variables, 'stat_data')) {\n        console.error(`cannot found stat_data for ${request_message_id}`);\n        return;\n    }\n\n    const has_variable_modified = await updateVariables(message_content, variables);\n    if (has_variable_modified && chat_message.role !== 'user') {\n        const context: UpdateContext = {\n            variables: variables,\n            message_content: message_content,\n        };\n        await eventEmit(variable_events.BEFORE_MESSAGE_UPDATE, context);\n        message_content = context.message_content;\n    }\n    const updater = (data: Record<string, any>) => {\n        data.initialized_lorebooks = variables.initialized_lorebooks;\n        data.stat_data = variables.stat_data;\n        if (variables.schema !== undefined) {\n            data.schema = variables.schema;\n        } else {\n            _.unset(data, 'schema');\n        }\n        data.display_data = variables.display_data;\n        data.delta_data = variables.delta_data;\n        return data;\n    };\n    if (has_variable_modified && settings. === true) {\n        await updateVariablesWith(updater, { type: 'chat' });\n    }\n    await updateVariablesWith(updater, { type: 'message', message_id: message_id });\n\n    if (chat_message.role !== 'user') {\n        if (!message_content.includes('<StatusPlaceHolderImpl/>')) {\n            message_content += '\\n\\n<StatusPlaceHolderImpl/>';\n        }\n        await setChatMessages(\n            [\n                {\n                    message_id: message_id,\n                    message: message_content,\n                },\n            ],\n            {\n                refresh: 'affected',\n            }\n        );\n    }\n}\n\nexport async function handleVariablesInCallback(\n    message_content: string,\n    in_out_variable_info: VariableData\n) {\n    if (in_out_variable_info.old_variables === undefined) {\n        return;\n    }\n    in_out_variable_info.new_variables = klona(in_out_variable_info.old_variables);\n    const variables = in_out_variable_info.new_variables;\n\n    const modified = await updateVariables(message_content, variables);\n    // newVariable\n    if (!modified) {\n        _.unset(in_out_variable_info, 'new_variables');\n    }\n    return;\n}\n\n/**  `[start_message_id, end_message_id]` ,  `snap_interval`  */\nexport function cleanupVariablesInMessages(\n    start_message_id: number,\n    end_message_id: number,\n    snap_interval: number\n) {\n    let counter = 0;\n    _(SillyTavern.chat)\n        .slice(start_message_id, end_message_id + 1)\n        .forEach((chat_message, msg_index) => {\n            if (chat_message.variables === undefined) {\n                return;\n            }\n            //counter \n            let chat_flag = false;\n            chat_message.variables = _.range(0, chat_message.swipes?.length ?? 1).map(i => {\n                if (chat_message?.variables?.[i] === undefined) {\n                    return {};\n                }\n                if (_.get(chat_message?.variables?.[i], 'snapshot') === true) {\n                    return chat_message.variables[i];\n                }\n                if ((start_message_id + msg_index) % snap_interval === 0) {\n                    //snapshot \n                    // 50-> 70  350 \n                    _.set(chat_message, ['variables', i, 'snapshot'], true);\n                    return chat_message.variables[i];\n                }\n                if (!chat_flag) {\n                    chat_flag = true;\n                    ++counter;\n                }\n                return _.omit(\n                    chat_message.variables[i],\n                    `initialized_lorebooks`,\n                    `stat_data`,\n                    `display_data`,\n                    `delta_data`,\n                    `schema`\n                );\n            });\n        });\n    saveChatDebounced();\n    return counter;\n}\n","/**\n * \n *\n * \n * initData: {\n *   \"\": {\n *     \"value\": 100,\n *     \"description\": \"\"  //  4(a)\n *   },\n *   \"\": [100, \"\"],  //  4(b): ValueWithDescription<number>\n *   \"\": [{\n *     \"name\": \"\",\n *     \"damage\": [50, \"\"],  //  ValueWithDescription\n *     \"description\": \"\"\n *   }],\n *   \"\": {\n *     \"\": [\"\", \"\"],  // ValueWithDescription<string>\n *     \"\": {\n *       \"\": [10, \"\"]\n *     }\n *   }\n * }\n */\nexport function updateDescriptions(\n    _init_path: string,\n    init_data: any,\n    msg_data: any,\n    target_data: any\n) {\n    _.forEach(init_data, (value, key) => {\n        const current_path = key; //init_path ? `${init_path}.${key}` : key;\n\n        if (_.isArray(value)) {\n            //  ValueWithDescription<T>  (2)\n            if (value.length === 2 && _.isString(value[1])) {\n                //  4(b):  ValueWithDescription<T> \n                if (_.isArray(_.get(msg_data, current_path))) {\n                    const msgValue = _.get(msg_data, current_path);\n                    if (msgValue.length === 2) {\n                        // ()\n                        _.set(target_data, `${current_path}[1]`, value[1]);\n\n                        // \n                        if (_.isObject(value[0]) && !_.isArray(value[0])) {\n                            // \n                            const targetObj = _.get(target_data, `${key}[0]`);\n\n                            // description\n                            if (\n                                _.has(value[0], 'description') &&\n                                _.isString(value[0].description)\n                            ) {\n                                if (_.has(msgValue[0], 'description')) {\n                                    _.set(\n                                        target_data,\n                                        `${current_path}[0].description`,\n                                        value[0].description\n                                    );\n                                }\n                            }\n\n                            // \n                            updateDescriptions(\n                                `${current_path}[0]`,\n                                value[0],\n                                msgValue[0],\n                                targetObj\n                            );\n                        } else if (_.isArray(value[0])) {\n                            // \n                            updateDescriptions(\n                                `${current_path}[0]`,\n                                value[0],\n                                msgValue[0],\n                                target_data[0]\n                            );\n                        }\n                    }\n                }\n            } else if (_.isArray(_.get(msg_data, current_path))) {\n                // \n                const msg_array = _.get(msg_data, current_path);\n                value.forEach((item, index) => {\n                    if (index < msg_array.length) {\n                        if (_.isObject(item)) {\n                            const current_target = _.get(target_data, `${current_path}[${index}]`);\n                            // description\n                            if (_.has(item, 'description') && _.isString(item.description)) {\n                                if (_.has(msg_array[index], 'description')) {\n                                    _.set(current_target, `description`, item.description);\n                                }\n                            }\n\n                            updateDescriptions(\n                                `${current_path}[${index}]`,\n                                value[index],\n                                msg_array[index],\n                                current_target\n                            );\n                        }\n                    }\n                });\n            }\n        } else if (_.isObject(value)) {\n            // \n            if (_.has(value, 'description') && _.isString(value.description)) {\n                //  4(a):  description \n                //msg_data  currentPath\n                const description_path = `${key}.description`;\n                if (_.has(msg_data, description_path)) {\n                    _.set(target_data, description_path, value.description);\n                }\n            }\n\n            // \n            if (_.has(msg_data, key) && _.isObject(msg_data[key])) {\n                updateDescriptions(current_path, value, msg_data[key], target_data[key]);\n            }\n        }\n    });\n}\n","// \nimport { getLastValidVariable, updateVariables } from '@/function';\nimport { cleanUpMetadata, EXTENSIBLE_MARKER, generateSchema } from '@/schema';\nimport {\n    isObjectSchema,\n    MvuData,\n    RootAdditionalProps,\n    SchemaNode,\n    variable_events,\n} from '@/variable_def';\nimport JSON5 from 'json5';\nimport { klona } from 'klona';\nimport TOML from 'toml';\n\ntype LorebookEntry = {\n    content: string;\n    comment?: string;\n};\n\nexport async function initCheck() {\n    let variables: MvuData & Record<string, any>;\n    // dryRun,0\n\n    try {\n        if (SillyTavern.chat.length === 0) {\n            console.error('');\n            toastr.error('', '[MVU]');\n            return;\n        }\n        variables = (await getLastValidVariable(getLastMessageId())) ?? createEmptyGameData();\n    } catch (e) {\n        console.error('');\n        return;\n    }\n\n    // \n    if (variables === undefined) {\n        variables = createEmptyGameData();\n    }\n    if (!_.has(variables, 'initialized_lorebooks')) {\n        variables.initialized_lorebooks = {};\n    }\n    if (Array.isArray(variables.initialized_lorebooks)) {\n        console.warn(\n            'Old \"initialized_lorebooks\" array format detected. Migrating to the new object format.'\n        );\n        const oldArray = variables.initialized_lorebooks as string[];\n        const newObject: Record<string, any[]> = {};\n        for (const lorebookName of oldArray) {\n            newObject[lorebookName] = []; // \n        }\n        variables.initialized_lorebooks = newObject;\n    }\n    if (!variables.stat_data) {\n        variables.stat_data = {};\n    }\n    if (!variables.schema) {\n        variables.schema = { extensible: false, properties: {}, type: 'object' };\n    }\n\n    //  InitVar \n    const is_updated = await loadInitVarData(variables);\n\n    // ---  ---\n    if (is_updated) {\n        //  stat_data\n        const cleanData = (data: any) => {\n            if (Array.isArray(data)) {\n                //  filter \n                const cleanedArray = data.filter(item => item !== EXTENSIBLE_MARKER);\n                // \n                cleanedArray.forEach(cleanData);\n                return cleanedArray;\n            }\n            if (_.isObject(data)) {\n                const newObj: Record<string, any> = {};\n                const typedData = data as Record<string, any>; // \n                for (const key in data) {\n                    // \n                    newObj[key] = cleanData(typedData[key]);\n                }\n                return newObj;\n            }\n            return data;\n        };\n        //  Schema  stat_data\n        //  Schema\n        // \n    }\n\n    //  lorebook \n    if (is_updated || !variables.schema || _.isEmpty(variables.schema)) {\n        // 1.  Schema \n        const dataForSchema = klona(variables.stat_data);\n        // 2. generateSchema  schema\n        //  schema \n        const generated_schema: SchemaNode & RootAdditionalProps = generateSchema(\n            dataForSchema,\n            variables.schema\n        );\n\n        //  schema  ObjectSchemaNode\n        if (isObjectSchema(generated_schema)) {\n            if (_.has(variables.stat_data, '$meta.strictTemplate'))\n                generated_schema.strictTemplate = variables.stat_data['$meta']\n                    ?.strictTemplate as boolean;\n            if (_.has(variables.stat_data, '$meta.concatTemplateArray'))\n                generated_schema.concatTemplateArray = variables.stat_data['$meta']\n                    ?.concatTemplateArray as boolean;\n            if (_.has(variables.stat_data, '$meta.strictSet'))\n                generated_schema.strictSet = variables.stat_data['$meta']?.strictSet as boolean;\n            variables.schema = generated_schema;\n        } else {\n            console.error(\n                'Generated schema is not an object schema, which is unexpected for stat_data root'\n            );\n        }\n\n        // 3.  stat_data\n        cleanUpMetadata(variables.stat_data);\n    }\n\n    if (!is_updated) {\n        return;\n    }\n\n    console.info(`Init chat variables.`);\n    //@ts-expect-error old fn\n    await updateVariablesWith(data => _.assign(data, variables));\n\n    if (getLastMessageId() == 0) {\n        const last_msg = getChatMessages(0, { include_swipes: true })[0];\n        //  swipes\n        await setChatMessages([\n            {\n                // last_msg  message_id\n                message_id: 0,\n                swipes_data: await Promise.all(\n                    last_msg.swipes!.map(async (swipe, index) => {\n                        let vanilla_variable_data: Record<string, any> = klona(\n                            last_msg.swipes_data[index]\n                        );\n                        if (vanilla_variable_data === undefined) {\n                            vanilla_variable_data = {};\n                        }\n\n                        const current_data = _.merge(vanilla_variable_data, variables);\n\n                        await eventEmit(variable_events.VARIABLE_INITIALIZED, current_data, index);\n                        //  updateVariables\n                        //  substitudeMacrosupdateVariables \n                        await updateVariables(swipe, current_data);\n                        console.log(``);\n                        return current_data;\n                    })\n                ),\n            },\n        ]);\n    } else {\n        // \n        // @ts-expect-error \n        await setChatMessage({ data: variables }, getLastMessageId());\n    }\n    try {\n        // \n        toastr.info(\n            `:<br>${Object.entries(\n                variables.initialized_lorebooks ?? {}\n            )\n                .map(([key, value]) => `- ${key}: ${JSON.stringify(value)}`)\n                .join('<br>')}`,\n            '[MVU]',\n            {\n                escapeHtml: false,\n            }\n        );\n    } catch (_e) {\n        /* empty */\n    }\n\n    //  lorebook \n    await updateLorebookSettings();\n}\n\n/**\n *  lorebook \n */\nexport async function getEnabledLorebookList(): Promise<string[]> {\n    const lorebook_settings = await getLorebookSettings();\n    const enabled_lorebook_list = [...lorebook_settings.selected_global_lorebooks];\n    const char_lorebook = await getCurrentCharPrimaryLorebook();\n    if (char_lorebook !== null) {\n        enabled_lorebook_list.push(char_lorebook);\n    }\n    return enabled_lorebook_list;\n}\n\n/**\n *  lorebook  InitVar  GameData \n */\nexport async function loadInitVarData(\n    mvu_data: MvuData,\n    lorebook_list?: string[]\n): Promise<boolean> {\n    const enabled_lorebook_list = lorebook_list || (await getEnabledLorebookList());\n    let is_updated = false;\n\n    //  initialized_lorebooks \n    if (!mvu_data.initialized_lorebooks || Array.isArray(mvu_data.initialized_lorebooks)) {\n        mvu_data.initialized_lorebooks = {};\n    }\n\n    for (const current_lorebook of enabled_lorebook_list) {\n        //  beta \n        if (_.has(mvu_data.initialized_lorebooks, current_lorebook)) continue;\n        mvu_data.initialized_lorebooks[current_lorebook] = [];\n        const init_entries = (await getLorebookEntries(current_lorebook)) as LorebookEntry[];\n\n        for (const entry of init_entries) {\n            if (entry.comment?.toLowerCase().includes('[initvar]')) {\n                const content = substitudeMacros(entry.content);\n                let parsedData: any = null;\n                let parseError: Error | null = null;\n\n                // Try YAML first (which also handles JSON)\n                try {\n                    parsedData = YAML.parseDocument(content, { merge: true }).toJS();\n                } catch (e) {\n                    // Try JSON5\n                    try {\n                        // eslint-disable-next-line import-x/no-named-as-default-member\n                        parsedData = JSON5.parse(content);\n                    } catch (e2) {\n                        // Try TOML\n                        try {\n                            parsedData = TOML.parse(content);\n                        } catch (e3) {\n                            parseError = new Error(\n                                `initvar  YAML/JSON/JSON5/TOML : ${e3}`\n                            );\n                        }\n                    }\n                }\n\n                if (parseError) {\n                    console.error(`'${entry.comment}': ${parseError}`);\n                    toastr.error(parseError.message, `[MVU] '${entry.comment}'`, {\n                        timeOut: 5000,\n                    });\n                    throw parseError;\n                }\n\n                if (parsedData) {\n                    mvu_data.stat_data = _.merge(mvu_data.stat_data, parsedData);\n                }\n            }\n        }\n        is_updated = true;\n    }\n\n    return is_updated;\n}\n\n/**\n *  GameData \n */\nexport function createEmptyGameData(): MvuData {\n    return {\n        display_data: {},\n        initialized_lorebooks: {}, //  beta \n        stat_data: {},\n        delta_data: {},\n        schema: {\n            type: 'object',\n            properties: {},\n        }, // beta  schema \n    };\n}\n\n/**\n * \n */\nexport async function getLastMessageVariables(): Promise<{\n    message: ChatMessageSwiped;\n    variables: MvuData | undefined;\n}> {\n    let last_chat_msg: ChatMessageSwiped[] = [];\n    try {\n        last_chat_msg = (await getChatMessages(-2, {\n            role: 'assistant',\n            include_swipes: true,\n        })) as ChatMessageSwiped[];\n    } catch (e) {\n        // \n    }\n\n    if (!last_chat_msg || last_chat_msg.length <= 0) {\n        const first_msg = await getChatMessages(0, {\n            include_swipes: true,\n        });\n        if (first_msg && first_msg.length > 0) {\n            last_chat_msg = first_msg;\n        } else {\n            throw new Error('');\n        }\n    }\n\n    const last_msg = last_chat_msg[0];\n    const variables = last_msg.swipes_data[last_msg.swipe_id] as MvuData & Record<string, any>;\n\n    return { message: last_msg, variables };\n}\n\n/**\n *  lorebook \n */\nexport async function updateLorebookSettings(): Promise<void> {\n    /*Ref:https://github.com/lolo-desu/lolocard/blob/master/src/%E6%97%A5%E8%AE%B0%E7%BB%9C%E7%BB%9C/%E8%84%9A%E6%9C%AC/%E8%B0%83%E6%95%B4%E4%B8%96%E7%95%8C%E4%B9%A6%E5%85%A8%E5%B1%80%E8%AE%BE%E7%BD%AE.ts\n     */\n    const dst_setting: Partial<LorebookSettings> = {\n        scan_depth: 2,\n        context_percentage: 100,\n        budget_cap: 0,\n        min_activations: 0,\n        max_depth: 0,\n        max_recursion_steps: 0,\n\n        insertion_strategy: 'character_first',\n\n        include_names: false,\n        recursive: true,\n        case_sensitive: false,\n        match_whole_words: false,\n        use_group_scoring: false,\n        overflow_alert: false,\n    };\n    const settings = getLorebookSettings();\n    if (!_.isEqual(_.merge({}, settings, dst_setting), settings)) {\n        setLorebookSettings(dst_setting);\n    }\n}\n\n//window.initCheck = initCheck;\n","import { getLastValidVariable, handleVariablesInMessage, updateVariables } from '@/function';\nimport { cleanUpMetadata, reconcileAndApplySchema } from '@/schema';\nimport { useSettingsStore } from '@/settings';\nimport { updateDescriptions } from '@/update_descriptions';\nimport { findLastValidMessage, isFunctionCallingSupported, scopedEventOn } from '@/util';\nimport { MvuData } from '@/variable_def';\nimport { createEmptyGameData, loadInitVarData } from '@/variable_init';\nimport { klona } from 'klona';\n\ninterface Button {\n    name: string;\n    function: (() => void) | (() => Promise<void>);\n}\n\ntype OnMessageReceived = (message_id: number) => Promise<void>;\n\nlet msg_received_callback: OnMessageReceived;\nlet is_extra_model_support: boolean;\n\nexport function SetReceivedCallbackFn(fn: OnMessageReceived) {\n    msg_received_callback = fn;\n}\nexport function SetExtraModelSupported(is_support: boolean) {\n    is_extra_model_support = is_support;\n}\n\nasync function EmitVariableAnalysisJob() {\n    const settings = useSettingsStore().settings;\n    if (settings. === 'AI') {\n        toastr.info(``, '[MVU]', {\n            timeOut: 3000,\n        });\n        return;\n    } else if (settings.. && !isFunctionCallingSupported()) {\n        toastr.info(`LLM`, '[MVU]', {\n            timeOut: 3000,\n        });\n        return;\n    } else if (!is_extra_model_support) {\n        toastr.info(\n            ``,\n            '[MVU]',\n            {\n                timeOut: 3000,\n            }\n        );\n        return;\n    }\n    const last_msg = getLastMessageId();\n    const current_chatmsg = getChatMessages(last_msg).at(-1);\n    const current_chat_content = current_chatmsg?.message ?? '';\n    const begin_pos = current_chat_content.lastIndexOf('<UpdateVariable>');\n    if (begin_pos >= 0) {\n        //\n        const end_pos = current_chat_content.lastIndexOf('</UpdateVariable>');\n        let filtered_string = '';\n        if (end_pos === -1) {\n            //\n            filtered_string = current_chat_content.slice(0, begin_pos);\n        } else {\n            // </UpdateVariable> \n            filtered_string =\n                current_chat_content.slice(0, begin_pos) + current_chat_content.slice(end_pos + 17);\n        }\n        //\n        await setChatMessages(\n            [\n                {\n                    message_id: last_msg,\n                    message: filtered_string,\n                },\n            ],\n            {\n                refresh: 'none',\n            }\n        );\n    }\n    await msg_received_callback(last_msg);\n    toastr.info(``, '[MVU]');\n}\n\nasync function RecurVariable() {\n    const result = (await SillyTavern.callGenericPopup(\n        '<h4> required/extensible </h4> ( 10  10 , -1 )<br><strong></strong>',\n        SillyTavern.POPUP_TYPE.INPUT,\n        '-1'\n    )) as string | undefined;\n    if (!result) {\n        return;\n    }\n    let message_id = parseInt(result);\n    if (message_id === -1) {\n        message_id = getLastMessageId();\n    }\n    if (isNaN(message_id) || SillyTavern.chat[message_id] === undefined) {\n        toastr.error(`,  '${result}'`, '[MVU]');\n        return;\n    }\n\n    const fnd_message = findLastValidMessage(message_id);\n    if (fnd_message === -1) {\n        toastr.error(``, '[MVU]');\n        return;\n    }\n    //\n    const result2 = (await SillyTavern.callGenericPopup(\n        ` [${fnd_message}]`,\n        SillyTavern.POPUP_TYPE.INPUT,\n        fnd_message.toString()\n    )) as string | undefined;\n    if (!result2) {\n        return;\n    }\n    const recur_intial_message_id = parseInt(result2);\n    if (isNaN(recur_intial_message_id)) {\n        toastr.error(`,  '${result2}'`, '[MVU]');\n        return;\n    }\n\n    //\n    //\n    const recur_variable_data = klona(\n        getVariables({\n            type: 'message',\n            message_id: recur_intial_message_id,\n        })\n    );\n    if (\n        recur_variable_data === undefined ||\n        !_.has(recur_variable_data, 'stat_data') ||\n        !_.has(recur_variable_data, 'schema')\n    ) {\n        toastr.error(`,  '${result2}'`, '[MVU]');\n        return;\n    }\n    let counter = 0;\n    /**\n     *  (recur_intial_message_id, recur_end_message_id]\n     * @param recur_variable_data (MvuData)\n     * @param recur_intial_message_id id()\n     * @param message_id id()\n     */\n    for (let i = recur_intial_message_id + 1; i <= message_id; i++) {\n        const chat_message = SillyTavern.chat[i];\n        const index = i - (recur_intial_message_id + 1);\n\n        console.log(` ${index},  ${chat_message.mes}`);\n        await updateVariables(chat_message.mes, recur_variable_data);\n\n        counter++;\n        if (counter % 50 === 0) {\n            toastr.info(\n                ` (${counter} / ${message_id - recur_intial_message_id})`,\n                `[MVU]`\n            );\n        }\n    }\n\n    const updater = (data: Record<string, any>) => {\n        data.stat_data = recur_variable_data.stat_data;\n        data.display_data = recur_variable_data.display_data;\n        data.delta_data = recur_variable_data.delta_data;\n        data.initialized_lorebooks = recur_variable_data.initialized_lorebooks;\n        data.schema = recur_variable_data.schema;\n        return data;\n    };\n    await updateVariablesWith(updater, { type: 'message', message_id: message_id });\n\n    SillyTavern.saveChat().then(() =>\n        toastr.success(\n            ` ${message_id}  ${counter} `,\n            '[MVU]'\n        )\n    );\n    await setChatMessages(\n        [\n            {\n                message_id: message_id,\n            },\n        ],\n        {\n            refresh: 'affected',\n        }\n    );\n}\n\nexport const buttons: Button[] = [\n    {\n        name: '',\n        function: async () => {\n            const last_msg = getLastMessageId();\n            if (last_msg < 1) return;\n            if (SillyTavern.chat.length === 0) return;\n            await updateVariablesWith(\n                variables => {\n                    _.unset(variables, `stat_data`);\n                    _.unset(variables, `delta_data`);\n                    _.unset(variables, `display_data`);\n                    _.unset(variables, `schema`);\n                    return variables;\n                },\n                { type: 'message', message_id: last_msg }\n            );\n            //\n            await handleVariablesInMessage(getLastMessageId());\n        },\n    },\n    {\n        name: '',\n        function: async () => {\n            // 1.  GameData  InitVar \n            const latest_init_data = createEmptyGameData();\n\n            try {\n                const hasInitData = await loadInitVarData(latest_init_data);\n                if (!hasInitData) {\n                    console.error(' InitVar ');\n                    toastr.error(' InitVar ', '[MVU]', { timeOut: 3000 });\n                    return;\n                }\n            } catch (e) {\n                console.error(' InitVar :', e);\n                return;\n            }\n            await reconcileAndApplySchema(latest_init_data);\n\n            cleanUpMetadata(latest_init_data.stat_data);\n\n            // 2. \n            const message_id = getLastMessageId();\n            if (message_id < 0) {\n                console.error('');\n                toastr.error('', '[MVU]', { timeOut: 3000 });\n                return;\n            }\n\n            const latest_msg_data = await getLastValidVariable(message_id);\n\n            if (!_.has(latest_msg_data, 'stat_data')) {\n                console.error(' stat_data');\n                toastr.error(' stat_data', '[MVU]', { timeOut: 3000 });\n                return;\n            }\n\n            // 3.  latest_init_data  latest_msg_data \n            // latest_init_data  klona\n            const merged_data: Record<string, any> = { stat_data: undefined, schema: undefined };\n            merged_data.stat_data = _.merge(\n                {},\n                latest_init_data.stat_data,\n                latest_msg_data.stat_data\n            );\n            merged_data.schema = _.merge({}, latest_msg_data.schema, latest_init_data.schema);\n            merged_data.initialized_lorebooks = _.merge(\n                {},\n                latest_init_data.initialized_lorebooks,\n                latest_msg_data.initialized_lorebooks\n            );\n            merged_data.display_data = klona(merged_data.stat_data);\n            merged_data.delta_data = latest_msg_data.delta_data;\n\n            // 4-5. \n            updateDescriptions(\n                '',\n                latest_init_data.stat_data,\n                latest_msg_data.stat_data,\n                merged_data.stat_data\n            );\n\n            //\n            await reconcileAndApplySchema(merged_data as MvuData);\n\n            cleanUpMetadata(merged_data.stat_data);\n\n            // 6. \n            await replaceVariables(merged_data, { type: 'message', message_id: message_id });\n\n            // @ts-expect-error \n            await setChatMessage({}, message_id);\n\n            await replaceVariables(merged_data, { type: 'chat' });\n\n            console.info('InitVar');\n            toastr.success('InitVar', '[MVU]', { timeOut: 3000 });\n        },\n    },\n    {\n        name: '',\n        function: async () => {\n            const result = (await SillyTavern.callGenericPopup(\n                '<h4></h4> ( 10  10 )<br><strong></strong>',\n                SillyTavern.POPUP_TYPE.INPUT,\n                '10'\n            )) as string | undefined;\n            if (!result) {\n                return;\n            }\n            const message_id = parseInt(result);\n            if (isNaN(message_id)) {\n                toastr.error(`,  '${result}'`, '[MVU]');\n                return;\n            }\n            const chat_message = SillyTavern.chat[message_id];\n            if (chat_message === undefined) {\n                toastr.error(` '${result}'`, '[MVU]');\n                return;\n            }\n            _.range(0, chat_message.swipes?.length ?? 1).forEach(i => {\n                if (chat_message?.variables?.[i] === undefined) {\n                    return;\n                }\n                chat_message.variables[i].snapshot = true;\n            });\n            SillyTavern.saveChat().then(() =>\n                toastr.success(` ${message_id} `, '[MVU]')\n            );\n        },\n    },\n    {\n        name: '',\n        function: RecurVariable,\n    },\n    {\n        name: '',\n        function: EmitVariableAnalysisJob,\n    },\n    {\n        name: '',\n        function: async () => {\n            const snapshot_interval = useSettingsStore().settings.;\n            const result = (await SillyTavern.callGenericPopup(\n                `<h4></h4> ( 10  10  [${snapshot_interval}] ) <br><strong>: </strong>`,\n                SillyTavern.POPUP_TYPE.INPUT,\n                '10'\n            )) as string | undefined;\n            if (!result) {\n                return;\n            }\n            const depth = parseInt(result);\n            if (isNaN(depth)) {\n                toastr.error(\n                    `,  '${result}'`,\n                    '[MVU]'\n                );\n                return;\n            }\n            SillyTavern.chat.slice(1, -depth - 1).forEach((chat_message, index) => {\n                if (chat_message.variables === undefined) {\n                    return;\n                }\n                chat_message.variables = _.range(0, chat_message.swipes?.length ?? 1).map(i => {\n                    if (chat_message?.variables?.[i] === undefined) {\n                        return {};\n                    }\n                    if (_.get(chat_message.variables[i], 'snapshot') === true)\n                        return chat_message.variables[i];\n                    if ((index + 1) % snapshot_interval === 0) {\n                        chat_message.variables[i].snapshot = true;\n                        console.log(` [${index + 1}] `);\n                        return chat_message.variables[i];\n                    }\n                    return _.omit(\n                        chat_message.variables[i],\n                        `stat_data`,\n                        `display_data`,\n                        `delta_data`,\n                        `schema`\n                    );\n                });\n            });\n            SillyTavern.saveChat().then(() =>\n                toastr.success(\n                    `,  ${depth} `,\n                    '[MVU]'\n                )\n            );\n        },\n    },\n];\n\nexport function registerButtons() {\n    appendInexistentScriptButtons(buttons.map(b => ({ name: b.name, visible: false })));\n    buttons.forEach(b => {\n        scopedEventOn(getButtonEvent(b.name), b.function);\n    });\n}\n","import { handleVariablesInCallback, updateVariable } from '@/function';\nimport {\n    extractRecord,\n    isValueWithDescription,\n    MvuData,\n    variable_events,\n    VariableData,\n} from '@/variable_def';\nimport { loadInitVarData } from '@/variable_init';\n\ntype CommandNames = 'set' | 'insert' | 'delete' | 'add';\n\n/**\n *  parseMessage / updateVariables \n *\n *  `parseCommandValue` \n */\ntype SetCommandArgs =\n    | [path: string, newValueLiteral: string]\n    | [path: string, expectedOldValueLiteral: string, newValueLiteral: string];\n\n/**\n * `_.assign`  `_.insert` /\n */\ntype AssignCommandArgs =\n    | [path: string, valueLiteral: string]\n    | [path: string, indexOrKeyLiteral: string, valueLiteral: string];\n\n/**\n * /\n */\ntype RemoveCommandArgs = [path: string] | [path: string, indexKeyOrValueLiteral: string];\n\n/**\n * `_.add` \n */\ntype AddCommandArgs = [path: string, deltaOrToggleLiteral: string];\n\ntype CommandArgsMap = {\n    set: SetCommandArgs;\n    insert: AssignCommandArgs;\n    delete: RemoveCommandArgs;\n    add: AddCommandArgs;\n};\n\n/**\n * CommandInfo  Command \n * \n */\nexport type CommandInfo = {\n    [K in CommandNames]: {\n        type: K;\n        full_match: string;\n        args: CommandArgsMap[K];\n        reason: string;\n    };\n}[CommandNames];\n\nexport type UpdateContext = {\n    variables: MvuData;\n    message_content: string;\n};\n\nfunction createMVU() {\n    const mvu = {\n        /**\n         * \n         * \n         *\n         * @property {string} SINGLE_VARIABLE_UPDATED - 'mag_variable_updated'\n         * \n         * - : 'mag_variable_updated'\n         * - : (stat_data: Record<string, any>, path: string, oldValue: any, newValue: any) => void\n         *   - stat_data: \n         *   - path:  'player.health'  'items[0].name'\n         *   - oldValue: \n         *   - newValue: \n         * - :  setMvuVariable / _.set  \n         * - :\n         *   - \n         *   - \n         *\n         * @property {string} VARIABLE_UPDATE_STARTED - 'mag_variable_update_started'\n         * \n         * - : 'mag_variable_update_started'\n         * - : (variables: MvuData, out_is_updated: boolean) => void\n         *   - variables:  stat_datadisplay_datadelta_data \n         *   - out_is_updated: \n         * - : parseMessage  LLM \n         * - :\n         *   - \n         *   - \n         *\n         * @property {string} VARIABLE_UPDATE_ENDED - 'mag_variable_update_ended'\n         * \n         * - : 'mag_variable_update_ended'\n         * - : (variables: MvuData, out_is_updated: boolean) => void\n         *   - variables: \n         *     - variables.stat_data: \n         *     - variables.display_data: \n         *     - variables.delta_data: \n         * - : parseMessage  LLM \n         * - :\n         *   - \n         *   - \n         * @property {string} VARIABLE_INITIALIZED - 'mag_variable_initialized'\n         *  0 \n         * - : 'mag_variable_initialized'\n         * - : (variables: Record<string, any> & MvuData, swipe_id: number) => void\n         *   - variables:  [initvar]  mvu \n         *   - swipe_id:  swipe \n         * - :  0 (swipe) \n         * - :\n         *   -  stat_data \n         *\n         * @property {string} COMMAND_PARSED - 'mag_command_parsed'\n         * \n         * - : 'mag_command_parsed'\n         * - : (variables: MvuData, commands: CommandInfo[], message_content: string) => void\n         *   - variables: \n         *   - commands: \n         *   - message_content: commands\n         * - : \n         * - :\n         *   -  Command \n         *   - llm Gemini  -.  Path \n         *   -    llm  \n         *   -  message_content  JSON Patch  commands \n         * @property {string} BEFORE_MESSAGE_UPDATE - 'mag_before_message_update'\n         *  MVU \n         * - : 'mag_before_message_update'\n         * - : (context: UpdateContext) => void;\n         *   - UpdateContext: \n         *   - UpdateContext.variables: \n         *   - UpdateContext.message_content:  (****)\n         * - :  <StatusPlaceHolderImpl/>  assistant \n         * - :\n         *   -   stat_data.story_misc  summary  story_misc \n         *\n         * @example\n         * // 1.  - \n         * eventOn(Mvu.events.SINGLE_VARIABLE_UPDATED, (stat_data, path, oldValue, newValue) => {\n         *   console.log(`[] ${path}: ${oldValue} -> ${newValue}`);\n         *\n         *   // \n         *   if (path === 'player.level' && newValue > oldValue) {\n         *     const levelUp = newValue - oldValue;\n         *     // 10\n         *     const newMaxHealth = stat_data.player.maxHealth + (levelUp * 10);\n         *     Mvu.setMvuVariable(stat_data, 'player.maxHealth', newMaxHealth, {\n         *       reason: `(+${levelUp})`\n         *     });\n         *   }\n         *\n         *   // 0\n         *   if (path === 'player.health' && newValue <= 0 && oldValue > 0) {\n         *     Mvu.setMvuVariable(mvuData, 'player.status', 'dead', {\n         *       reason: '',\n         *       is_recursive: true  //  events\n         *     });\n         *   }\n         * });\n         *\n         * // 2.  - UI\n         * var value_snapshot = undefined;\n         * eventOn(Mvu.events.VARIABLE_UPDATE_STARTED, (variables, out_is_updated) => {\n         *   console.log('[] ...');\n         *\n         *   // \n         *   value_snapshot = variables.stat_data.;\n         * });\n         *\n         * // 3.  - \n         * eventOn(Mvu.events.VARIABLE_UPDATE_ENDED, (variables, out_is_updated) => {\n         *   console.log('[] :', out_is_updated);\n         *   //llm \n         *   Mvu.setMvuVariable(variables.stat_data, '', value_snapshot);\n         * });\n         *\n         */\n        events: variable_events,\n\n        /**\n         * \n         * @param message -  _.set() \n         * @param old_data -  MvuData \n         * @returns  MvuData undefined\n         * @example\n         * const newData = await Mvu.parseMessage(`\n         *   _.set('player.health', 100, 80);//\n         *   _.set('player.position', \"\", \"\");//\n         * `, currentData);\n         */\n        parseMessage: async function (\n            message: string,\n            old_data: MvuData\n        ): Promise<MvuData | undefined> {\n            const variableData: VariableData = {\n                old_variables: old_data,\n            };\n            await handleVariablesInCallback(message, variableData);\n            return variableData.new_variables;\n        },\n\n        /**\n         *  MvuData\n         * @param options - chat/message/global\n         * @returns MvuData \n         * @example\n         * const chatData = Mvu.getMvuData({ type: 'chat' });\n         * const messageData = Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n         */\n        getMvuData: function (options: VariableOption): MvuData {\n            const result = getVariables(options);\n            return result as MvuData;\n        },\n\n        /**\n         *  MvuData\n         * @param mvu_data -  MvuData\n         * @param options - \n         * @example\n         * await Mvu.replaceMvuData(newData, { type: 'chat' });\n         */\n        replaceMvuData: async function (mvu_data: MvuData, options: VariableOption): Promise<void> {\n            await replaceVariables(mvu_data, options);\n        },\n\n        /**\n         *  MvuData\n         * @returns  MvuData \n         * @example\n         * const currentData = Mvu.getCurrentMvuData();\n         */\n        getCurrentMvuData: function (): MvuData {\n            const variables = getVariables({ type: 'message', message_id: getCurrentMessageId() });\n            return variables as MvuData;\n        },\n\n        /**\n         *  MvuData\n         * @param mvu_data -  MvuData\n         * @example\n         * await Mvu.replaceCurrentMvuData(updatedData);\n         */\n        replaceCurrentMvuData: async function (mvu_data: MvuData): Promise<void> {\n            await replaceVariables(mvu_data, {\n                type: 'message',\n                message_id: getCurrentMessageId(),\n            });\n        },\n\n        /**\n         * \n         * @param mvu_data -  MvuData \n         * @returns \n         * @example\n         * const success = await Mvu.reloadInitVar(mvuData);\n         */\n        reloadInitVar: async function (mvu_data: MvuData): Promise<boolean> {\n            return await loadInitVarData(mvu_data);\n        },\n\n        /**\n         * \n         * @param mvu_data -  MvuData \n         * @param path -  \"player.health\"  \"items[0]\"\n         * @param new_value - \n         * @param options - \n         * @param options.reason -  display_data \n         * @param options.is_recursive -  mag_variable_updated  false\n         * @returns \n         * @example\n         * // \n         * await Mvu.setMvuVariable(data, 'player.health', 80);\n         *\n         * // \n         * await Mvu.setMvuVariable(data, 'player.health', 80, { reason: '' });\n         *\n         * // \n         * await Mvu.setMvuVariable(data, 'player.level', 2, {\n         *   reason: '',\n         *   is_recursive: true\n         * });\n         *\n         */\n        setMvuVariable: async function (\n            mvu_data: MvuData,\n            path: string,\n            new_value: any,\n            { reason = '', is_recursive = false }: { reason?: string; is_recursive?: boolean } = {}\n        ): Promise<boolean> {\n            return await updateVariable(mvu_data.stat_data, path, new_value, reason, is_recursive);\n        },\n\n        /**\n         * \n         * @param mvu_data - MvuData \n         * @param path - \n         * @param options - \n         * @param options.category - 'stat'()/'display'/'delta'\n         * @param options.default_value - \n         * @returns  ValueWithDescription \n         * @example\n         * //  stat_data \n         * const health = Mvu.getMvuVariable(data, 'player.health');\n         *\n         * //  display_data \n         * const healthDisplay = Mvu.getMvuVariable(data, 'player.health', {\n         *   category: 'display'\n         * });\n         *\n         * // \n         * const score = Mvu.getMvuVariable(data, 'player.score', {\n         *   default_value: 0\n         * });\n         */\n        getMvuVariable: function (\n            mvu_data: MvuData,\n            path: string,\n            {\n                category = 'stat',\n                default_value = undefined,\n            }: { category?: 'stat' | 'display' | 'delta'; default_value?: any } = {}\n        ): any {\n            let data: Record<string, any>;\n            switch (category) {\n                case 'stat':\n                    data = mvu_data.stat_data;\n                    break;\n                case 'display':\n                    data = mvu_data.display_data!;\n                    break;\n                case 'delta':\n                    data = mvu_data.delta_data!;\n                    break;\n            }\n\n            const value = _.get(data, path, default_value);\n\n            /*  VWD */\n            if (isValueWithDescription(value)) {\n                return value[0];\n            }\n\n            /*  */\n            return value;\n        },\n\n        /**\n         * \n         * @param mvu_data - MvuData \n         * @param category - 'stat'/'display'/'delta'\n         * @returns \n         * @example\n         * // \n         * const allStatData = Mvu.getRecordFromMvuData(data, 'stat');\n         *\n         * // \n         * const allDisplayData = Mvu.getRecordFromMvuData(data, 'display');\n         *\n         * // \n         * const allDeltaData = Mvu.getRecordFromMvuData(data, 'delta');\n         *\n         * @note  LLM  foreach \n         */\n        getRecordFromMvuData: function (\n            mvu_data: MvuData,\n            category: 'stat' | 'display' | 'delta'\n        ): Record<string, any> {\n            return extractRecord(category, mvu_data);\n        },\n    };\n    return mvu;\n}\n\nexport type MVU = ReturnType<typeof createMVU>;\n\nexport type Mvu = MVU;\n\nexport function exportGlobals() {\n    const mvu = createMVU();\n    _.set(window, 'Mvu', mvu);\n    _.set(window.parent, 'Mvu', mvu);\n    eventEmit('global_Mvu_initialized');\n}\n\nexport function unsetGlobals() {\n    _.unset(window.parent, 'Mvu');\n}\n","import { getLastValidVariable, updateVariables } from '@/function';\nimport { useSettingsStore } from '@/settings';\n\n/**\n * generate  tool_call \n *  tool_call llm tool callauto/any\n *  tool call required\n *  mvu \n *  generate  required \n */\n\nexport const MVU_FUNCTION_NAME = 'mvu_VariableUpdate';\nconst mvu_update_call_function_name = 'mvu_updateRound';\n\n/*\n    e.g.: [\n    [\n        {\n            \"index\": 0,\n            \"id\": \"tool_0_mvu_VariableUpdate_2lJb8gNNBxCT4Gi4QDkF\",\n            \"type\": \"function\",\n            \"function\": {\n                \"name\": \"mvu_VariableUpdate\",\n                \"arguments\": \"{\\\"delta\\\":\\\"\\\\n_.set('.','19:30');//\\\\n_.set('yukkuri.yukkuri_1.fullness_level',45);\\\\n_.set('yukkuri.yukkuri_1.pickiness_level',40);\\\\n_.set('yukkuri.yukkuri_1.monologue','Q');\\\\n_.set('yukkuri.yukkuri_2.fullness_level',45);\\\\n_.set('yukkuri.yukkuri_2.pickiness_level',40);\\\\n_.set('yukkuri.yukkuri_2.monologue','');\\\\n_.set('yukkuri.yukkuri_3.fullness_level',45);\\\\n_.set('yukkuri.yukkuri_3.pickiness_level',40);\\\\n_.set('yukkuri.yukkuri_3.monologue','');\\\\n_.set('yukkuri.yukkuri_4.fullness_level',30);\\\\n_.set('yukkuri.yukkuri_4.pickiness_level',45);\\\\n_.set('yukkuri.yukkuri_4.monologue','');\\\\n_.set('yukkuri.yukkuri_5.fullness_level',30);\\\\n_.set('yukkuri.yukkuri_5.pickiness_level',45);\\\\n_.set('yukkuri.yukkuri_5.monologue','');\\\\n\\\",\\\"analysis\\\":\\\"\\\\nTime passed: 1 hour. Not a special case, so no dramatic updates.\\\\nVariables to check: ., yukkuri.yukkuri_1.fullness_level, yukkuri.yukkuri_1.pickiness_level, yukkuri.yukkuri_1.monologue, yukkuri.yukkuri_2.fullness_level, yukkuri.yukkuri_2.pickiness_level, yukkuri.yukkuri_2.monologue, yukkuri.yukkuri_3.fullness_level, yukkuri.yukkuri_3.pickiness_level, yukkuri.yukkuri_3.monologue, yukkuri.yukkuri_4.fullness_level, yukkuri.yukkuri_4.pickiness_level, yukkuri.yukkuri_4.monologue, yukkuri.yukkuri_5.fullness_level, yukkuri.yukkuri_5.pickiness_level, yukkuri.yukkuri_5.monologue\\\\n\\\\n.: Y\\\\nyukkuri.yukkuri_1.fullness_level: Y\\\\nyukkuri.yukkuri_1.pickiness_level: Y\\\\nyukkuri.yukkuri_1.monologue: Y\\\\nyukkuri.yukkuri_2.fullness_level: Y\\\\nyukkuri.yukkuri_2.pickiness_level: Y\\\\nyukkuri.yukkuri_2.monologue: Y\\\\nyukkuri.yukkuri_3.fullness_level: Y\\\\nyukkuri.yukkuri_3.pickiness_level: Y\\\\nyukkuri.yukkuri_3.monologue: Y\\\\nyukkuri.yukkuri_4.fullness_level: Y\\\\nyukkuri.yukkuri_4.pickiness_level: Y\\\\nyukkuri.yukkuri_4.monologue: Y\\\\nyukkuri.yukkuri_5.fullness_level: Y\\\\nyukkuri.yukkuri_5.pickiness_level: Y\\\\nyukkuri.yukkuri_5.monologue: Y\\\\n\\\"}\"\n            }\n        }\n    ]\n]\n */\n\n/**  */\nexport interface FunctionCallBody {\n    /**  \"mvu_VariableUpdate\" */\n    name: ToolName;\n    /** ** JSON** */\n    arguments: string;\n}\n\n/** function-calling  */\nexport interface ToolFunctionCall {\n    index: number; //  tool_call \n    id: string; // / ID\n    type: 'function'; //  function\n    function: FunctionCallBody;\n}\n\n/**  */\nexport type ToolCallBatch = ToolFunctionCall[];\n\n/**  */\nexport type ToolCallBatches = ToolCallBatch[];\n\n/**  mvu_VariableUpdate string  */\nexport type ToolName = typeof MVU_FUNCTION_NAME | (string & {});\n\nlet is_function_call_enabled: boolean = false;\n\nexport function setFunctionCallEnabled(enabled: boolean) {\n    is_function_call_enabled = enabled;\n}\n\nexport function unregisterFunction() {\n    SillyTavern.unregisterFunctionTool(MVU_FUNCTION_NAME);\n    SillyTavern.unregisterFunctionTool(mvu_update_call_function_name);\n}\n\n/*\nasync function _onStoryEndCall(_args: any): Promise<string> {\n    const variables = await getLastValidVariable(getLastMessageId());\n    const val = variables.stat_data;\n    let content = ExtraLLMRequestContent;\n    if (val !== undefined) {\n        content = content.replaceAll(\n            \"<%= YAML.stringify(getvar('stat_data'), { blockQuote: 'literal' }) _%>\",\n            YAML.stringify(val, { blockQuote: 'literal' })\n        );\n    }\n    content += `\\nuse \\`${MVUFunctionName}\\` tool to update variables.`;\n    return content;\n}\n*/\n\nasync function onVariableUpdatedCall(args: any): Promise<string> {\n    if (!args?.delta) return '';\n    let message_id = getLastMessageId();\n    let chat_message = getChatMessages(message_id).at(-1);\n    if (chat_message && chat_message.role === 'system') {\n        // mvu \n        message_id -= 1;\n        chat_message = getChatMessages(message_id).at(-1);\n    }\n    if (!chat_message) {\n        return '';\n    }\n\n    let message_content = chat_message.message;\n    const variables = await getLastValidVariable(message_id);\n    if (!_.has(variables, 'stat_data')) {\n        console.error(`cannot found stat_data for ${message_id}`);\n        return '';\n    }\n\n    const has_variable_modified = await updateVariables(args.delta, variables);\n    if (has_variable_modified) {\n        await replaceVariables(variables, { type: 'chat' });\n    }\n    await replaceVariables(variables, { type: 'message', message_id: message_id });\n\n    message_content += `<UpdateVariable>\\n<Analysis>${args.analysis}</Analysis></Analysis>${args.delta}\\n</UpdateVariable>`;\n\n    if (chat_message.role !== 'user' && !message_content.includes('<StatusPlaceHolderImpl/>')) {\n        // PlaceHolder\n        await setChatMessages(\n            [\n                {\n                    message_id: message_id,\n                    message: message_content + '\\n\\n<StatusPlaceHolderImpl/>',\n                },\n            ],\n            {\n                refresh: 'affected',\n            }\n        );\n    } else {\n        // UpdateVaraible \n        await setChatMessages(\n            [\n                {\n                    message_id: message_id,\n                    message: message_content,\n                },\n            ],\n            {\n                refresh: 'affected',\n            }\n        );\n    }\n    return JSON.stringify(variables.delta_data);\n}\n\nexport function registerFunction() {\n    const { registerFunctionTool } = SillyTavern;\n    if (!registerFunctionTool) {\n        console.debug('MVU: function tools are not supported');\n        return;\n    }\n\n    const mvu_update_schema = Object.freeze({\n        $schema: 'http://json-schema.org/draft-04/schema#',\n        type: 'object',\n        additionalProperties: false,\n        properties: {\n            analysis: {\n                type: 'string',\n                minLength: 1,\n                description:\n                    'Write in ENGLISH. A compact reasoning summary that includes: (1) calculate time passed; (2) decide whether dramatic updates are allowed (special case or sufficiently long time); (3) list every variable name that appears in the <status_description> section BEFORE actual variable analysis, without revealing their contents; (4) for each variable, judge whether it satisfies its change conditions and output only Y/N without reasons; (5) only evaluate stories inside <past_observe> block.',\n            },\n            delta: {\n                type: 'string',\n                minLength: 0,\n                description:\n                    \"multilines Update statements, includes `_.set`,`_.insert`,`_.assign`,`_.delete`,`_.remove`,`_.add`. example: _.set('.',35);//\",\n            },\n        },\n        required: ['delta'],\n    });\n\n    registerFunctionTool({\n        name: MVU_FUNCTION_NAME,\n        displayName: 'MVU update',\n        stealth: true,\n        description: 'use this tool to UpdateVariable.',\n        parameters: mvu_update_schema,\n        shouldRegister: () => {\n            if (!is_function_call_enabled) {\n                return false;\n            }\n            const settings = useSettingsStore().settings;\n            return settings..;\n        },\n        action: onVariableUpdatedCall,\n        formatMessage: () => '',\n    });\n\n    /* () llm \n    const mvuRoundUpdateSchema = Object.freeze({\n        $schema: 'http://json-schema.org/draft-04/schema#',\n        type: 'object',\n        additionalProperties: false,\n\n        properties: {},\n    });\n\n    registerFunctionTool({\n        name: MVUUpdateCallFunctionName,\n        displayName: 'MVU update',\n        stealth: false,\n        description:\n            '**ALWAYS** call this function to end each response. By use this tool, output the `<UpdateVariable>` block is no longer necessary;',\n        parameters: mvuRoundUpdateSchema,\n        shouldRegister: () => {\n            const settings = useSettingsStore().settings;\n            if (settings. === '') {\n                const message_id = getLastMessageId();\n                const chat_message = getChatMessages(message_id).at(-1);\n                if (!chat_message) {\n                    return false;\n                }\n\n                let message_content = chat_message.message;\n                //\n                if (message_content.indexOf(``) != -1)\n                    return false;\n                return true;\n            }\n            return false;\n        },\n        action: onStoryEndCall,\n        formatMessage: () => '',\n    });\n    */\n}\n\nexport function overrideToolRequest(generate_data: any) {\n    const settings = useSettingsStore().settings;\n    if (settings. !== '' || settings.. !== true) {\n        return;\n    }\n    if (!is_function_call_enabled) {\n        return;\n    }\n    if (generate_data.tools !== undefined && _.size(generate_data.tools) > 0) {\n        // v3 required\n        /*\n        const message_id = getLastMessageId();\n        const chat_message = getChatMessages(message_id).at(-1);\n        if (!chat_message) {\n            generate_data.tool_choice = 'auto';\n            return;\n        }\n        const function_info = _.get(chat_message, 'extra.tool_invocations');\n        if (_.isArray(function_info)) {\n            //required prompt\n            generate_data.tool_choice = 'required';\n            return;\n        }\n        */\n        generate_data.tool_choice = 'required';\n    }\n}\n","// Module\nvar code = `<p></p> `;\n// Exports\nexport default code;","import { defineComponent as _defineComponent } from 'vue'\nimport { createElementVNode as _createElementVNode, unref as _unref, vModelCheckbox as _vModelCheckbox, withDirectives as _withDirectives, vModelSelect as _vModelSelect, createTextVNode as _createTextVNode, vModelText as _vModelText, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, Fragment as _Fragment, toDisplayString as _toDisplayString, vShow as _vShow, Transition as _Transition, withCtx as _withCtx, createVNode as _createVNode, renderList as _renderList } from \"vue\"\n\nconst _hoisted_1 = { class: \"inline-drawer\" }\nconst _hoisted_2 = { class: \"inline-drawer-content\" }\nconst _hoisted_3 = { class: \"flex-container flexFlowColumn\" }\nconst _hoisted_4 = {\n  class: \"checkbox_label\",\n  for: \"mvu_notification_error\"\n}\nconst _hoisted_5 = {\n  class: \"checkbox_label\",\n  for: \"mvu_notification_extra_model_parsing\"\n}\nconst _hoisted_6 = { class: \"flex-container flexFlowColumn\" }\nconst _hoisted_7 = {\n  class: \"checkbox_label\",\n  for: \"mvu_extra_model_send_preset\"\n}\nconst _hoisted_8 = {\n  class: \"checkbox_label\",\n  for: \"mvu_extra_model_use_function_calling\"\n}\nconst _hoisted_9 = { class: \"flex-container flexFlowColumn\" }\nconst _hoisted_10 = { class: \"flex-container flexFlowColumn\" }\nconst _hoisted_11 = { class: \"flex-container flexFlowColumn\" }\nconst _hoisted_12 = { key: 0 }\nconst _hoisted_13 = { class: \"flex-container flexFlowColumn\" }\nconst _hoisted_14 = [\"disabled\"]\nconst _hoisted_15 = { class: \"flex-container flexFlowColumn\" }\nconst _hoisted_16 = [\"disabled\"]\nconst _hoisted_17 = { class: \"flex-container flexFlowColumn\" }\nconst _hoisted_18 = [\"disabled\"]\nconst _hoisted_19 = { class: \"flex-container flexFlowColumn\" }\nconst _hoisted_20 = [\"disabled\"]\nconst _hoisted_21 = { class: \"flex-container flexFlowColumn\" }\nconst _hoisted_22 = { class: \"collapse-container\" }\nconst _hoisted_23 = { class: \"collapse-content\" }\nconst _hoisted_24 = { class: \"flex-container flexFlowColumn\" }\nconst _hoisted_25 = { class: \"flex-container flexFlowColumn\" }\nconst _hoisted_26 = { class: \"flex-container flexFlowColumn\" }\nconst _hoisted_27 = { class: \"collapse-container\" }\nconst _hoisted_28 = { class: \"collapse-content\" }\nconst _hoisted_29 = {\n  class: \"checkbox_label\",\n  for: \"mvu_update_to_chat\"\n}\nconst _hoisted_30 = {\n  class: \"checkbox_label\",\n  for: \"mvu_auto_clean_checkbox\"\n}\nconst _hoisted_31 = { class: \"flex-container flexFlowColumn\" }\nconst _hoisted_32 = { class: \"flex-container flex\" }\nconst _hoisted_33 = [\"onClick\"]\n\nimport { buttons } from '@/button';\nimport panel_extra_mode_help from '@/panel_extra_mode_help.md';\nimport panel_method_help from '@/panel_method_help.md';\nimport chat_variable_help from '@/chat_variable_help.md';\nimport { useSettingsStore } from '@/settings';\nimport { getSillyTavernVersion, getTavernHelperVersion } from '@/util';\nimport { compare } from 'compare-versions';\nimport { ref, watch } from 'vue';\n\n\nexport default /*@__PURE__*/_defineComponent({\n  __name: 'Panel',\n  setup(__props) {\n\nconst store = useSettingsStore();\n\nconst additional_extra_configuration_supported = compare(getTavernHelperVersion(), '4.0.14', '>=');\n\nconst cleanup_is_open = ref(false);\nconst compatibility_is_open = ref(false);\n\nwatch(\n    () => store.settings.,\n    value => {\n        if (value === '' && compare(getSillyTavernVersion(), '1.13.4', '<')) {\n            toastr.error(\n                \"'' 1.13.4\",\n                \"[MVU]''\",\n                { timeOut: 5000 }\n            );\n            store.settings. = 'AI';\n        }\n    }\n);\n\nwatch(\n    () => store.settings..,\n    value => {\n        if (value === true) {\n            if (!SillyTavern.ToolManager.isToolCallingSupported()) {\n                toastr.error(\n                    \" API  () ''\",\n                    \"[MVU]''\",\n                    {\n                        timeOut: 5000,\n                    }\n                );\n            }\n            if (SillyTavern.chatCompletionSettings.function_calling === false) {\n                toastr.error(\"''\", \"[MVU]''\", {\n                    timeOut: 5000,\n                });\n            }\n            store.settings.. = true;\n        }\n    }\n);\n\nasync function showMethodHelp() {\n    SillyTavern.callGenericPopup(panel_method_help, SillyTavern.POPUP_TYPE.TEXT, '', {\n        allowVerticalScrolling: true,\n        leftAlign: true,\n        wide: true,\n    });\n}\n\nasync function showChatVarHelp() {\n    SillyTavern.callGenericPopup(chat_variable_help, SillyTavern.POPUP_TYPE.TEXT, '', {\n        allowVerticalScrolling: true,\n        leftAlign: true,\n        wide: true,\n    });\n}\n\nasync function showExtraModeHelp() {\n    SillyTavern.callGenericPopup(panel_extra_mode_help, SillyTavern.POPUP_TYPE.TEXT, '', {\n        allowVerticalScrolling: true,\n        leftAlign: true,\n        wide: true,\n    });\n}\n\nreturn (_ctx: any,_cache: any) => {\n  return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n    _cache[48] || (_cache[48] = _createElementVNode(\"div\", { class: \"inline-drawer-toggle inline-drawer-header\" }, [\n      _createElementVNode(\"b\", null, \"MVU \"),\n      _createElementVNode(\"div\", { class: \"inline-drawer-icon fa-solid fa-circle-chevron-down down\" })\n    ], -1 /* CACHED */)),\n    _createElementVNode(\"div\", _hoisted_2, [\n      _createElementVNode(\"div\", _hoisted_3, [\n        _cache[22] || (_cache[22] = _createElementVNode(\"div\", null, [\n          _createElementVNode(\"strong\", null, \"\")\n        ], -1 /* CACHED */)),\n        _createElementVNode(\"label\", _hoisted_4, [\n          _withDirectives(_createElementVNode(\"input\", {\n            id: \"mvu_notification_error\",\n            \"onUpdate:modelValue\": _cache[0] || (_cache[0] = ($event: any) => ((_unref(store).settings..) = $event)),\n            type: \"checkbox\"\n          }, null, 512 /* NEED_PATCH */), [\n            [_vModelCheckbox, _unref(store).settings..]\n          ]),\n          _cache[20] || (_cache[20] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */))\n        ]),\n        _createElementVNode(\"label\", _hoisted_5, [\n          _withDirectives(_createElementVNode(\"input\", {\n            id: \"mvu_notification_extra_model_parsing\",\n            \"onUpdate:modelValue\": _cache[1] || (_cache[1] = ($event: any) => ((_unref(store).settings..) = $event)),\n            type: \"checkbox\"\n          }, null, 512 /* NEED_PATCH */), [\n            [_vModelCheckbox, _unref(store).settings..]\n          ]),\n          _cache[21] || (_cache[21] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */))\n        ])\n      ]),\n      _cache[45] || (_cache[45] = _createElementVNode(\"hr\", null, null, -1 /* CACHED */)),\n      _createElementVNode(\"div\", _hoisted_6, [\n        _createElementVNode(\"div\", null, [\n          _cache[23] || (_cache[23] = _createElementVNode(\"strong\", null, \"\", -1 /* CACHED */)),\n          _createElementVNode(\"i\", {\n            class: \"fa-solid fa-circle-question fa-sm note-link-span\",\n            style: {\"cursor\":\"pointer\"},\n            onClick: showMethodHelp\n          })\n        ]),\n        _withDirectives(_createElementVNode(\"select\", {\n          id: \"mvu_update_method\",\n          \"onUpdate:modelValue\": _cache[2] || (_cache[2] = ($event: any) => ((_unref(store).settings.) = $event)),\n          class: \"text_pole\"\n        }, [...(_cache[24] || (_cache[24] = [\n          _createElementVNode(\"option\", { value: \"AI\" }, \"AI\", -1 /* CACHED */),\n          _createElementVNode(\"option\", { value: \"\" }, \"\", -1 /* CACHED */)\n        ]))], 512 /* NEED_PATCH */), [\n          [_vModelSelect, _unref(store).settings.]\n        ]),\n        (_unref(store).settings. === '')\n          ? (_openBlock(), _createElementBlock(_Fragment, { key: 0 }, [\n              _createElementVNode(\"label\", null, [\n                _cache[25] || (_cache[25] = _createTextVNode(\"  \", -1 /* CACHED */)),\n                _createElementVNode(\"i\", {\n                  class: \"fa-solid fa-circle-question fa-sm note-link-span\",\n                  style: {\"cursor\":\"pointer\"},\n                  onClick: showExtraModeHelp\n                })\n              ]),\n              _createElementVNode(\"label\", _hoisted_7, [\n                _withDirectives(_createElementVNode(\"input\", {\n                  id: \"mvu_extra_model_send_preset\",\n                  \"onUpdate:modelValue\": _cache[3] || (_cache[3] = ($event: any) => ((_unref(store).settings..) = $event)),\n                  type: \"checkbox\"\n                }, null, 512 /* NEED_PATCH */), [\n                  [_vModelCheckbox, _unref(store).settings..]\n                ]),\n                _cache[26] || (_cache[26] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */))\n              ]),\n              _createElementVNode(\"label\", _hoisted_8, [\n                _withDirectives(_createElementVNode(\"input\", {\n                  id: \"mvu_extra_model_use_function_calling\",\n                  \"onUpdate:modelValue\": _cache[4] || (_cache[4] = ($event: any) => ((_unref(store).settings..) = $event)),\n                  type: \"checkbox\"\n                }, null, 512 /* NEED_PATCH */), [\n                  [_vModelCheckbox, _unref(store).settings..]\n                ]),\n                _cache[27] || (_cache[27] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */))\n              ]),\n              _cache[37] || (_cache[37] = _createElementVNode(\"label\", { for: \"mvu_extra_model_source\" }, \"\", -1 /* CACHED */)),\n              _withDirectives(_createElementVNode(\"select\", {\n                id: \"mvu_extra_model_source\",\n                \"onUpdate:modelValue\": _cache[5] || (_cache[5] = ($event: any) => ((_unref(store).settings..) = $event)),\n                class: \"text_pole\"\n              }, [...(_cache[28] || (_cache[28] = [\n                _createElementVNode(\"option\", { value: \"\" }, \"\", -1 /* CACHED */),\n                _createElementVNode(\"option\", { value: \"\" }, \"\", -1 /* CACHED */)\n              ]))], 512 /* NEED_PATCH */), [\n                [_vModelSelect, _unref(store).settings..]\n              ]),\n              (_unref(store).settings.. === '')\n                ? (_openBlock(), _createElementBlock(_Fragment, { key: 0 }, [\n                    _createElementVNode(\"div\", _hoisted_9, [\n                      _cache[29] || (_cache[29] = _createElementVNode(\"label\", { for: \"mvu_api_url\" }, \"API \", -1 /* CACHED */)),\n                      _withDirectives(_createElementVNode(\"input\", {\n                        id: \"mvu_api_url\",\n                        \"onUpdate:modelValue\": _cache[6] || (_cache[6] = ($event: any) => ((_unref(store).settings..api) = $event)),\n                        type: \"text\",\n                        class: \"text_pole\",\n                        placeholder: \"http://localhost:1234/v1\"\n                      }, null, 512 /* NEED_PATCH */), [\n                        [_vModelText, _unref(store).settings..api]\n                      ])\n                    ]),\n                    _createElementVNode(\"div\", _hoisted_10, [\n                      _cache[30] || (_cache[30] = _createElementVNode(\"label\", { for: \"mvu_api_key\" }, \"API \", -1 /* CACHED */)),\n                      _withDirectives(_createElementVNode(\"input\", {\n                        id: \"mvu_api_key\",\n                        \"onUpdate:modelValue\": _cache[7] || (_cache[7] = ($event: any) => ((_unref(store).settings..) = $event)),\n                        type: \"password\",\n                        class: \"text_pole\",\n                        placeholder: \"\"\n                      }, null, 512 /* NEED_PATCH */), [\n                        [_vModelText, _unref(store).settings..]\n                      ])\n                    ]),\n                    _createElementVNode(\"div\", _hoisted_11, [\n                      _cache[31] || (_cache[31] = _createElementVNode(\"label\", { for: \"mvu_model_name\" }, \"\", -1 /* CACHED */)),\n                      _withDirectives(_createElementVNode(\"input\", {\n                        id: \"mvu_model_name\",\n                        \"onUpdate:modelValue\": _cache[8] || (_cache[8] = ($event: any) => ((_unref(store).settings..) = $event)),\n                        type: \"text\",\n                        class: \"text_pole\",\n                        placeholder: \"gemini-2.5-flash\"\n                      }, null, 512 /* NEED_PATCH */), [\n                        [_vModelText, _unref(store).settings..]\n                      ])\n                    ]),\n                    (!_unref(additional_extra_configuration_supported))\n                      ? (_openBlock(), _createElementBlock(\"div\", _hoisted_12, [...(_cache[32] || (_cache[32] = [\n                          _createElementVNode(\"hr\", null, null, -1 /* CACHED */),\n                          _createTextVNode(\" ,  \", -1 /* CACHED */)\n                        ]))]))\n                      : _createCommentVNode(\"v-if\", true),\n                    _createElementVNode(\"div\", _hoisted_13, [\n                      _cache[33] || (_cache[33] = _createElementVNode(\"label\", { for: \"mvu_temperature\" }, \"\", -1 /* CACHED */)),\n                      _withDirectives(_createElementVNode(\"input\", {\n                        id: \"mvu_temperature\",\n                        \"onUpdate:modelValue\": _cache[9] || (_cache[9] = ($event: any) => ((_unref(store).settings..) = $event)),\n                        disabled: !_unref(additional_extra_configuration_supported),\n                        type: \"number\",\n                        class: \"text_pole\",\n                        min: \"0\",\n                        max: \"2\",\n                        step: \"0.01\",\n                        placeholder: \"1.0\"\n                      }, null, 8 /* PROPS */, _hoisted_14), [\n                        [_vModelText, _unref(store).settings..]\n                      ])\n                    ]),\n                    _createElementVNode(\"div\", _hoisted_15, [\n                      _cache[34] || (_cache[34] = _createElementVNode(\"label\", { for: \"mvu_frequency_penalty\" }, \"\", -1 /* CACHED */)),\n                      _withDirectives(_createElementVNode(\"input\", {\n                        id: \"mvu_frequency_penalty\",\n                        \"onUpdate:modelValue\": _cache[10] || (_cache[10] = ($event: any) => ((_unref(store).settings..) = $event)),\n                        disabled: !_unref(additional_extra_configuration_supported),\n                        type: \"number\",\n                        class: \"text_pole\",\n                        min: \"-2\",\n                        max: \"2\",\n                        step: \"0.01\",\n                        placeholder: \"0.0\"\n                      }, null, 8 /* PROPS */, _hoisted_16), [\n                        [_vModelText, _unref(store).settings..]\n                      ])\n                    ]),\n                    _createElementVNode(\"div\", _hoisted_17, [\n                      _cache[35] || (_cache[35] = _createElementVNode(\"label\", { for: \"mvu_presence_penalty\" }, \"\", -1 /* CACHED */)),\n                      _withDirectives(_createElementVNode(\"input\", {\n                        id: \"mvu_presence_penalty\",\n                        \"onUpdate:modelValue\": _cache[11] || (_cache[11] = ($event: any) => ((_unref(store).settings..) = $event)),\n                        disabled: !_unref(additional_extra_configuration_supported),\n                        type: \"number\",\n                        class: \"text_pole\",\n                        min: \"-2\",\n                        max: \"2\",\n                        step: \"0.01\",\n                        placeholder: \"0.0\"\n                      }, null, 8 /* PROPS */, _hoisted_18), [\n                        [_vModelText, _unref(store).settings..]\n                      ])\n                    ]),\n                    _createElementVNode(\"div\", _hoisted_19, [\n                      _cache[36] || (_cache[36] = _createElementVNode(\"label\", { for: \"mvu_max_tokens\" }, \"token\", -1 /* CACHED */)),\n                      _withDirectives(_createElementVNode(\"input\", {\n                        id: \"mvu_max_tokens\",\n                        \"onUpdate:modelValue\": _cache[12] || (_cache[12] = ($event: any) => ((_unref(store).settings..token) = $event)),\n                        disabled: !_unref(additional_extra_configuration_supported),\n                        type: \"number\",\n                        class: \"text_pole\",\n                        min: \"0\",\n                        step: \"128\",\n                        placeholder: \"1000\"\n                      }, null, 8 /* PROPS */, _hoisted_20), [\n                        [_vModelText, _unref(store).settings..token]\n                      ])\n                    ])\n                  ], 64 /* STABLE_FRAGMENT */))\n                : _createCommentVNode(\"v-if\", true)\n            ], 64 /* STABLE_FRAGMENT */))\n          : _createCommentVNode(\"v-if\", true)\n      ]),\n      _cache[46] || (_cache[46] = _createElementVNode(\"hr\", null, null, -1 /* CACHED */)),\n      _createElementVNode(\"div\", _hoisted_21, [\n        _cache[43] || (_cache[43] = _createElementVNode(\"div\", null, [\n          _createElementVNode(\"strong\", null, \"\")\n        ], -1 /* CACHED */)),\n        _createElementVNode(\"div\", _hoisted_22, [\n          _createElementVNode(\"button\", {\n            style: {\"background\":\"transparent\"},\n            onClick: _cache[13] || (_cache[13] = ($event: any) => (cleanup_is_open.value = !cleanup_is_open.value))\n          }, _toDisplayString(cleanup_is_open.value ? '-' : '-'), 1 /* TEXT */),\n          _createVNode(_Transition, {\n            name: \"collapse\",\n            persisted: \"\"\n          }, {\n            default: _withCtx(() => [\n              _withDirectives(_createElementVNode(\"div\", _hoisted_23, [\n                _createElementVNode(\"div\", _hoisted_24, [\n                  _cache[38] || (_cache[38] = _createElementVNode(\"label\", { for: \"mvu_snapshot_interval\" }, \"\", -1 /* CACHED */)),\n                  _withDirectives(_createElementVNode(\"input\", {\n                    id: \"mvu_snapshot_interval\",\n                    \"onUpdate:modelValue\": _cache[14] || (_cache[14] = ($event: any) => ((_unref(store).settings.) = $event)),\n                    type: \"number\",\n                    min: \"1\",\n                    step: \"1\",\n                    class: \"text_pole\",\n                    placeholder: \"50\"\n                  }, null, 512 /* NEED_PATCH */), [\n                    [\n                      _vModelText,\n                      _unref(store).settings.,\n                      void 0,\n                      { number: true }\n                    ]\n                  ])\n                ]),\n                _createElementVNode(\"div\", _hoisted_25, [\n                  _cache[39] || (_cache[39] = _createElementVNode(\"label\", { for: \"mvu_snapshot_interval\" }, \"\", -1 /* CACHED */)),\n                  _withDirectives(_createElementVNode(\"input\", {\n                    id: \"mvu_snapshot_interval\",\n                    \"onUpdate:modelValue\": _cache[15] || (_cache[15] = ($event: any) => ((\n                                        _unref(store).settings.auto_cleanup.\n                                    ) = $event)),\n                    type: \"number\",\n                    min: \"1\",\n                    step: \"1\",\n                    class: \"text_pole\",\n                    placeholder: \"50\"\n                  }, null, 512 /* NEED_PATCH */), [\n                    [\n                      _vModelText,\n                      \n                                        _unref(store).settings.auto_cleanup.\n                                    ,\n                      void 0,\n                      { number: true }\n                    ]\n                  ])\n                ]),\n                _createElementVNode(\"div\", _hoisted_26, [\n                  _cache[40] || (_cache[40] = _createElementVNode(\"label\", { for: \"mvu_snapshot_interval\" }, \"\", -1 /* CACHED */)),\n                  _withDirectives(_createElementVNode(\"input\", {\n                    id: \"mvu_snapshot_interval\",\n                    \"onUpdate:modelValue\": _cache[16] || (_cache[16] = ($event: any) => ((\n                                        _unref(store).settings.auto_cleanup.\n                                    ) = $event)),\n                    type: \"number\",\n                    min: \"1\",\n                    step: \"1\",\n                    class: \"text_pole\",\n                    placeholder: \"50\"\n                  }, null, 512 /* NEED_PATCH */), [\n                    [\n                      _vModelText,\n                      \n                                        _unref(store).settings.auto_cleanup.\n                                    ,\n                      void 0,\n                      { number: true }\n                    ]\n                  ])\n                ])\n              ], 512 /* NEED_PATCH */), [\n                [_vShow, cleanup_is_open.value]\n              ])\n            ]),\n            _: 1 /* STABLE */\n          })\n        ]),\n        _createElementVNode(\"div\", _hoisted_27, [\n          _createElementVNode(\"button\", {\n            style: {\"background\":\"transparent\"},\n            onClick: _cache[17] || (_cache[17] = ($event: any) => (compatibility_is_open.value = !compatibility_is_open.value))\n          }, _toDisplayString(compatibility_is_open.value ? '-' : '-'), 1 /* TEXT */),\n          _createVNode(_Transition, {\n            name: \"collapse\",\n            persisted: \"\"\n          }, {\n            default: _withCtx(() => [\n              _withDirectives(_createElementVNode(\"div\", _hoisted_28, [\n                _createElementVNode(\"label\", _hoisted_29, [\n                  _withDirectives(_createElementVNode(\"input\", {\n                    id: \"mvu_update_to_chat\",\n                    \"onUpdate:modelValue\": _cache[18] || (_cache[18] = ($event: any) => ((_unref(store).settings.) = $event)),\n                    type: \"checkbox\"\n                  }, null, 512 /* NEED_PATCH */), [\n                    [_vModelCheckbox, _unref(store).settings.]\n                  ]),\n                  _cache[41] || (_cache[41] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)),\n                  _createElementVNode(\"i\", {\n                    class: \"fa-solid fa-circle-question fa-sm note-link-span\",\n                    style: {\"cursor\":\"pointer\"},\n                    onClick: showChatVarHelp\n                  })\n                ])\n              ], 512 /* NEED_PATCH */), [\n                [_vShow, compatibility_is_open.value]\n              ])\n            ]),\n            _: 1 /* STABLE */\n          })\n        ]),\n        _createElementVNode(\"label\", _hoisted_30, [\n          _withDirectives(_createElementVNode(\"input\", {\n            id: \"mvu_auto_clean_checkbox\",\n            \"onUpdate:modelValue\": _cache[19] || (_cache[19] = ($event: any) => ((_unref(store).settings.auto_cleanup.) = $event)),\n            type: \"checkbox\"\n          }, null, 512 /* NEED_PATCH */), [\n            [_vModelCheckbox, _unref(store).settings.auto_cleanup.]\n          ]),\n          _cache[42] || (_cache[42] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */))\n        ])\n      ]),\n      _cache[47] || (_cache[47] = _createElementVNode(\"hr\", null, null, -1 /* CACHED */)),\n      _createElementVNode(\"div\", _hoisted_31, [\n        _cache[44] || (_cache[44] = _createElementVNode(\"div\", null, [\n          _createElementVNode(\"strong\", null, \"\")\n        ], -1 /* CACHED */)),\n        _createElementVNode(\"div\", _hoisted_32, [\n          (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(buttons), (button) => {\n            return (_openBlock(), _createElementBlock(\"div\", {\n              key: button.name,\n              class: \"menu_button menu_button_icon interactable\",\n              tabindex: \"0\",\n              role: \"button\",\n              onClick: button.function\n            }, _toDisplayString(button.name), 9 /* TEXT, PROPS */, _hoisted_33))\n          }), 128 /* KEYED_FRAGMENT */))\n        ])\n      ])\n    ])\n  ]))\n}\n}\n\n})","<template>\n    <div class=\"inline-drawer\">\n        <div class=\"inline-drawer-toggle inline-drawer-header\">\n            <b>MVU </b>\n            <div class=\"inline-drawer-icon fa-solid fa-circle-chevron-down down\"></div>\n        </div>\n\n        <div class=\"inline-drawer-content\">\n            <div class=\"flex-container flexFlowColumn\">\n                <div><strong></strong></div>\n                <label class=\"checkbox_label\" for=\"mvu_notification_error\">\n                    <input\n                        id=\"mvu_notification_error\"\n                        v-model=\"store.settings..\"\n                        type=\"checkbox\"\n                    />\n                    <span></span>\n                </label>\n                <label class=\"checkbox_label\" for=\"mvu_notification_extra_model_parsing\">\n                    <input\n                        id=\"mvu_notification_extra_model_parsing\"\n                        v-model=\"store.settings..\"\n                        type=\"checkbox\"\n                    />\n                    <span></span>\n                </label>\n            </div>\n\n            <hr />\n\n            <div class=\"flex-container flexFlowColumn\">\n                <div>\n                    <strong></strong>\n                    <i\n                        class=\"fa-solid fa-circle-question fa-sm note-link-span\"\n                        style=\"cursor: pointer\"\n                        @click=\"showMethodHelp\"\n                    />\n                </div>\n                <select id=\"mvu_update_method\" v-model=\"store.settings.\" class=\"text_pole\">\n                    <option value=\"AI\">AI</option>\n                    <option value=\"\"></option>\n                </select>\n\n                <template v-if=\"store.settings. === ''\">\n                    <label>\n                        \n                        <i\n                            class=\"fa-solid fa-circle-question fa-sm note-link-span\"\n                            style=\"cursor: pointer\"\n                            @click=\"showExtraModeHelp\"\n                        />\n                    </label>\n                    <label class=\"checkbox_label\" for=\"mvu_extra_model_send_preset\">\n                        <input\n                            id=\"mvu_extra_model_send_preset\"\n                            v-model=\"store.settings..\"\n                            type=\"checkbox\"\n                        />\n                        <span></span>\n                    </label>\n                    <label class=\"checkbox_label\" for=\"mvu_extra_model_use_function_calling\">\n                        <input\n                            id=\"mvu_extra_model_use_function_calling\"\n                            v-model=\"store.settings..\"\n                            type=\"checkbox\"\n                        />\n                        <span></span>\n                    </label>\n\n                    <label for=\"mvu_extra_model_source\"></label>\n                    <select\n                        id=\"mvu_extra_model_source\"\n                        v-model=\"store.settings..\"\n                        class=\"text_pole\"\n                    >\n                        <option value=\"\"></option>\n                        <option value=\"\"></option>\n                    </select>\n\n                    <template v-if=\"store.settings.. === ''\">\n                        <div class=\"flex-container flexFlowColumn\">\n                            <label for=\"mvu_api_url\">API </label>\n                            <input\n                                id=\"mvu_api_url\"\n                                v-model=\"store.settings..api\"\n                                type=\"text\"\n                                class=\"text_pole\"\n                                placeholder=\"http://localhost:1234/v1\"\n                            />\n                        </div>\n\n                        <div class=\"flex-container flexFlowColumn\">\n                            <label for=\"mvu_api_key\">API </label>\n                            <input\n                                id=\"mvu_api_key\"\n                                v-model=\"store.settings..\"\n                                type=\"password\"\n                                class=\"text_pole\"\n                                placeholder=\"\"\n                            />\n                        </div>\n\n                        <div class=\"flex-container flexFlowColumn\">\n                            <label for=\"mvu_model_name\"></label>\n                            <input\n                                id=\"mvu_model_name\"\n                                v-model=\"store.settings..\"\n                                type=\"text\"\n                                class=\"text_pole\"\n                                placeholder=\"gemini-2.5-flash\"\n                            />\n                        </div>\n\n                        <div v-if=\"!additional_extra_configuration_supported\">\n                            <hr />\n                            , \n                        </div>\n\n                        <div class=\"flex-container flexFlowColumn\">\n                            <label for=\"mvu_temperature\"></label>\n                            <input\n                                id=\"mvu_temperature\"\n                                v-model=\"store.settings..\"\n                                :disabled=\"!additional_extra_configuration_supported\"\n                                type=\"number\"\n                                class=\"text_pole\"\n                                min=\"0\"\n                                max=\"2\"\n                                step=\"0.01\"\n                                placeholder=\"1.0\"\n                            />\n                        </div>\n\n                        <div class=\"flex-container flexFlowColumn\">\n                            <label for=\"mvu_frequency_penalty\"></label>\n                            <input\n                                id=\"mvu_frequency_penalty\"\n                                v-model=\"store.settings..\"\n                                :disabled=\"!additional_extra_configuration_supported\"\n                                type=\"number\"\n                                class=\"text_pole\"\n                                min=\"-2\"\n                                max=\"2\"\n                                step=\"0.01\"\n                                placeholder=\"0.0\"\n                            />\n                        </div>\n\n                        <div class=\"flex-container flexFlowColumn\">\n                            <label for=\"mvu_presence_penalty\"></label>\n                            <input\n                                id=\"mvu_presence_penalty\"\n                                v-model=\"store.settings..\"\n                                :disabled=\"!additional_extra_configuration_supported\"\n                                type=\"number\"\n                                class=\"text_pole\"\n                                min=\"-2\"\n                                max=\"2\"\n                                step=\"0.01\"\n                                placeholder=\"0.0\"\n                            />\n                        </div>\n\n                        <div class=\"flex-container flexFlowColumn\">\n                            <label for=\"mvu_max_tokens\">token</label>\n                            <input\n                                id=\"mvu_max_tokens\"\n                                v-model=\"store.settings..token\"\n                                :disabled=\"!additional_extra_configuration_supported\"\n                                type=\"number\"\n                                class=\"text_pole\"\n                                min=\"0\"\n                                step=\"128\"\n                                placeholder=\"1000\"\n                            />\n                        </div>\n                    </template>\n                </template>\n            </div>\n\n            <hr />\n\n            <div class=\"flex-container flexFlowColumn\">\n                <div>\n                    <strong></strong>\n                </div>\n                <div class=\"collapse-container\">\n                    <button\n                        style=\"background: transparent\"\n                        @click=\"cleanup_is_open = !cleanup_is_open\"\n                    >\n                        {{ cleanup_is_open ? '-' : '-' }}\n                    </button>\n\n                    <Transition name=\"collapse\">\n                        <div v-show=\"cleanup_is_open\" class=\"collapse-content\">\n                            <div class=\"flex-container flexFlowColumn\">\n                                <label for=\"mvu_snapshot_interval\"></label>\n                                <input\n                                    id=\"mvu_snapshot_interval\"\n                                    v-model.number=\"store.settings.\"\n                                    type=\"number\"\n                                    min=\"1\"\n                                    step=\"1\"\n                                    class=\"text_pole\"\n                                    placeholder=\"50\"\n                                />\n                            </div>\n\n                            <div class=\"flex-container flexFlowColumn\">\n                                <label for=\"mvu_snapshot_interval\"></label>\n                                <input\n                                    id=\"mvu_snapshot_interval\"\n                                    v-model.number=\"\n                                        store.settings.auto_cleanup.\n                                    \"\n                                    type=\"number\"\n                                    min=\"1\"\n                                    step=\"1\"\n                                    class=\"text_pole\"\n                                    placeholder=\"50\"\n                                />\n                            </div>\n\n                            <div class=\"flex-container flexFlowColumn\">\n                                <label for=\"mvu_snapshot_interval\"></label>\n                                <input\n                                    id=\"mvu_snapshot_interval\"\n                                    v-model.number=\"\n                                        store.settings.auto_cleanup.\n                                    \"\n                                    type=\"number\"\n                                    min=\"1\"\n                                    step=\"1\"\n                                    class=\"text_pole\"\n                                    placeholder=\"50\"\n                                />\n                            </div>\n                        </div>\n                    </Transition>\n                </div>\n\n                <div class=\"collapse-container\">\n                    <button\n                        style=\"background: transparent\"\n                        @click=\"compatibility_is_open = !compatibility_is_open\"\n                    >\n                        {{ compatibility_is_open ? '-' : '-' }}\n                    </button>\n                    <Transition name=\"collapse\">\n                        <div v-show=\"compatibility_is_open\" class=\"collapse-content\">\n                            <label class=\"checkbox_label\" for=\"mvu_update_to_chat\">\n                                <input\n                                    id=\"mvu_update_to_chat\"\n                                    v-model=\"store.settings.\"\n                                    type=\"checkbox\"\n                                />\n                                <span></span>\n                                <i\n                                    class=\"fa-solid fa-circle-question fa-sm note-link-span\"\n                                    style=\"cursor: pointer\"\n                                    @click=\"showChatVarHelp\"\n                                />\n                            </label>\n                        </div>\n                    </Transition>\n                </div>\n\n                <label class=\"checkbox_label\" for=\"mvu_auto_clean_checkbox\">\n                    <input\n                        id=\"mvu_auto_clean_checkbox\"\n                        v-model=\"store.settings.auto_cleanup.\"\n                        type=\"checkbox\"\n                    />\n                    <span></span>\n                </label>\n            </div>\n\n            <hr />\n\n            <div class=\"flex-container flexFlowColumn\">\n                <div><strong></strong></div>\n                <div class=\"flex-container flex\">\n                    <div\n                        v-for=\"button in buttons\"\n                        :key=\"button.name\"\n                        class=\"menu_button menu_button_icon interactable\"\n                        tabindex=\"0\"\n                        role=\"button\"\n                        @click=\"button.function\"\n                    >\n                        {{ button.name }}\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { buttons } from '@/button';\nimport panel_extra_mode_help from '@/panel_extra_mode_help.md';\nimport panel_method_help from '@/panel_method_help.md';\nimport chat_variable_help from '@/chat_variable_help.md';\nimport { useSettingsStore } from '@/settings';\nimport { getSillyTavernVersion, getTavernHelperVersion } from '@/util';\nimport { compare } from 'compare-versions';\nimport { ref, watch } from 'vue';\n\nconst store = useSettingsStore();\n\nconst additional_extra_configuration_supported = compare(getTavernHelperVersion(), '4.0.14', '>=');\n\nconst cleanup_is_open = ref(false);\nconst compatibility_is_open = ref(false);\n\nwatch(\n    () => store.settings.,\n    value => {\n        if (value === '' && compare(getSillyTavernVersion(), '1.13.4', '<')) {\n            toastr.error(\n                \"'' 1.13.4\",\n                \"[MVU]''\",\n                { timeOut: 5000 }\n            );\n            store.settings. = 'AI';\n        }\n    }\n);\n\nwatch(\n    () => store.settings..,\n    value => {\n        if (value === true) {\n            if (!SillyTavern.ToolManager.isToolCallingSupported()) {\n                toastr.error(\n                    \" API  () ''\",\n                    \"[MVU]''\",\n                    {\n                        timeOut: 5000,\n                    }\n                );\n            }\n            if (SillyTavern.chatCompletionSettings.function_calling === false) {\n                toastr.error(\"''\", \"[MVU]''\", {\n                    timeOut: 5000,\n                });\n            }\n            store.settings.. = true;\n        }\n    }\n);\n\nasync function showMethodHelp() {\n    SillyTavern.callGenericPopup(panel_method_help, SillyTavern.POPUP_TYPE.TEXT, '', {\n        allowVerticalScrolling: true,\n        leftAlign: true,\n        wide: true,\n    });\n}\n\nasync function showChatVarHelp() {\n    SillyTavern.callGenericPopup(chat_variable_help, SillyTavern.POPUP_TYPE.TEXT, '', {\n        allowVerticalScrolling: true,\n        leftAlign: true,\n        wide: true,\n    });\n}\n\nasync function showExtraModeHelp() {\n    SillyTavern.callGenericPopup(panel_extra_mode_help, SillyTavern.POPUP_TYPE.TEXT, '', {\n        allowVerticalScrolling: true,\n        leftAlign: true,\n        wide: true,\n    });\n}\n</script>\n\n<style scoped>\n.collapse-container {\n    border: 1px solid #ccc;\n    border-radius: 4px;\n    padding: 2px;\n    background: transparent;\n}\n\n/*  */\n.collapse-enter-from,\n.collapse-leave-to {\n    max-height: 0;\n    opacity: 0;\n    overflow: hidden;\n}\n\n.collapse-enter-to,\n.collapse-leave-from {\n    max-height: 240px; /*  */\n    opacity: 1;\n}\n\n.collapse-enter-active,\n.collapse-leave-active {\n    transition: all 0.3s ease;\n}\n\n.collapse-content {\n    margin-top: 2px;\n    padding: 2px;\n    background-color: transparent;\n    border-radius: 4px;\n}\n</style>\n","// Module\nvar code = `<h1></h1> <h2></h2> <p></p> <ul> <li><strong>AI</strong> AI AI </li> <li><strong></strong> AI  AI  <ul> <li> <code>[mvu_plot]</code>  AI</li> <li> <code>[mvu_update]</code>  AI</li> <li> <code>[mvu_plot]</code>  <code>[mvu_update]</code>  AI</li> </ul> </li> </ul> <p>AI MVU AI</p> <h2></h2> <p></p> <p>MVU </p> <ul> <li><strong></strong> AI  <code>{{get_message_variable::stat_data}}</code><code>&#x3C;%= getvar('stat_data') _%></code> </li> <li><strong></strong> AI <code>1</code></li> <li><strong></strong> AI  <code>&#x3C;UpdateVariable></code> </li> </ul> <p> <code>[mvu_update]</code></p> <ul> <li><code></code></li> <li><code>[mvu_update]</code></li> <li><code>[mvu_update]</code></li> </ul> <p> AI  <code>[mvu_plot]</code>  AI</p> <ul> <li><code>[mvu_plot]</code></li> </ul> <p>, .</p> `;\n// Exports\nexport default code;","// Module\nvar code = `<h1></h1> <ul> <li> <p></p> <ul> <li>; </li> <li></li> </ul> </li> <li> <p></p> <ul> <li>; </li> <li></li> </ul> </li> </ul> <h2></h2> <p> AI  AI </p> <p> SFW <code></code>;  NSFW <code></code></p> <p><code></code>:</p> <ul> <li>MVU <code></code> <code>required</code></li> <li>//</li> <li> Claude 4+Gemini 2.5 ProDeepseek V3/V3.1 (); </li> </ul> `;\n// Exports\nexport default code;","import script from \"./Panel.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./Panel.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./Panel.vue?vue&type=style&index=0&id=0f39b546&scoped=true&lang=css\"\n\nimport exportComponent from \"../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-0f39b546\"]])\n\nexport default __exports__","import Panel from '@/Panel.vue';\nimport { createPinia } from 'pinia';\nimport { createApp } from 'vue';\n\nconst app = createApp(Panel);\n\nfunction teleportStyle() {\n    if ($(`head > div[script_id=\"${getScriptId()}\"]`).length > 0) {\n        return;\n    }\n    const $div = $(`<div>`)\n        .attr('script_id', getScriptId())\n        .append($(`head > style`, document).clone());\n    $('head').append($div);\n}\nexport function initPanel() {\n    teleportStyle();\n\n    const $app = $('<div>').attr('script_id', getScriptId());\n    $('#extensions_settings2').append($app);\n\n    app.use(createPinia()).mount($app[0]);\n}\n\nfunction deteleportStyle() {\n    $(`head > div[script_id=\"${getScriptId()}\"]`).remove();\n}\nexport function destroyPanel() {\n    app.unmount();\n\n    $(`#extensions_settings2 > div[script_id=\"${getScriptId()}\"]`).remove();\n\n    deteleportStyle();\n}\n","import { registerButtons, SetExtraModelSupported, SetReceivedCallbackFn } from '@/button';\nimport { exportGlobals, unsetGlobals } from '@/export_globals';\nimport {\n    cleanupVariablesInMessages,\n    handleVariablesInCallback,\n    handleVariablesInMessage,\n    updateVariable,\n    updateVariables,\n} from '@/function';\nimport {\n    MVU_FUNCTION_NAME,\n    overrideToolRequest,\n    registerFunction,\n    setFunctionCallEnabled,\n    ToolCallBatches,\n    unregisterFunction,\n} from '@/function_call';\nimport { showNotifications } from '@/notifications';\nimport { destroyPanel, initPanel } from '@/panel';\nimport { useSettingsStore } from '@/settings';\nimport {\n    clearScopedEvent,\n    findLastValidMessage,\n    getSillyTavernVersion,\n    getTavernHelperVersion,\n    initSillyTavernVersion,\n    initTavernHelperVersion,\n    is_jest_environment,\n    isFunctionCallingSupported,\n    scopedEventOn,\n} from '@/util';\nimport { exported_events, ExtraLLMRequestContent, MvuData } from '@/variable_def';\nimport { initCheck } from '@/variable_init';\nimport { compare } from 'compare-versions';\nimport { klona } from 'klona';\n\n/**\n * \n */\nlet duringExtraCall = false;\n\n/**\n * \n */\nlet isExtraModelSupported = false;\n\nasync function handlePromptFilter(lores: {\n    globalLore: Record<string, any>[];\n    characterLore: Record<string, any>[];\n    chatLore: Record<string, any>[];\n    personaLore: Record<string, any>[];\n}) {\n    const settings = useSettingsStore().settings;\n\n    //\n    isExtraModelSupported = false;\n\n    //lore [mvu_update] \n    if (settings. === 'AI') {\n        return;\n    }\n    if (settings.. && !isFunctionCallingSupported()) {\n        toastr.warning(\n            '/API  `AI`',\n            '[MVU]',\n            {\n                timeOut: 2000,\n            }\n        );\n        return;\n    }\n\n    const update_regex = /\\[mvu_update\\]/i;\n    const plot_regex = /\\[mvu_plot\\]/i;\n    const remove_and_check = (lore: Record<string, any>[]) => {\n        const filtered = _.remove(lore, entry => {\n            const is_update_regex = entry.comment.match(update_regex);\n            const is_plot_regex = entry.comment.match(plot_regex);\n            return duringExtraCall\n                ? is_plot_regex && !is_update_regex\n                : !is_plot_regex && is_update_regex;\n        });\n        if (filtered.length > 0) {\n            isExtraModelSupported = true;\n        }\n    };\n    remove_and_check(lores.globalLore);\n    remove_and_check(lores.characterLore);\n    remove_and_check(lores.chatLore);\n    remove_and_check(lores.personaLore);\n}\n\nlet vanilla_parseToolCalls: any = null;\n\nasync function onMessageReceived(message_id: number) {\n    const current_chatmsg = getChatMessages(message_id).at(-1);\n    if (!current_chatmsg) {\n        return;\n    }\n\n    const message_content = current_chatmsg.message;\n    if (message_content.length < 5) {\n        //MESSAGE_RECEIVED  \"...\" \n        return;\n    }\n\n    const settings = useSettingsStore().settings;\n    duringExtraCall = false;\n\n    SetExtraModelSupported(isExtraModelSupported);\n    if (\n        settings. === 'AI' ||\n        (settings.. && !isFunctionCallingSupported()) || //\n        isExtraModelSupported === false // ,  \"AI\"\n    ) {\n        await handleVariablesInMessage(message_id);\n        return;\n    }\n\n    duringExtraCall = true;\n    let user_input = ExtraLLMRequestContent;\n    if (settings..) {\n        user_input += `\\n use \\`mvu_VariableUpdate\\` tool to update variables.`;\n    }\n    const generateFn = settings.. === false ? generateRaw : generate;\n\n    let result: string = '';\n    let retries = 0;\n\n    try {\n        setFunctionCallEnabled(true);\n        // {{lastUserMessage}}\n        console.log('Before RegisterMacro');\n        if (compare(getSillyTavernVersion(), '1.13.4', '<=')) {\n            //https://github.com/SillyTavern/SillyTavern/pull/4614\n            //1s dry_run\n            await new Promise(res => setTimeout(res, 1000));\n        }\n        SillyTavern.registerMacro('lastUserMessage', () => {\n            return user_input;\n        });\n        console.log('After RegisterMacro');\n        const promptInjects: InjectionPrompt[] = [\n            {\n                id: '817114514',\n                position: 'in_chat',\n                depth: 0,\n                should_scan: false,\n                role: 'system',\n                content: user_input,\n            },\n            {\n                id: '817114515',\n                position: 'in_chat',\n                depth: 2,\n                should_scan: false,\n                role: 'assistant',\n                content: '<past_observe>',\n            },\n            {\n                id: '817114516',\n                position: 'in_chat',\n                depth: 1,\n                should_scan: false,\n                role: 'assistant',\n                content: '</past_observe>',\n            },\n        ]; // user_input \n\n        let collected_tool_calls: ToolCallBatches | undefined = undefined;\n        if (settings..) {\n            vanilla_parseToolCalls = SillyTavern.ToolManager.parseToolCalls;\n            const vanilla_bound = SillyTavern.ToolManager.parseToolCalls.bind(\n                SillyTavern.ToolManager\n            );\n            SillyTavern.ToolManager.parseToolCalls = (tool_calls: any, parsed: any) => {\n                vanilla_bound(tool_calls, parsed);\n                collected_tool_calls = tool_calls;\n            };\n        }\n\n        for (retries = 0; retries < 3; retries++) {\n            if (settings..) {\n                toastr.info(\n                    `[MVU]...${retries === 0 ? '' : `  ${retries}/3`}`\n                );\n            }\n            collected_tool_calls = undefined;\n            const current_result = await generateFn(\n                settings.. === ''\n                    ? {\n                          user_input: ` <must> `,\n                          injects: promptInjects,\n                          max_chat_history: 2,\n                          should_stream: settings..,\n                      }\n                    : {\n                          user_input: ` <must> `,\n                          custom_api: {\n                              apiurl: settings..api,\n                              key: settings..,\n                              model: settings..,\n                              temperature: settings..,\n                              frequency_penalty: settings..,\n                              presence_penalty: settings..,\n                              max_tokens: settings..token,\n                          },\n                          injects: promptInjects,\n                          max_chat_history: 2,\n                          should_stream: settings..,\n                      }\n            );\n            if (collected_tool_calls !== undefined) {\n                const content = _.get(collected_tool_calls as ToolCallBatches, '[0]');\n                if (content) {\n                    const mvu_function_call = _(content).findLast(\n                        fn => fn.function.name === MVU_FUNCTION_NAME\n                    );\n                    if (mvu_function_call) {\n                        const mvu_function_call_content = _.get(\n                            mvu_function_call,\n                            'function.arguments'\n                        );\n                        if (mvu_function_call_content) {\n                            try {\n                                const mvu_function_call_json =\n                                    JSON.parse(mvu_function_call_content);\n                                if (\n                                    mvu_function_call_json.delta &&\n                                    mvu_function_call_json.delta.length > 5\n                                ) {\n                                    result = `<UpdateVariable><Analyze>${mvu_function_call_json.analysis}</Analyze>${mvu_function_call_json.delta}</UpdateVariable>`;\n                                    break;\n                                }\n                            } catch (e) {\n                                console.log(\n                                    `failed to parse function call content,retry: ${mvu_function_call_content}: ${e}`\n                                );\n                            }\n                        }\n                    }\n                }\n            }\n            console.log(`Vanilla Response: ${current_result}`);\n            if (current_result.indexOf('<UpdateVariable>') !== -1) {\n                //thinking \n                //<UpdateVariable><UpdateVariable></UpdateVariable> \n                // thinking  <UpdateVariable> \n                const lastUpdateVariableIndex = current_result.lastIndexOf('<UpdateVariable>');\n                const last_content = current_result\n                    .slice(lastUpdateVariableIndex + 16)\n                    .replace(/<\\/UpdateVariable>/g, '');\n                const fn_call_match =\n                    /_\\.(?:set|insert|assign|remove|unset|delete|add)\\s*\\([\\s\\S]*?\\)\\s*;/.test(\n                        last_content\n                    );\n                if (fn_call_match) {\n                    result = `<UpdateVariable>${last_content}</UpdateVariable>`;\n                    break;\n                }\n            }\n        }\n    } catch (e) {\n        console.error(`: ${e}`);\n        await handleVariablesInMessage(message_id);\n        return;\n    } finally {\n        if (vanilla_parseToolCalls !== null) {\n            SillyTavern.ToolManager.parseToolCalls = vanilla_parseToolCalls;\n            vanilla_parseToolCalls = null;\n        }\n        SillyTavern.unregisterMacro('lastUserMessage');\n        setFunctionCallEnabled(false);\n        duringExtraCall = false;\n        // generate  false\n        isExtraModelSupported = true;\n    }\n\n    if (result !== '') {\n        // QUESTION: ,  tool calling ?\n        const chat_message = getChatMessages(message_id);\n\n        await setChatMessages(\n            [\n                {\n                    message_id,\n                    message: chat_message[0].message + result,\n                },\n            ],\n            {\n                refresh: 'none',\n            }\n        );\n    } else {\n        toastr.error('/', '[MVU]');\n    }\n    await handleVariablesInMessage(message_id);\n}\nasync function removeChatVariables() {\n    updateVariablesWith(\n        variables => {\n            _.unset(variables, 'initialized_lorebooks');\n            _.unset(variables, 'stat_data');\n            _.unset(variables, 'schema');\n            _.unset(variables, 'display_data');\n            _.unset(variables, 'delta_data');\n            return variables;\n        },\n        { type: 'chat' }\n    );\n}\nasync function initialize() {\n    if (compare(getTavernHelperVersion(), '3.4.17', '<')) {\n        toastr.warning(\n            ', ,  3.4.17 ',\n            '[MVU]'\n        );\n    }\n\n    const store = useSettingsStore();\n\n    registerButtons();\n\n    if (store.settings. === false) await removeChatVariables();\n\n    const { ,  } = store.settings.auto_cleanup;\n    // , \n    if (\n         &&\n        SillyTavern.chat.length >  &&\n        _.has(SillyTavern.chat, [1, 'variables', 0, 'stat_data'])\n    ) {\n        toastr.info('...', '[MVU]');\n        let is_backup_success = false;\n        try {\n            const body = {\n                is_group: false,\n                avatar_url: SillyTavern.characters[Number(SillyTavern.characterId)]?.avatar,\n                file: `${SillyTavern.getCurrentChatId()}.jsonl`,\n                exportfilename: `${SillyTavern.getCurrentChatId()}.jsonl`,\n                format: 'jsonl',\n            };\n\n            const response = await fetch('/api/chats/export', {\n                method: 'POST',\n                body: JSON.stringify(body),\n                headers: SillyTavern.getRequestHeaders(),\n            });\n            const data = await response.json();\n            if (!response.ok) {\n                toastr.error(`: ${data.message}`, '[MVU]');\n            } else {\n                toastr.success(data.message);\n                //\n                const serialized = data.result;\n                const blob = new Blob([serialized], { type: 'text/plain' });\n                const url = URL.createObjectURL(blob);\n                const link = document.createElement('a');\n                link.href = url;\n                link.download = body.exportfilename;\n                link.click();\n                URL.revokeObjectURL(url);\n                is_backup_success = true;\n            }\n        } catch (error) {\n            // display error message\n            toastr.error(`: ${error}`, '[MVU]');\n        }\n        if (is_backup_success) {\n            const counter = cleanupVariablesInMessages(\n                1, //0 \n                SillyTavern.chat.length - 1 - ,\n                store.settings.\n            );\n            if (counter > 0) {\n                toastr.info(` ${counter} `, '[MVU]', {\n                    timeOut: 1000,\n                });\n            }\n        }\n    }\n\n    // \n    scopedEventOn(\n        tavern_events.MESSAGE_DELETED,\n        _.debounce(async () => {\n            //debounce \n            const last_message_id = SillyTavern.chat.length - 1;\n\n            const store = useSettingsStore();\n            const {  } = store.settings.auto_cleanup;\n\n            const last_10th_message_id = Math.max(1, last_message_id - );\n            const last_not_has_variable_message_id = SillyTavern.chat.findLastIndex(\n                chat_message =>\n                    !_.has(chat_message, ['variables', chat_message.swipe_id ?? 0, 'stat_data']) ||\n                    !_.has(chat_message, ['variables', chat_message.swipe_id ?? 0, 'schema'])\n            );\n            if (last_10th_message_id > last_not_has_variable_message_id) {\n                //  10 \n                console.info(` ${} `);\n                return;\n            }\n\n            const last_20th_message_id = Math.max(1, last_message_id - );\n            const snapshot_message_id = findLastValidMessage(last_20th_message_id);\n            if (\n                snapshot_message_id === -1 ||\n                !_.has(SillyTavern.chat, [snapshot_message_id, 'variables', 0, 'stat_data'])\n            ) {\n                // \n                toastr.warning(\n                    ` 0 ~ ${last_20th_message_id} `,\n                    '[MVU]'\n                );\n                return;\n            }\n            const snapshot_chat_message = SillyTavern.chat[snapshot_message_id];\n\n            toastr.info(`...`, '[MVU]', { timeOut: 1000 });\n\n            // start/end  \"10\" \n            let message = SillyTavern.chat[snapshot_message_id + 1].mes;\n            let variables = klona(\n                snapshot_chat_message.variables![snapshot_chat_message.swipe_id ?? 0] as MvuData\n            );\n            for (let i = snapshot_message_id + 1; i <= last_not_has_variable_message_id; i++) {\n                message = SillyTavern.chat[i].mes;\n                //\n                await updateVariables(message, variables);\n                const chat_message = SillyTavern.chat[i];\n                const is_valid_message =\n                    _.has(chat_message, ['variables', chat_message.swipe_id ?? 0, 'stat_data']) &&\n                    _.has(chat_message, ['variables', chat_message.swipe_id ?? 0, 'schema']);\n\n                // message_id \n                //assert\n                //\n                if (i >= last_20th_message_id && !is_valid_message) {\n                    await updateVariablesWith(\n                        data => {\n                            data.initialized_lorebooks = variables.initialized_lorebooks;\n                            data.stat_data = variables.stat_data;\n                            if (variables.schema !== undefined) {\n                                data.schema = variables.schema;\n                            } else {\n                                _.unset(data, 'schema');\n                            }\n                            data.display_data = variables.display_data;\n                            data.delta_data = variables.delta_data;\n                            return data;\n                        },\n                        { type: 'message', message_id: i }\n                    );\n                    //variables \n                    variables = klona(variables);\n                }\n                //  update \n            }\n\n            toastr.info(``, '[MVU]', { timeOut: 3000 });\n        }, 2000)\n    );\n\n    scopedEventOn(tavern_events.GENERATION_STARTED, initCheck);\n    scopedEventOn(tavern_events.MESSAGE_SENT, initCheck);\n    scopedEventOn(tavern_events.MESSAGE_SENT, handleVariablesInMessage);\n\n    // 3.6.5  `tavern_events` , \n    scopedEventOn('worldinfo_entries_loaded', handlePromptFilter);\n\n    scopedEventOn(\n        tavern_events.MESSAGE_RECEIVED,\n        is_jest_environment ? onMessageReceived : _.throttle(onMessageReceived, 3000)\n    );\n    SetReceivedCallbackFn(onMessageReceived);\n\n    scopedEventOn(exported_events.INVOKE_MVU_PROCESS, handleVariablesInCallback);\n    scopedEventOn(exported_events.UPDATE_VARIABLE, updateVariable);\n    scopedEventOn(tavern_events.CHAT_COMPLETION_SETTINGS_READY, overrideToolRequest);\n\n    _.set(window.parent, 'handleVariablesInMessage', handleVariablesInMessage);\n    registerFunction();\n\n    // \n    scopedEventOn(tavern_events.MESSAGE_RECEIVED, message_id => {\n        const store = useSettingsStore();\n        const {  } = store.settings.auto_cleanup;\n        if (!) {\n            return;\n        }\n        if (SillyTavern.chat.length % 5 !== 0) {\n            return; //  5 \n        }\n        const old_message_id = message_id - ; //user\n        if (old_message_id > 0) {\n            const counter = cleanupVariablesInMessages(\n                //  user * 2\n                Math.max(1, old_message_id - 2 -  * 2), //  MESSAGE_SENT\n                old_message_id,\n                store.settings.\n            );\n            console.log(`[MVU] ${counter} `);\n        }\n    });\n\n    showNotifications();\n    toastr.info(\n        `: ${__BUILD_DATE__ ?? 'Unknown'} (${__COMMIT_ID__ ?? 'Unknown'})`,\n        '[MVU]'\n    );\n}\n\nasync function destroy() {\n    if (vanilla_parseToolCalls !== null) {\n        SillyTavern.ToolManager.parseToolCalls = vanilla_parseToolCalls;\n        vanilla_parseToolCalls = null;\n    }\n    unregisterFunction();\n    clearScopedEvent();\n}\n\n$(async () => {\n    await initSillyTavernVersion();\n    await initTavernHelperVersion();\n    exportGlobals();\n    await initPanel();\n    eventOn(tavern_events.CHAT_CHANGED, reloadScript);\n    await initialize();\n});\n$(window).on('pagehide', async () => {\n    destroyPanel();\n    destroy();\n    unsetGlobals();\n});\nlet current_chat_id = SillyTavern.getCurrentChatId();\nfunction reloadScript(chat_id: string) {\n    if (current_chat_id !== chat_id) {\n        current_chat_id = chat_id;\n        destroy();\n        initialize();\n    }\n}\n","import { useSettingsStore } from '@/settings';\n\nexport function showNotifications() {\n    const store = useSettingsStore();\n\n    if (store.settings.internal. === false) {\n        toastr.info(\n            '-, ',\n            '[MVU]'\n        );\n        store.settings.internal. = true;\n    }\n    if (store.settings.internal. === false) {\n        toastr.info(\n            'MVU ;  `` ',\n            '[MVU]'\n        );\n        store.settings.internal. = true;\n    }\n    if (store.settings.internal.API === false) {\n        toastr.info(\n            'MVU  API  token  >= 4.0.14',\n            '[MVU]API'\n        );\n        store.settings.internal.API = true;\n    }\n}\n"],"names":["exports","sfc","props","target","__vccOpts","key","val","module","cssWithMappingToString","list","toString","this","map","item","content","needLayer","concat","length","join","i","modules","media","dedupe","supports","layer","undefined","alreadyImportedModules","k","id","_k","push","cssMapping","btoa","base64","unescape","encodeURIComponent","JSON","stringify","data","sourceMapping","__esModule","default","locals","add","listToStyles","parentId","styles","newStyles","part","css","sourceMap","parts","hasDocument","document","DEBUG","Error","stylesInDom","head","getElementsByTagName","singletonElement","singletonCounter","isProduction","noop","options","ssrIdKey","isOldIE","navigator","test","userAgent","toLowerCase","addStylesClient","_isProduction","_options","addStylesToDom","newList","mayRemove","domStyle","refs","j","addStyle","createStyleElement","styleElement","createElement","type","appendChild","obj","update","remove","querySelector","parentNode","removeChild","styleIndex","applyToSingletonTag","bind","applyToTag","newObj","textStore","replaceText","index","replacement","filter","Boolean","styleSheet","cssText","cssNode","createTextNode","childNodes","insertBefore","setAttribute","ssrId","sources","firstChild","___CSS_LOADER_EXPORT___","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","assertVWD","_flag","_v","isValueWithDescriptionStatData","value","Array","isArray","isArraySchema","isObjectSchema","n","getter","d","a","definition","o","Object","defineProperty","enumerable","get","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag","variable_events","VARIABLE_INITIALIZED","SINGLE_VARIABLE_UPDATED","VARIABLE_UPDATE_ENDED","VARIABLE_UPDATE_STARTED","COMMAND_PARSED","BEFORE_MESSAGE_UPDATE","exported_events","EXTENSIBLE_MARKER","generateSchema","oldSchemaNode","parentRecursiveExtensible","oldElementType","template","isExtensible","isRecursiveExtensible","extensible","recursiveExtensible","elementType","console","error","metaElementIndex","findIndex","_","isObject","isDate","metaElement","$meta","splice","log","markerIndex","indexOf","schema_node","typedData","oldProperties","oldExtensible","oldRecursiveExtensible","properties","schemaNode","parentMeta","oldChildNode","childRecursiveExtensible","childSchema","isRequired","required","includes","dataType","getSchemaForPath","schema","path","pathSegments","toPath","currentSchema","segment","reconcileAndApplySchema","variables","newSchema","klona","stat_data","newSchemaWithProps","strictTemplate","strictSet","concatTemplateArray","has","cleanUpMetadata","Vue","z","TavernHelper","globalThis","sillytavern_version","getSillyTavernVersion","tavernhelper_version","getTavernHelperVersion","isFunctionCallingSupported","SillyTavern","ToolManager","isToolCallingSupported","chatCompletionSettings","function_calling","is_jest_environment","jest","process","saveChatDebounced","debounce","saveChat","findLastValidMessage","end_message_id","chat","slice","findLastIndex","chat_message","swipe_id","stop_lists","scopedEventOn","event_type","listener","eventOn","eventRemoveListener","Settings","number","transform","clamp","Math","max","prefault","auto_cleanup","internal","useSettingsStore","defineStore","settings","ref","parse","extensionSettings","watch","new_settings","set","toRaw","saveSettingsDebounced","deep","__WEBPACK_EXTERNAL_MODULE_https_testingcf_jsdelivr_net_npm_mathjs_esm_aec644b1__","trimQuotesAndBackslashes","str","isString","replace","applyTemplate","strict_array_cast","array_merge_concat","value_is_object","value_is_array","template_is_array","merge","parseCommandValue","valStr","trimmed","trim","e","startsWith","endsWith","result","Function","err","scope","math","parseFloat","toPrecision","YAML","findMatchingCloseParen","startPos","parenCount","inQuote","quoteChar","char","prevChar","parseParameters","paramsString","params","currentParam","bracketCount","braceCount","async","getLastValidVariable","message_id","findLast","getVariables","pathFix","segments","currentSegment","inQuotes","updateVariable","new_value","reason","is_recursive","display_data","$internal","delta_data","currentValue","oldValue","reason_str","display_str","info","eventEmit","stringNewValue","updateVariables","current_message_content","out_status","delta_status","commands","inputText","results","setMatch","substring","match","commandType","setStart","openParen","closeParen","endPos","comment","potentialComment","fullMatch","isValid","full_match","args","extractCommands","substitudeMacros","error_info","current_command","variable_modified","outError","message","warn","error_last","error_command","strict_template","concat_template_array","strict_set","cmd","command","newValue","Date","toISOString","isPathVWD","Number","oldValueCopy","finalNewValue","targetPath","existingValue","targetSchema","newKey","String","successful","valueToAssign","collection","keyOrIndex","keyOrIndexToRemove","containerPath","pathParts","lastPart","pop","containerSchema","keyString","targetToRemove","itemRemoved","unset","originalArray","indexToRemove","isEqual","keys","keyToRemove","initialValue","valueToAdd","isVWD","potentialDate","parsedDate","isNaN","getTime","delta","newDate","finalValueToSet","base_command","toastr","warning","timeOut","handleVariablesInMessage","getChatMessages","at","message_content","role","request_message_id","has_variable_modified","context","updater","initialized_lorebooks","updateVariablesWith","setChatMessages","refresh","handleVariablesInCallback","in_out_variable_info","old_variables","new_variables","cleanupVariablesInMessages","start_message_id","snap_interval","counter","forEach","msg_index","chat_flag","range","swipes","omit","updateDescriptions","_init_path","init_data","msg_data","target_data","current_path","msgValue","targetObj","description","msg_array","current_target","description_path","initCheck","getLastMessageId","oldArray","newObject","lorebookName","is_updated","loadInitVarData","isEmpty","generated_schema","assign","last_msg","include_swipes","swipes_data","Promise","all","swipe","vanilla_variable_data","current_data","setChatMessage","entries","escapeHtml","_e","dst_setting","scan_depth","context_percentage","budget_cap","min_activations","max_depth","max_recursion_steps","insertion_strategy","include_names","recursive","case_sensitive","match_whole_words","use_group_scoring","overflow_alert","getLorebookSettings","setLorebookSettings","updateLorebookSettings","mvu_data","lorebook_list","enabled_lorebook_list","selected_global_lorebooks","char_lorebook","getCurrentCharPrimaryLorebook","getEnabledLorebookList","current_lorebook","init_entries","getLorebookEntries","entry","parsedData","parseError","parseDocument","toJS","e2","e3","msg_received_callback","is_extra_model_support","buttons","name","function","latest_init_data","latest_msg_data","merged_data","replaceVariables","success","callGenericPopup","POPUP_TYPE","INPUT","parseInt","snapshot","then","fnd_message","result2","recur_intial_message_id","recur_variable_data","mes","current_chatmsg","current_chat_content","begin_pos","lastIndexOf","end_pos","filtered_string","snapshot_interval","depth","createMVU","events","parseMessage","old_data","variableData","getMvuData","replaceMvuData","getCurrentMvuData","getCurrentMessageId","replaceCurrentMvuData","reloadInitVar","setMvuVariable","getMvuVariable","category","default_value","isValueWithDescription","getRecordFromMvuData","game_data","extractRecord","MVU_FUNCTION_NAME","is_function_call_enabled","setFunctionCallEnabled","enabled","onVariableUpdatedCall","analysis","overrideToolRequest","generate_data","tools","size","tool_choice","_hoisted_1","class","_hoisted_2","_hoisted_3","_hoisted_4","for","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_12","_hoisted_13","_hoisted_14","_hoisted_15","_hoisted_16","_hoisted_17","_hoisted_18","_hoisted_19","_hoisted_20","_hoisted_21","_hoisted_22","_hoisted_23","_hoisted_24","_hoisted_25","_hoisted_26","_hoisted_27","_hoisted_28","_hoisted_29","_hoisted_30","_hoisted_31","_hoisted_32","_hoisted_33","__name","setup","__props","store","additional_extra_configuration_supported","compare","cleanup_is_open","compatibility_is_open","showMethodHelp","TEXT","allowVerticalScrolling","leftAlign","wide","showChatVarHelp","showExtraModeHelp","_ctx","_cache","$event","style","placeholder","disabled","min","step","button","tabindex","app","createApp","Panel","initPanel","$","getScriptId","$div","attr","append","clone","teleportStyle","$app","use","createPinia","mount","destroyPanel","unmount","duringExtraCall","isExtraModelSupported","handlePromptFilter","lores","update_regex","plot_regex","remove_and_check","lore","is_update_regex","is_plot_regex","globalLore","characterLore","chatLore","personaLore","vanilla_parseToolCalls","onMessageReceived","user_input","generateFn","generateRaw","generate","retries","res","setTimeout","registerMacro","promptInjects","position","should_scan","collected_tool_calls","parseToolCalls","vanilla_bound","tool_calls","parsed","current_result","injects","max_chat_history","should_stream","custom_api","apiurl","model","temperature","frequency_penalty","presence_penalty","max_tokens","mvu_function_call","fn","mvu_function_call_content","mvu_function_call_json","lastUpdateVariableIndex","last_content","unregisterMacro","initialize","appendInexistentScriptButtons","b","visible","getButtonEvent","removeChatVariables","is_backup_success","body","is_group","avatar_url","characters","characterId","avatar","file","getCurrentChatId","exportfilename","format","response","fetch","method","headers","getRequestHeaders","json","ok","serialized","blob","Blob","url","URL","createObjectURL","link","href","download","click","revokeObjectURL","tavern_events","MESSAGE_DELETED","last_message_id","last_10th_message_id","last_not_has_variable_message_id","last_20th_message_id","snapshot_message_id","snapshot_chat_message","is_valid_message","GENERATION_STARTED","MESSAGE_SENT","MESSAGE_RECEIVED","throttle","CHAT_COMPLETION_SETTINGS_READY","window","parent","registerFunctionTool","debug","mvu_update_schema","freeze","$schema","additionalProperties","minLength","displayName","stealth","parameters","shouldRegister","action","formatMessage","registerFunction","old_message_id","showNotifications","destroy","unregisterFunctionTool","stop","pkgVersion","catch","initSillyTavernVersion","initTavernHelperVersion","mvu","exportGlobals","CHAT_CHANGED","reloadScript","on","current_chat_id","chat_id"],"sourceRoot":""}